/*! (c)2018 AppNexus, Inc. v1.2.7
This code contains portions of videojs-vast-plugin(Copyright (c) 2015 MailOnline) and videojs-markers(Copyright (c) 2013 Samping Chuang) which are licensed under the MIT License.  
The MIT License (MIT)
Permission is here by granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
var APNVideo_VmapVastPlugin=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(){i.registerPlugin("apnVmapVastPluginCommand",(function(e,t){if("stop"===e)d?d.stop():p&&p.stop();else if("insertAdBreak"===e){if(c||(c=this),!t||!t.apnTagParams)return void l.error(u,"Invalid parameter 'data': ",t);d||(d=new a),d.play(c,t)}}))}var i=videojs,a=r(1),o=r(32),s=r(35),l=r(3),u="apnVmapVast";l.always(u,"Version 1.2.7");var c,d,p,f={test:function(){return{registerVmapVastPlugin:n}},init:function(){n()},id:null,play:function(e,t){this.id=t,i(t).apnVmapVastPlugin(e)},stop:function(){i(this.id).apnVmapVastPluginCommand("stop")},insertAdBreak:function(e,t,r){this.id=e,t.breakTime=r,i(this.id).apnVmapVastPluginCommand("insertAdBreak",t)}};e.exports=f,videojs.registerPlugin("apnVmapVastPlugin",(function(e){c=this,e&&e.apnTagParams&&(e.vmapEnabled?(d=new a).play(c,e):Array.isArray(e.apnTagParams)?(p=new s).play(c,e):(p=new o).play(c,e))})),window.APNVideo_VmapVastPlugin=f},function(e,t,r){var n=r(2),i=r(4),a=r(17),o=r(24),s=r(16),l=r(18),u=r(3),c=r(9),d="apnVmapVast->vmapManager";e.exports=function(){function e(e){u.log(d,(e?"Show":"Hide")+" ad cover with spinner"),e?(R.style.display="block",T.el().classList.add("vjs-waiting")):(R.style.display="none",T.el().classList.remove("vjs-waiting"))}function t(e){for(var t=0;t<e.adBreaks.length;t++)if(S.breakTime&&(e.adBreaks[t].timeOffset=S.breakTime),e.adBreaks[t].adSource&&e.adBreaks[t].adSource.vastData)for(var r in e.adBreaks[t].adSource.vastData){var n=e.adBreaks[t].adSource.vastData[r];if(Array.isArray(n)&&n.length>0)for(var i=0;i<n.length;i++){var a=n[i];if(a.vastXml&&S&&S.skippable){var o=(new DOMParser).parseFromString(a.vastXml,"text/xml"),l=M.getSubNode(o,"Linear",0);if(l){if(l.removeAttribute("skipoffset"),S.skippable.enabled){var u=M.getSubNode(l,"Duration"),c=M.getNodeValue(u),d=s.convertStringToMseconds(c);d&&d>=1e3*S.skippable.videoThreshold?(a.durationMsecs=d,a.skipOffset=s.convertSecsToString(S.skippable.videoOffset)):a.skipOffset&&delete a.skipOffset}else a.skipOffset&&delete a.skipOffset;if(a.skipOffset){var p=o.createAttribute("skipoffset");p.value=a.skipOffset,l.setAttributeNode(p)}a.vastXml=(new XMLSerializer).serializeToString(o)}}}}}function r(e,r){for(var n=[],i=0,a=0;a<e.length;a++){var l=function(a){return function(o,l,c){i++;var p=e[a].url;o?(u.log(d,"Successfully parsed VMAP xml from "+p),t(l),n.push(l)):(u.log(d,"Failed to parse VMAP xml from "+p),c&&c.length>0&&s.trackUrls(c)),i>=e.length&&r(n)}};S.timeouts?S.timeouts.adServerTimeout?(S.adServerTimeout=S.timeouts.adServerTimeout,o.parse(e[a].xml,l(a),null,S)):o.parse(e[a].xml,l(a),S.timeouts.adCallTimeout,S):o.parse(e[a].xml,l(a),null,S)}}function p(t){if(t.length>0){for(var r=t[0],n=1;n<t.length;n++)r=o.mergeVmapData(r,t[n]);u.debug(d,"VMAP data for rendering: ",r),f(r)}else e(!1),u.warn(d,"No VMAP data is available."),P=!0,T.play()}function f(t){if(Array.isArray(t.adBreaks)&&t.adBreaks.length>0){var r={markerStyle:{width:"5px","border-radius":"10%","background-color":"white"},markerTip:{display:!1},onMarkerReached:function(e){v(e.time)},markers:[],metadataLoaded:!0},i=function(){N||(N=T.duration());for(var i,a=!1,o=N,l=0;l<t.adBreaks.length;l++){var u=t.adBreaks[l],c=T.currentTime();if(C&&(c=C.currentTime),null!==(i=s.convertStringToSeconds(u.timeOffset,o,c))&&i<=o){i===o&&(i=parseInt(o+.5));for(var d=!1,p=0;p<r.markers.length;p++)if(r.markers[p].time===i){d=!0;break}if(d)continue;var f={time:i,played:!1,adBreak:u};i>=0&&(r.markers.push({time:i}),i<1&&(a=!0)),U.push(f)}}r.markers.length>0&&(U.sort((function(e,t){return e.time-t.time})),S.breakTime&&U.length>1?D?E=i:T.markers.add(r.markers):(n&&T.markers&&T.markers.destroy&&T.markers.destroy(),x||(x=new n(videojs)),x.init(T),x.markers(r))),P=!0,S.playerSettings.autostart&&T.play(),a||e(!1),S.replayAdBreak&&(I=T.currentSource().src,W=!1,T.on("seeked",(function(){D||I!==T.currentSource().src||(T.markers&&T.markers.allowReplay(),h())})),T.on("timeupdate",(function(){I===T.currentSource().src&&!W&&!D&&T.currentTime()>2&&(W=!0)})))};N||!N&&T.duration()>0?i():T.one("loadedmetadata",i),T.playlist&&T.playlist.autoadvance&&T.playlist.autoadvance(null)}else u.warn(d,"VMAP object does not contain breaks."),P=!0,T.play(),T.playlist&&T.playlist.autoadvance&&T.playlist.autoadvance(0)}function h(){var e=T.currentTime();u.log(d,"Seeked event: player time = "+e+", last break time = "+H),u.log(d,"Seeked back event happened");for(var t=0;t<U.length;t++)U[t].time>=e&&U[t].played&&(0===U[t].time?(u.log(d,"Seeked event: can replay preroll = "+W),W&&(W=!1,U[t].played=!1,U[t].breakObj=null)):T.duration()-U[t].time<2?U[t].time-e>2&&(U[t].played=!1,U[t].breakObj=null):U[t].time>e&&(U[t].played=!1,U[t].breakObj=null))}function g(e,t){var r;if(null===e){if(t){for(r=U.length-1;r>=0;r--)if(U[r].time<0&&!U[r].played)return r}else for(r=0;r<U.length;r++)if(U[r].time>=0&&!U[r].played)return r}else for(r=0;r<U.length;r++)if(U[r].time===e&&!U[r].played)return r;return null}function v(t){if(u.log(d,"startBreak called. Break time: "+t),e(!1),D)u.log(d,"startBreak called. Break are playing right now");else{T.off("ended",m),function(){var e=document.getElementsByClassName("vjs-error-display");if(e&&e.length>0){var t=e[0];t&&t.parentNode.removeChild(t)}}(),F=-1,S.replayAdBreak&&h();var r=g(t,!1);if(null===r||U[r].played)u.log(d,"Break time: "+t+" already played or not exist.");else{F=r,D=!0,U[r].breakObj||(U[r].breakObj=new i(U[r].adBreak,T,S,w)),n&&(V=JSON.stringify(T.markers.getMarkers()),T.markers.removeAll()),U[r].played=!0,H=t,0!==t&&(S.playerSettings.autostart=!0,S.playerSettings.muted=T.muted());var a=0===t&&(_.device.type||_.device.model);a&&T.playlist&&"function"==typeof T.playlist&&T.playlist.currentIndex()>0&&(a=!1),a?setTimeout((function(){T.pause(),T.bigPlayButton.el_.style.display="block",T.one("play",(function(){C=s.getPlayerSnapshot(T),T.pause(),U[r].breakObj.start()}))}),500):(C=s.getPlayerSnapshot(T),T.pause(),U[r].breakObj.start())}X||b()}}function m(){setTimeout((function(){q||!X||D||T.playlist.next()}),500)}function y(){T.one("tryToResumeDone",(function(){D=!1,q=!1;var e=T.currentTime()<T.duration()-3?2e3:0;u.log(d,"Activate ended event delay = "+e),0===e?X&&j.length>0&&T.playlist.currentIndex()<j.length-1&&T.one("ended",m):setTimeout((function(){X&&j.length>0&&T.playlist.currentIndex()<j.length-1&&T.one("ended",m)}),e)})),s.restorePlayerSnapshot(T,C),C=null,s.showNextOverlay(!0),setTimeout((function(){if(D=!1,V){var e=JSON.parse(V);E&&(e.push({time:E}),E=null),T.markers&&T.markers.reset&&T.markers.reset(e)}T.paused()&&0===T.currentTime()&&(T.bigPlayButton.el_.style.display="block",T.one("playing",(function(){T.bigPlayButton.el_.style.display="none"})))}),1e3)}function b(){(j=T.playlist&&"function"==typeof T.playlist?T.playlist():[])||(j=[]),j.length>1&&T.playlist.currentIndex()<j.length-1?X||L.getXML(S,T,(function(e){e?Array.isArray(e)?r(e,(function(e){if(e.length>0){X=e[0];for(var t=1;t<e.length;t++)X=o.mergeVmapData(X,e[t]);u.debug(d,"VMAP data for rendering next playlist item: ",X)}else u.warn(d,"No VMAP data is available for next playlist item.")})):e?((X={}).adBreaks=[],X.adBreaks.push({timeOffset:S.breakTime,xml:e})):u.warn(d,"No VMAP data is available for next playlist item."):u.error(d,"Error to get VMAP xml(s) for next playlist item.")})):T.off("playlistitem",A)}function A(){u.log(d,"playlistitem is fired"),e(!0),q=!0,N=0,n&&T.markers&&T.markers.destroy&&T.markers.destroy(),T.one("loadedmetadata",(function(){X?(f(X),X=null):L.getXML(S,T,(function(t){t?Array.isArray(t)?r(t,(function(t){if(t.length>0){X=t[0];for(var r=1;r<t.length;r++)X=o.mergeVmapData(X,t[r]);u.debug(d,"VMAP data for rendering next playlist item: ",X),f(X),X=null}else e(!1),u.warn(d,"No VMAP data is available for next playlist item."),T.play()})):t?((X={}).adBreaks=[],X.adBreaks.push({timeOffset:S.breakTime,xml:t}),f(X),X=null):(e(!1),u.warn(d,"No VMAP data is available for next playlist item."),T.play()):(e(!1),u.error(d,"Error to get VMAP xml(s) for next playlist item."))}))}))}function w(e,t){var r=function(e){for(var t=0;t<U.length;t++)if(U[t].adBreak.breakId===e)return U[t];return null}(e);if(r)switch(u.log(d,"Notification "+t.name+" from break "+e),t.name){case"BreakStarted":D=!0,s.showNextOverlay(!1);break;case"BreakComplete":case"BreakError":case"BreakStopped":y();break;case"BreakAdStarted":s.showNextOverlay(!1);break;case"BreakAdComplete":case"BreakAdError":break;case"BreakAdStopped":B&&(B=!1,U=[],setTimeout((function(){y()}),1));break;default:u.warn(d,"Unknown notification "+t.name+" from break "+e)}}function k(){e(!0),L.getXML(S,T,(function(t){t?Array.isArray(t)?r(t,p):function(e){var t={adBreaks:[]};t.adBreaks.push({timeOffset:S.breakTime,xml:e}),f(t)}(t):(e(!1),u.error(d,"Error to get VMAP xml(s)."),P=!0,S.playerSettings.autostart?_.device.type||_.device.model?(T.bigPlayButton.el_.style.display="block",T.one("play",(function(){T.bigPlayButton.el_.style.display="none"}))):T.play():T.bigPlayButton.el_.style.display="block")}))}var T,S,C,V,E,x,N,I,_=c(),P=!1,M=new l,L=new a,R=document.getElementById("apn-break-cover"),O=document.getElementById("apn-break-spinner"),B=!1,U=[],D=!1,F=-1,j=[],X=null,q=!1,H=0,W=!1;this.play=function(t,r){T=t,(S=r).playerSettings={},S.playerSettings.autostart=0===T.currentTime()?T.autoplay():!T.paused(),S.playerSettings.muted=T.muted(),R||((R=document.createElement("div")).id="apn-break-cover",R.style.width="100%",R.style.height="100%",R.style.backgroundColor="black",R.style.position="absolute",R.style.zIndex=101,T.el().appendChild(R)),R.style.display="none",O||((O=document.createElement("div")).id="apn-break-spinner",O.className="vjs-loading-spinner",R.appendChild(O)),T.bigPlayButton.el_.style.opacity=1,_.device.type||_.device.model||!S.playerSettings.autostart||(T.bigPlayButton.el_.style.display="none"),T.duration()>0?(T.pause(),T.on("playlistitem",A),k()):(e(!0),_.device.type||_.device.model?(S.playerSettings.autostart=!0,S.playerSettings.muted=T.muted(),!0===T.autoplay()&&T.autoplay("any"),P||T.pause(),k(),T.one("loadedmetadata",(function(){T.on("playlistitem",A)}))):(setTimeout((function(){T.paused()&&"block"!==T.bigPlayButton.el_.style.display&&!D&&(e(!1),T.bigPlayButton.el_.style.display="block",T.bigPlayButton.one("click",(function(){T.bigPlayButton.el_.style.display="none"})))}),1e3),T.one("playing",(function(){T.paused()?(e(!1),T.bigPlayButton.el_.style.display="block",T.bigPlayButton.one("click",(function(){T.bigPlayButton.el_.style.display="none",k()}))):(T.bigPlayButton.el_.style.display="none",k()),P||T.pause(),T.on("playlistitem",A)}))))},this.stop=function(){D?(B=!0,U[F].breakObj.stop()):U=[],V=null,n&&T.markers.destroy()},this.test=function(){return{modifyVastXmlsInVmapObject:t,setOptions:function(e){S=e},setPlayer:function(e){T=e},getAdBreaks:function(){return U},setAdBreaks:function(e){U=e},getImpbusCommunicator:function(){return L},getPlaylistAdBreaks:function(){return X},getBreakIndex:g,parseVmapXmls:r,afterParseVmapXmls:p,prepareBreakInstances:f,prepareBreaksForReplay:h,startBreak:v,resetContent:function(){C=s.getPlayerSnapshot(T),y()},getXmlsForNextPlaylistItem:b,nextListItemHandler:A,requestImpbus:k}}}},function(e,t,r){var n=r(3),i="apnVmapVast->MarkersHandler";e.exports=function(e){var t=e,r=null,a={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return e&&e.text?"Break: "+e.text:""},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(){},onMarkerReached:function(){},markers:[]},o=-1,s=function(e){function s(){v.sort((function(e,t){return h.markerTip.time(e)-h.markerTip.time(t)}))}function l(e){e.forEach((function(e){e.key=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}));return t}(),e.reacheTime=e.time,n.log(i,"marker.reacheTime = "+e.reacheTime),e.time=parseInt(e.time+.5),f.el().querySelector(".vjs-progress-holder").appendChild(function(e){var r=t.dom.createEl("div",{className:"vjs-marker "+(e.class||"")},{"data-marker-key":e.key,"data-marker-time":h.markerTip.time(e)});Object.keys(h.markerStyle).forEach((function(e){r.style[e]=h.markerStyle[e]}));var a=u(e);a>=100&&(a=99.5),n.log(i,"marker.time = "+e.time+", position = "+a+"%"),r.style.left=a+"%";try{var o=r.getBoundingClientRect();r.style.marginLeft=o.width/2+"px"}catch(e){}return r.addEventListener("click",(function(){var t=!1;if("function"==typeof h.onMarkerClick&&(t=!1===h.onMarkerClick(e)),!t){var r=this.getAttribute("data-marker-key");f.currentTime(h.markerTip.time(g[r]))}})),h.markerTip.display&&function(e){e.addEventListener("mouseover",(function(){var t=g[e.getAttribute("data-marker-key")];y&&(y.querySelector(".vjs-tip-inner").innerText=h.markerTip.text(t),y.style.left=u(t)+"%",y.style.marginLeft=-parseFloat(y.getBoundingClientRect().width/2)+parseFloat(e.getBoundingClientRect().width/4)+"px",y.style.visibility="visible")})),e.addEventListener("mouseout",(function(){y&&(y.style.visibility="hidden")}))}(r),r}(e)),e.reacheTime>=f.duration()?e.time=f.duration()-.6:e.time=e.reacheTime,n.log(i,"in markerList marker.time = "+e.time),g[e.key]=e,v.push(e)})),s()}function u(e){return h.markerTip.time(e)/f.duration()*100}function c(e){b&&(A=o,b.style.visibility="hidden"),m=o;var t=[];e.forEach((function(e){var r=v[e];if(r){delete g[r.key],t.push(e);var n=f.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']");n.parentNode.removeChild(n)}})),t.reverse(),t.forEach((function(e){v.splice(e,1)})),s()}function d(){(function(){if(v.length){var t,r=function(e){return e<v.length-1?h.markerTip.time(v[e+1]):f.duration()},a=f.currentTime(),s=o;if(m!==o){if(t=r(m),a>=h.markerTip.time(v[m])&&a<t)return;if(m===v.length-1&&a===f.duration())return}if(a<h.markerTip.time(v[0]))s=o;else for(var l=0;l<v.length;l++)if(t=r(l),a>=h.markerTip.time(v[l])&&a<t){s=l;break}var u=function(e){var t={time:e.reacheTime};return n.log(i,"adjustMarkerTime marker.reacheTime = "+e.reacheTime),t};s!==m&&(s!==o&&e.onMarkerReached&&(Math.abs(f.duration()-h.markerTip.time(v[s]))<3?f.one("ended",(function(){e.onMarkerReached(u(v[s]),s)})):e.onMarkerReached(u(v[s]),s)),m=s)}})(),function(){if(h.breakOverlay.display&&!(m<0)){var e=f.currentTime(),t=v[m],r=h.markerTip.time(t);e>=r&&e<=r+h.breakOverlay.displayTime?(A!==m&&(A=m,b&&(b.querySelector(".vjs-break-overlay-text").innerHTML=h.breakOverlay.text(t))),b&&(b.style.visibility="visible")):(A=o,b&&(b.style.visibility="hidden"))}}(),e.onTimeUpdateAfterMarkerUpdate&&e.onTimeUpdateAfterMarkerUpdate()}function p(){h.markerTip.display&&(y=t.dom.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),f.el().querySelector(".vjs-progress-holder").appendChild(y)),l(e.markers),h.breakOverlay.display&&(b=t.dom.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(h.breakOverlay.style).forEach((function(e){b&&(b.style[e]=h.breakOverlay.style[e])})),f.el().appendChild(b),A=o),d(),f.on("timeupdate",d),f.off("loadedmetadata")}var f=r,h=t.mergeOptions(a,e),g={},v=[],m=o,y=null,b=null,A=o;h.metadataLoaded||f.duration()>0?setTimeout((function(){p()}),0):f.on("loadedmetadata",(function(){p()})),f.markers={allowReplay:function(){m=o},getMarkers:function(){for(var e=0;e<v.length;e++)v[e].time=v[e].reacheTime;return v},next:function(){for(var e=f.currentTime(),t=0;t<v.length;t++){var r=h.markerTip.time(v[t]);if(r>e){f.currentTime(r);break}}},prev:function(){for(var e=f.currentTime(),t=v.length-1;t>=0;t--){var r=h.markerTip.time(v[t]);if(r+.5<e)return void f.currentTime(r)}},add:function(e){l(e)},remove:function(e){c(e)},removeAll:function(){for(var e=[],t=0;t<v.length;t++)e.push(t);c(e)},updateTime:function(){v.forEach((function(e){var t=f.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),r=h.markerTip.time(e);t.getAttribute("data-marker-time")!==r&&(t.style.left=u(e)+"%",t.setAttribute("data-marker-time",r))})),s()},reset:function(e){f.markers.removeAll(),l(e)},destroy:function(){f.markers.removeAll(),b&&b.remove(),y&&y.remove(),f.off("timeupdate",d),delete f.markers}}};this.init=function(e){r=e,t.registerPlugin("markers",s)},this.markers=function(e){r.markers(e)}}},function(e,t){function r(e,t){try{if(void 0!==e&&i(e)&&console){var r="[APN",n=function(e){switch(e){case 0:break;case 1:return"always";case 2:return"error";case 3:return"warn";case 4:return"info";case 5:return"log";case 6:return"debug";case 7:return"verbose"}}(e);if(console[n]||(r+="-"+n,n="log"),r+="]",r+="["+function(){var e="";try{var t=new Date;e=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+"."+t.getMilliseconds()}catch(e){}return e}()+"]",t.splice(0,0,r),console[n].apply)console[n].apply(console,t);else{var a=Array.prototype.slice.apply(t).join("");console[n](a)}}}catch(e){}}function n(e){var t=l;try{if(void 0!==e){var r=parseInt(e);isNaN(r)?"boolean"==typeof e?t=e?s:a:"TRUE"===(e=e.toUpperCase())?t=s:"FALSE"===e&&(t=a):t=r}}catch(e){}return t}function i(e){return e<=u}var a=0,o="AppNexus_Page_Debug_Log_Level",s=6,l=a,u=l,c=l,d=l,p=l;e.exports={traceAtLevel:function(){try{if(arguments.length>0){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r.call(this,e,t)}}catch(e){}},always:function(){try{r.call(this,1,Array.prototype.slice.call(arguments))}catch(e){}},error:function(){try{r.call(this,2,Array.prototype.slice.call(arguments))}catch(e){}},log:function(){try{r.call(this,5,Array.prototype.slice.call(arguments))}catch(e){}},warn:function(){try{r.call(this,3,Array.prototype.slice.call(arguments))}catch(e){}},info:function(){try{r.call(this,4,Array.prototype.slice.call(arguments))}catch(e){}},debug:function(){try{r.call(this,6,Array.prototype.slice.call(arguments))}catch(e){}},verbose:function(){try{r.call(this,6,Array.prototype.slice.call(arguments))}catch(e){}},handleLogDebugLegacySupport:function(e,t){try{!function(e,t,r){try{var n="[APN-"+e+"-"+(new Date).toISOString()+"] ";null!==r&&r&&r.length>0&&(n+=r+">"),n+=t,i(e)&&console.log(n)}catch(t){i(e)&&console.log(t)}}(5,e,t)}catch(e){}},setDebugLevel:function(e){try{!function(e){try{p=n(e),u=Math.max(Math.max(c,p),u)}catch(e){}}(e)}catch(e){}},isTraceLevelActive:function(e){try{return i(e)}catch(e){return!1}},TRACE_LEVEL_ALWAYS:1,TRACE_LEVEL_ERROR:2,TRACE_LEVEL_WARN:3,TRACE_LEVEL_INFO:4,TRACE_LEVEL_LOG:5,TRACE_LEVEL_DEBUG:6,TRACE_LEVEL_VERBOSE:6},function(){try{c=n(function(e){try{var t="";try{t=window.top.location.search}catch(e){try{t=window.location.search}catch(e){}}var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}catch(e){return""}}("ast_debug").toUpperCase()),d=n(function(){try{if(localStorage)return localStorage.getItem(o)}catch(e){return l}}()),u=Math.max(Math.max(c,d),u)}catch(e){}}()},function(e,t,r){var n=r(5),i=r(16),a=r(3),o="apnVmapVast->breakManager";e.exports=function(e,t,r,s){function l(e){a.log(o,(e?"Show":"Hide")+" ad cover with spinner"),e?(_.style.display="block",M=!0,setTimeout((function(){M&&"block"!==S.bigPlayButton.el_.style.display&&(P.style.display="block")}),1e3),S.el().classList.add("vjs-waiting")):(P.style.display="none",M=!1,_.style.display="none",S.el().classList.remove("vjs-waiting"))}function u(e){var t=null;if(C.trackings&&C.trackings.length>0)for(var r=0;r<C.trackings.length;r++)if(C.trackings[r].event===e){t=C.trackings[r].uris;break}return t}function c(e,t){var r=u(e);r&&r.length>0&&("error"===e&&function(e,t){for(var r=0;r<e.length;r++)e[r]=e[r].replace("[ERROR_CODE]",t.errorCode),e[r]=e[r].replace("[ERROR_MESSAGE]",t.message)}(r,t),i.trackUrls(r))}function d(e){a.log(o,"trace event message: "+e.data.message),T.pageNotificationCallback&&T.pageNotificationCallback("message",e.data.message)}function p(e){a.log(o,"trace event: "+e.data.event),T.pageNotificationCallback&&T.pageNotificationCallback("event",e.data.event)}function f(){l(!0);var e=h();e?(e.sequence?b=e.sequence:b++,0===A&&(y+=v.duration,V++),v=e,L.innerHTML="Ad "+V+" of "+C.vastXmls.length,R(v.vastSeqData[A].vastXml)):(L.style.display="none",l(!1),V=-1,S.off("vast.adStart"),S.off("vast.adError"),S.off("vast.adsCancel"),S.off("vast.adSkip"),S.off("vast.reset"),S.off("vast.contentEnd"),S.off("adFinished"),S.off("trace.message",d),S.off("trace.event",p),k(C.breakId,{name:"BreakComplete"}),E?c("breakEnd"):c("error",{code:900,message:"All Ads in the break failed"}))}function h(){if(C.vastXmls&&C.vastXmls.length>0){if(!b)return C.vastXmls[0];if(!w&&A<v.vastSeqData.length-1)return A++,v;w=!1,A=0;for(var e=0;e<C.vastXmls.length;e++)if(C.vastXmls[e].sequence>b)return C.vastXmls[e]}return null}function g(){m=0,C.vastXmls=[];var e=[];if(C.adSource&&C.adSource.vastData){for(var t in C.adSource.vastData)if(C.adSource.vastData[t].length>0){e=[];for(var r=0,i=0;i<C.adSource.vastData[t].length;i++){var s=C.adSource.vastData[t][i],l=s.adId,u=n.getUnwrappedVastTag(s,null,null,null,null,null,null);u?(e.push({vastXml:u,adId:l,duration:s.durationMsecs/1e3}),r=Math.max(s.durationMsecs,r)):a.warn(o,"Failed to get unwrapped xml from internal vast object")}e.length>0&&(m+=r,C.vastXmls.push({sequence:parseInt(t),vastSeqData:e,duration:r/1e3}))}m/=1e3,C.vastXmls.length>0&&C.vastXmls.sort((function(e,t){return e.sequence-t.sequence}))}else C.xml&&C.xml.length>0&&(e.push({vastXml:C.xml,adId:"<unknown>",duration:0}),C.vastXmls.push({sequence:1,vastSeqData:e,duration:0}))}var v,m,y,b,A,w,k=s,T=r,S=t,C=e,V=-1,E=!1,x=!1,N=!1,I=!1,_=document.getElementById("apn-break-cover"),P=document.getElementById("apn-break-spinner"),M=!1,L=document.getElementById("apn-ad-indicator");_||((_=document.createElement("div")).id="apn-break-cover",_.style.width="100%",_.style.height="100%",_.style.backgroundColor="black",_.style.position="absolute",S.el().appendChild(_)),_.style.display="none",P||((P=document.createElement("div")).id="apn-break-spinner",P.className="vjs-loading-spinner",P.style.display="none",S.el().appendChild(P)),L||((L=document.createElement("p")).id="apn-ad-indicator",L.className="vjs-overlay",L.style.display="none",L.style.left="10px",S.el().appendChild(L)),L.innerHTML="",S.on("trace.message",d),S.on("trace.event",p),S.on("vast.adStart",(function(){N||x||(L.style.display="block",k(C.breakId,{name:"BreakAdStarted",data:{adSequence:b,adId:v.adId}}),a.log(o,"Sequence: "+b+", adId: "+v.vastSeqData[A].adId+", step in sequence = "+(A+1)),l(!1),E=!0,x=!0,w=!0,S.trigger({type:"trace.message",data:{message:"Ad successfully started"}}),T.playerSettings.autostart=!0)})),S.on("vast.adError",(function(e){N||(I=!0,e.error||(e.error={code:"Unknown",message:""}),k(C.breakId,{name:"BreakAdError",data:{adSequence:b,adId:v.adId,errorCode:e.error.code,message:e.error.message}}),a.log(o,"Sequence: "+b+", adId: "+v.vastSeqData[A].adId+", step in sequence = "+(A+1)),S.trigger({type:"trace.message",data:{message:"Ad failed. error code - "+e.error.code+". error message - "+e.error.message}}))})),S.on("vast.adsCancel",(function(){})),S.on("vast.adSkip",(function(){N||(k(C.breakId,{name:"BreakAdSkipped",data:{adSequence:b,adId:v.adId}}),a.log(o,"Sequence: "+b+", adId: "+v.vastSeqData[A].adId+", step in sequence = "+(A+1)),S.trigger({type:"trace.message",data:{message:"Ad skipped"}}))})),S.on("vast.reset",(function(){})),S.on("vast.contentEnd",(function(){N||(k(C.breakId,{name:"BreakAdComplete",data:{adSequence:b,adId:v.adId}}),a.log(o,"Sequence: "+b+", adId: "+v.vastSeqData[A].adId+", step in sequence = "+(A+1)),S.trigger({type:"trace.message",data:{message:"Ad content complete"}}))})),S.on("adFinished",(function(){k(C.breakId,{name:"BreakAdStopped",data:{adSequence:b,adId:v.adId}}),a.log(o,"Sequence: "+b+", adId: "+v.vastSeqData[A].adId+", step in sequence = "+(A+1)),N=!0,S.trigger({type:"trace.message",data:{message:I?"*** AD TERMINATED":"*** AD FINISHED"}}),T.playerSettings.muted=S.muted(),f()}));var R=function(e){var t={adTagXML:function(t){setTimeout((function(){t(null,e)}),0)},playAdAlways:!1,adCancelTimeout:T&&T.timeouts&&T.timeouts.adStartTimeout?T.timeouts.adStartTimeout:3e3,adsEnabled:!0,verbosity:4,playsInBreak:!0,breakDuration:parseInt(m),timeOffset:parseInt(y),initialPlayback:T.playerSettings.autostart?"auto":"click",initialAudio:T.playerSettings.muted?"off":"on"};T&&T.skippable&&T.skippable.hasOwnProperty("enabled")&&!T.skippable.enabled&&(t.disableSkippability=!0),T&&T.skippable&&T.skippable.skipText&&(t.skipText=T.skippable.skipText),T&&T.skippable&&T.skippable.skipButtonText&&(t.skipButtonText=T.skippable.skipButtonText),T&&!1===T.clickThruEnabled&&(t.disableClickThru=!0),T&&T.wrapperLimit&&T.wrapperLimit>0&&(t.wrapperLimit=T.wrapperLimit),N=!1,x=!1,S.trigger({type:"trace.message",data:{message:"*** AD STARTING Creative "+v.vastSeqData[A].adId+" (SLOT: "+b+", waterfall step# "+(A+1)+")"}}),S.vastClient(t),"click"!==t.initialPlayback&&setTimeout((function(){I?(I=!1,S.trigger("vast.firstPlay")):S.trigger("vast.firstPlay")}),0)};g(),this.start=function(){y=0;var e=h();e?(S.currentSource(),b=e.sequence?e.sequence:1,A=0,w=!1,v=e,V=1,L.innerHTML="Ad 1 of "+C.vastXmls.length,l(!0),k(C.breakId,{name:"BreakStarted"}),c("breakStart"),R(v.vastSeqData[A].vastXml)):(c("error",{code:900,message:"No Ads in the break"}),k(C.breakId,{name:"BreakError",data:{errorCode:900,message:"No available AD VAST XML for ad break"}}))},this.stop=function(){C.vastXmls=[],V>=0&&S.trigger("vast.adsCancel")},this.test=function(){return{showCover:l,getTrackingUrls:u,playAd:R,prepareNextAd:f,getNextAdXml:h,getVastXmls:g,setOptions:function(e){T=e},prepareInternalData:function(){b=null;var e=h();e&&(b=e.sequence?e.sequence:1,A=0,w=!1,v=e)},setNotifCallback:function(e){k=e},getBreakData:function(){return C}}}}},function(e,t,r){var n=r(6),i=r(7),a=r(8),o=r(9)(),s=function(e,t,s){function l(e,t){if(e&&e.length>0)for(var r=0;r<e.length;r++)e[r]=e[r].replace("[ERRORCODE]",t)}function u(e,t){for(var r=e,n="AD DETECTED="+("SUCCESS"===t.substr(0,7)?"SUCCESS":"NONE")+" :: Reason="+t+", playerTechnology="+(K.hasOwnProperty("playerTechnology")?JSON.stringify(K.playerTechnology):"unknown")+", platform="+Pe.getPlatformType()+", Ad tree path=",i="";-1!==r;){var a=Ne[r].children[0];if(a){var o=Ce.getNodeAttributeValue(a,"id");i.length>0&&(i=" -> "+i),i=o+i}r=Ne[r].parentIdx}G.info(Q,n+i)}function c(e){var t=Ce.getSubNode(e,"VASTAdTagURI");if(!t)return u(Ie,"INVALID WRAPPER NODE"),void(0===Ne.length?T("300","invalid wrapper node"):S());var n=Ce.getNodeValues(t);if(!n||0===n.length)return u(Ie,"EMPTY VASTAdTagURI"),void(0===Ne.length?T("300","Invalid VASTAdTagURI node value"):S());if(_e)return u(Ie,"terminated"),void $(!1,re,"terminated",null,Be);if(Ve=!0,Ee>="4.0"){var i=Ce.getNodeAttributeBooleanValue(e,"followAdditionalWrappers",!0);Ne[Ie].state.followAdditionalWrappers=i,i=Ce.getNodeAttributeBooleanValue(e,"allowMultipleAds",!1),Ne[Ie].state.allowMultipleAds=i,""!==(i=Ce.getNodeAttributeValue(e,"fallbackOnNoAd"))&&(Y=Ce.getNodeAttributeBooleanValue(e,"fallbackOnNoAd"))}Je=n,r(11).load(n,(function(e,t){return _e?(u(Ie,"terminated"),void $(!1,re,"terminated",null,Be)):void(e||0===t.length?(u(Ie,"VASTAdTagURI TIMED OUT: "+n),0===Ne.length?T("301","Timeout of VAST URI provided in wrapper element"):S()):(Re=!1,_(t)))}),K.adServerTimeout?K.adServerTimeout:ne)}function d(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function p(e,t){if(e){var r=Ce.getSubNodes(e,"Error");if(r)for(var n=0;n<r.length;n++){var i=r[n],a=Ce.getNodeValues(i);a&&!d(t,a)&&t.push(a)}}}function f(e,t){if(e){var r=Ce.getSubNodes(e,"Impression");if(r)for(var n=0;n<r.length;n++){var i=r[n],a=Ce.getNodeValues(i);a&&!d(t,a)&&t.push(a)}}}function h(e,t){if(e){var r=Ce.getSubNode(e,"Linear",0);if(r){var n=Ce.getSubNode(r,"TrackingEvents");if(n){var i=Ce.getSubNodes(n,"Tracking");if(i)for(var a=0;a<i.length;a++){n=i[a];var o=Ce.getNodeValues(n);if(o){var s=Ce.getNodeAttributeValue(n,"event");if("progress"===s){var l=Ce.getNodeAttributeValue(n,"offset");s=l?"progress_"+l:""}s&&(t.hasOwnProperty(s)?d(t[s],o)||t[s].push(o):(t[s]=[],t[s].push(o)))}}}}}}function g(e,t){if(e){var r=Ce.getSubNode(e,"CompanionAds");r&&(r.innerHTML&&r.innerHTML.length>0||r.textContent&&r.textContent.length>0)&&i.parse(Ne[t].state.companions,r,Ce)}}function v(e,t){if(e){var r=Ce.getSubNode(e,"Icons");r&&(r.innerHTML&&r.innerHTML.length>0||r.textContent&&r.textContent.length>0)&&a.parse(Ne[t].state.icons,r,Ce)}}function m(e,t,r){if(e){var n=Ce.getSubNode(e,"Linear",0);if(n){var i=null,a=Ce.getSubNode(n,"VideoClicks");if(a){var o=Ce.getSubNode(a,"ClickThrough");o&&((i=Ce.getNodeValues(o))&&!d(t,i)&&t.push(i));var s=Ce.getSubNodes(a,"ClickTracking");if(s)for(var l=0;l<s.length;l++)o=s[l],(i=Ce.getNodeValues(o))&&!d(r,i)&&r.push(i)}}}}function y(e,t){if(e){var r=Ce.getSubNode(e,"ViewableImpression",0);if(r){var n,i=null,a=null,o=Ce.getSubNodes(r,"Viewable");if(o&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.viewable,i)&&t.viewable.push(i);if((o=Ce.getSubNodes(r,"NotViewable"))&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.notViewable,i)&&t.notViewable.push(i);if((o=Ce.getSubNodes(r,"ViewUndetermined"))&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.undetermined,i)&&t.undetermined.push(i)}}}function b(e){return"video/x-flv"===e||"video/x-f4v"===e||"video/f4v"===e||"application/x-shockwave-flash"===e}function A(e){return"video/webm"===e||"video/ogg"===e||"application/javascript"===e||"application/x-javascript"===e}function w(e,t,r,n){var i=null;if(e){if((i={}).type=Ce.getNodeAttributeValue(e,"type"),-1===n.indexOf(i.type)&&n.push(i.type),!i.type||0===i.type.length)return null;var a=Ce.getNodeAttributeValue(e,"codec");if(a&&a.length>0&&((a=(a=a.trim()).length>2?a:"").length>0&&(i.codec=a)),!function(e,t){return Pe.canPlay(e,t)}(i.type,a))return null;if(K&&!function(e){if(K.playerTechnology&&Array.isArray(K.playerTechnology)&&K.playerTechnology.length>0){for(var t=!1,r=0;r<K.playerTechnology.length;r++){var n=K.playerTechnology[r].toLowerCase();if(!b(e.toLowerCase())&&!A(e.toLowerCase())){t=!0;break}if("flash"===n&&!A(e.toLowerCase())){t=!0;break}if("html5"===n&&!b(e.toLowerCase())){t=!0;break}}if(!t)return!1}return!(K.hasOwnProperty("supportVpaid")&&!K.supportVpaid&&function(e){return"application/x-shockwave-flash"===e||"application/javascript"===e||"application/x-javascript"===e}(e.toLowerCase()))}(i.type))return null;i.url=t,i.variation="Media#"+r,i.delivery=Ce.getNodeAttributeValue(e,"delivery");var o=Ce.getNodeAttributeNumberValue(e,"bitrate",-1);-1!==o&&(i.bitrate=o),i.width=Ce.getNodeAttributeNumberValue(e,"width"),i.height=Ce.getNodeAttributeNumberValue(e,"height");var s=Ce.getNodeAttributeValue(e,"scalable");s.length>0&&(i.scalable=Ce.getNodeAttributeBooleanValue(e,"scalable",!0)),(s=Ce.getNodeAttributeValue(e,"maintainAspectRatio")).length>0&&(i.maintainAspectRatio=Ce.getNodeAttributeBooleanValue(e,"maintainAspectRatio",!0));var l=Ce.getNodeAttributeValue(e,"apiFramework");l&&l.length>0&&(i.apiFramework=l.toUpperCase())}return i}function k(e){ge=0,ve="",he="",ie=[],ae=null,oe=[];var t="",r=[];if(e){var n=Ce.getSubNode(e,"Linear",0);if(n){var i=Ce.getSubNode(n,"Duration");if(i){var a=Ce.getNodeValue(i);ge=function(e,t){var r=e.indexOf("%");if(r>0)return t&&t>0?Number(e.substring(0,r)):0;var n=(r=e.indexOf("."))>0?Number(e.substring(r+1)):0;r>0&&(e=e.substring(0,r));var i=e.split(":");return 3===i.length?1e3*(3600*Number(i[0])+60*Number(i[1])+Number(i[2]))+n:0}(a,-1)}var o=Ce.getNodeAttributeValue(n,"skipoffset");if(ve=o,he=Ce.getSubNodeWholeValue(n,"AdParameters",""),i=Ce.getSubNode(n,"MediaFiles")){var s,l=Ce.getSubNodes(i,"MediaFile");if(l){for(var u=0;u<l.length;u++)if(i=l[u],(s=Ce.getNodeValues(i)).length>0){var c=w(i,s,u,r);c&&ie.push(c)}if(0===ie.length)t="INCOMPATIBLE MEDIA TYPE, Available = "+JSON.stringify(r);else{i=Ce.getSubNode(n,"MediaFiles"),ae=Ce.getSubNodeWholeValue(i,"Mezzanine","");var d=Ce.getSubNodes(i,"InteractiveCreativeFile");if(d&&d.length>0)for(var p=0;p<d.length;p++){var f=d[p];if(s=Ce.getNodeValues(f)){var h=Ce.getNodeAttributeValue(f,"type"),g=Ce.getNodeAttributeValue(f,"apiFramework");oe.push({url:s,type:h,apiFramework:g})}}}}else t="MISSING MEDIA FILES"}else t="MISSING MEDIA FILES"}else t="INVALID VAST STRUCTURE"}return t}function T(e,t){var r=de.concat(pe);l(r,e),ye&&ye.length>0&&(l(ye,"303"),r=r.concat(ye)),G.error(Q,"Error "+e+" - "+t),$(!1,re,"vast"+e,r,Be)}function S(){var e=Ne[Ie].state;if(e&&Array.isArray(e.arrErrorUrls)&&e.arrErrorUrls.forEach((function(e){pe.push(e)})),Ie>=0){if(Ne[Ie].children[0]=null,Ne[Ie].children.splice(0,1),0===Ne[Ie].children.length){var t=Ne[Ie].parentIdx;return Ne.splice(Ie,1),-1===(Ie=t)?void(Me&&Le.length>0?(G.info(Q,"Waterfall: Vast XML node count detected: # csm nodes: "+He+", # rtb nodes: "+We),$(!0,re,Le,null)):ze&&Le.length>0?(G.info(Q,"VMAP: Ad XML node count detected: "+Le.length),$(!0,re,Le,null)):T("900","no Ad available")):void S()}ee=Ie,Ne[Ie].state=C(),z(Ne[Ie].children[0])}}function C(){return{arrTrackings:{},arrImpressions:[],arrClickUrls:[],arrClickTrackings:[],arrErrorUrls:[],sExtensions:"",sequence:ze?0:1,companions:{required:"unknown",companions:[]},icons:[],arrViewableImpressions:{viewable:[],notViewable:[],undetermined:[]}}}function V(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"notifyurl");r&&r.length>0&&(Oe[t]=r)}}function E(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"creativeId");r&&r.length>0&&(Xe[t]=r)}}function x(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"buyerMemberId");r&&r.length>0&&(Ue[t]=r)}}function N(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"viewabilityConfig");r&&r.length>0&&(Fe[t]=r)}}function I(){if(me&&me.length>0)for(var e=0;e<me.length;e++){var t=me[e],r=Ce.getNodeValues(t);r&&!d(ye,r)&&ye.push(r)}}function _(e){(new Date).getTime(),ye=[],te=e;var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r.trim()}(e);if(0===t.length)return u(Ie,"EMPTY VAST"),void(0===Ne.length?T("110","no bid response for mediation"):S());var r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{G.error(Q,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","VAST XML parsing error"):S())}}else{if(void 0===window.ActiveXObject)return G.error(Q,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)"),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","Failed to get vast xml"):S());try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return G.error(Q,r.parseError),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100",r.parseError.errorCode+", Error reason = "+r.parseError.reason):S())}catch(e){return G.error(Q,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)"):S())}}if(!r)return u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("102","VAST XML parsing error"):S());var n=Ce.getSubNode(r,"VAST");if(!n||!n.firstChild)return u(Ie,"EMPTY VAST"),void(0===Ne.length?T("110","no bid response for mediation"):S());me=Ce.getSubNodes(n,"Error");var i=function(e){var t="unknown";return e&&(t=(t=Ce.getNodeAttributeValue(e,"version")).trim()).length>3&&(t=t.substr(0,3)),t}(n);if(function(e){return"2.0"===e||"3.0"===e||"4.0"===e||"4.1"===e}(i)){Re&&((Me=Ce.getNodeAttributeBooleanValue(n,"apn_waterfall"))&&(K.waterfall=!0));var a=Ce.getSubNodes(n,"Ad");if(!a||0===a.length)return I(),u(Ie,"NO AD NODE"),void(0===Ne.length?T("900","no Ad available"):S());for(var o=[],s=0;s<a.length;s++){if(Re){var l=Ce.getNodeAttributeValue(a[s],"id");l&&(l+="_suffix"+s,a[s].id=l)}if(Ee>="4.0"&&Ie>0&&!Ne[Ie].state.allowMultiAds){if(Ce.getNodeAttributeValue(a[s],"sequence"))continue;if(o.length>0)break}o.push(a[s]),Me&&Re&&V(a[s]),Re&&(x(a[s]),E(a[s]),N(a[s]))}if(0===o.length)return I(),u(Ie,"NO VALID AD NODES"),void(0===Ne.length?T("900","no Ad available"):S());var c={parentIdx:Ie,currentIdx:0,children:o,state:C()};Ne.push(c),c.currentIdx=Ne.length-1,Ie=c.currentIdx,z(Ne[Ie].children[0],i)}else u(Ie,"INVALID VAST VERSION: "+i),0===Ne.length?T("102","VAST version not supported"):S()}function P(e){for(var t in Ne[e].state.arrTrackings)for(var r=0;r<Ne[e].state.arrTrackings[t].length;r++)be.hasOwnProperty(t)?d(be[t],Ne[e].state.arrTrackings[t][r])||be[t].push(Ne[e].state.arrTrackings[t][r]):(be[t]=[],be[t].push(Ne[e].state.arrTrackings[t][r]));return be}function M(e){for(var t=0;t<Ne[e].state.arrImpressions.length;t++)d(Ae,Ne[e].state.arrImpressions[t])||Ae.push(Ne[e].state.arrImpressions[t]);return Ae}function L(e){for(var t=0;t<Ne[e].state.arrClickUrls.length;t++)d(we,Ne[e].state.arrClickUrls[t])||we.push(Ne[e].state.arrClickUrls[t]);return we}function R(e){for(var t=0;t<Ne[e].state.arrClickTrackings.length;t++)d(ke,Ne[e].state.arrClickTrackings[t])||ke.push(Ne[e].state.arrClickTrackings[t]);return ke}function O(e){for(var t=0;t<Ne[e].state.arrErrorUrls.length;t++)d(Te,Ne[e].state.arrErrorUrls[t])||Te.push(Ne[e].state.arrErrorUrls[t]);return Te}function B(e){return Ne[e].state.sExtensions.length>0&&(fe+=Ne[e].state.sExtensions),fe}function U(e){for(var t=e;t>0;){var r=Ne[t].parentIdx;i.mergeCompanions(Ne[r].state.companions,Ne[t].state.companions),t=r}return"unknown"===Ne[t].state.companions.required&&delete Ne[t].state.companions.required,Ne[t].state.companions}function D(e){for(var t={required:"unknown",companions:[]},r=e;r>=0;)i.mergeCompanions(t,Ne[r].state.companions),r=Ne[r].parentIdx;return t}function F(e,t){for(var r=0;r<e.length;r++)if(e[r].program.toLowerCase()===t.toLowerCase())return!0;return!1}function j(e,t){for(var r=0;r<e.length;r++)if(e[r].program.toLowerCase()===t.toLowerCase())return void e.splice(r,1)}function X(e){for(var t=e;t>0;){for(var r=Ne[t].parentIdx,n=0;n<Ne[t].state.icons.length;n++)F(Ne[r].state.icons,Ne[t].state.icons[n].program)&&j(Ne[r].state.icons,Ne[t].state.icons[n].program),Ne[r].state.icons.push(Ne[t].state.icons[n]);t=r}return Ne[t].state.icons}function q(e){for(var t=[],r=e;r>=0;){for(var n=0;n<Ne[r].state.icons.length;n++)F(t,Ne[r].state.icons[n].program)||t.push(Ne[r].state.icons[n]);r=Ne[r].parentIdx}return t}function H(e){var t;for(t=0;t<Ne[e].state.arrViewableImpressions.viewable.length;t++)d(Se.viewable,Ne[e].state.arrViewableImpressions.viewable[t])||Se.viewable.push(Ne[e].state.arrViewableImpressions.viewable[t]);for(t=0;t<Ne[e].state.arrViewableImpressions.notViewable.length;t++)d(Se.notViewable,Ne[e].state.arrViewableImpressions.notViewable[t])||Se.notViewable.push(Ne[e].state.arrViewableImpressions.notViewable[t]);for(t=0;t<Ne[e].state.arrViewableImpressions.undetermined.length;t++)d(Se.undetermined,Ne[e].state.arrViewableImpressions.undetermined[t])||Se.undetermined.push(Ne[e].state.arrViewableImpressions.undetermined[t]);return Se}function W(e){var t=e,r=t.indexOf("_suffix");return r>0&&(t=t.substring(0,r)),t}function z(e,t){var r=Ce.getSubNode(e,"Wrapper"),n=null!==r;if(n||(r=Ce.getSubNode(e,"InLine")),!r)return I(),u(Ie,"MISSING WRAPPER / INLINE NODE"),void S();if(++ee>Z)return u(Ie,"Reach Wrapper limit"),void S();t>Ee&&(Ee=t);var i=Ce.getNodeAttributeValue(e,"id");if(Oe.hasOwnProperty(i)&&(Be=Oe[i]),Xe.hasOwnProperty(i)&&(qe=Xe[i]),Ue.hasOwnProperty(i)&&(De=Ue[i]),Fe.hasOwnProperty(i)&&(je=Fe[i]),0===Ie){var a=Ce.getNodeAttributeValue(e,"sequence");a&&(Ne[Ie].state.sequence=parseInt(a)),Ce.getNodeAttributeValue(e,"conditionalAd")&&(xe=Ce.getNodeAttributeBooleanValue(e,"conditionalAd"))}if(p(r,Ne[Ie].state.arrErrorUrls),f(r,Ne[Ie].state.arrImpressions),h(r,Ne[Ie].state.arrTrackings),m(r,Ne[Ie].state.arrClickUrls,Ne[Ie].state.arrClickTrackings),function(e,t){if(e){var r=Ce.getSubNode(e,"Extensions");r&&r.innerHTML&&r.innerHTML.length>0?Ne[t].state.sExtensions=Ne[t].state.sExtensions+r.innerHTML.toString():r&&r.textContent&&r.textContent.length>0&&(Ne[t].state.sExtensions=Ne[t].state.sExtensions+r.textContent.toString())}}(r,Ie),g(r,Ie),v(r,Ie),y(r,Ne[Ie].state.arrViewableImpressions),pe=[],n){if(Ee>="4.0"&&Ie>0&&!Ne[Ie-1].state.followAdditionalWrappers)return u(Ie,"Additional Wrappers are not allowed"),void S();c(r)}else{var o=k(r);if(0===ie.length||o.length>0)return u(Ie,o),void S();be=JSON.parse(JSON.stringify(se)),Ae=le.slice(0),we=ue.slice(0),ke=ce.slice(0),Te=de.slice(0),fe="";var s=JSON.stringify(function(e){for(var t=e;t>=0;)P(t),t=Ne[t].parentIdx;return be}(Ne[Ie].parentIdx)),l=JSON.stringify(function(e){for(var t=e;t>=0;)M(t),t=Ne[t].parentIdx;return Ae}(Ne[Ie].parentIdx)),d=JSON.stringify(function(e){for(var t=e;t>=0;)L(t),t=Ne[t].parentIdx;return we}(Ne[Ie].parentIdx)),b=JSON.stringify(function(e){for(var t=e;t>=0;)R(t),t=Ne[t].parentIdx;return ke}(Ne[Ie].parentIdx)),A=JSON.stringify(function(e){for(var t=e;t>=0;)O(t),t=Ne[t].parentIdx;return Te}(Ne[Ie].parentIdx)),w=function(e){for(var t=e;t>=0;)B(t),t=Ne[t].parentIdx;return fe}(Ne[Ie].parentIdx),T=JSON.stringify(D(Ne[Ie].parentIdx)),C=JSON.stringify(q(Ne[Ie].parentIdx));fe="";var V=U(Ie);V=function(e){var t,r,n,i=[],a=[],o=e.companions;if(!e.companions)return e;for(r=o.length-1;r>=0;r--)if((t=o[r]).StaticResource||t.IFrameResource||t.HTMLResource){var s=!1;for(n=0;n<i.length;n++)if(t.width===i[n].width&&t.height===i[n].height){s=!0;break}s||i.push(t)}else a.push(t);for(r=0;r<a.length;r++)for(n=0;n<i.length;n++)a[r].width===i[n].width&&a[r].height===i[n].height&&(a[r].id&&a[r].id===i[n].id||!a[r].id)&&(a[r].CompanionClickTracking&&(i[n].CompanionClickTracking||(i[n].CompanionClickTracking=[]),i[n].CompanionClickTracking=i[n].CompanionClickTracking.concat(a[r].CompanionClickTracking)),a[r].TrackingEvents&&(i[n].TrackingEvents||(i[n].TrackingEvents=[]),i[n].TrackingEvents=i[n].TrackingEvents.concat(a[r].TrackingEvents)));var l={companions:i};return e.required&&(l.required=e.required),l}(V);var E={vastVersion:Ee,withWrapper:Ve,mediaFiles:ie,trackingUrls:P(Ie),impressionUrls:M(Ie),clickUrls:L(Ie),clickTrackingUrls:R(Ie),errorUrls:O(Ie),durationMsecs:ge,skipOffset:ve,extensions:B(Ie),adParameters:he,vastXml:te,extTrackingUrls:s,extImpressionUrls:l,extClickUrls:d,extClickTrackingUrls:b,extErrorUrls:A,extExtensions:w,adId:W(i),sequence:Ne[0].state.sequence,companionAds:V,extCompanions:T,icons:X(Ie),extIcons:C,finalVastUri:Je};if(Ee.substr(0,1)>"3"){var x=function(e){var t=Ce.getSubNodes(e,"Creative");if(t&&t.length>0)for(var r=0;r<t.length;r++)if(Ce.getSubNode(t[r],"Linear"))return Ce.getSubNode(t[r],"UniversalAdId");return null}(r);if(x){var N=Ce.getNodeAttributeValue(x,"idRegistry"),_=Ce.getNodeAttributeValue(x,"idValue");if(0===N.length||0===_.length)return u(Ie,"universalAdId is invalid"),void S();E.universalAdId={idRegistry:N,idValue:_}}E.conditionalAd=xe;var F=function(e){var t=[],r=Ce.getSubNodes(e,"Category");if(r&&r.length>0)for(var n=0;n<r.length;n++){var i=Ce.getNodeValues(r[n]);if(i&&i.length>0){var a=Ce.getNodeAttributeValue(r[n],"authority");t.push({category:i,authority:a})}}return t.length>0?t:null}(r);if(F){for(var j=0;j<F.length;j++)if(!F[j].category||!F[j].authority)return u(Ie,"invalid Category node"),void S();E.categories=F}var z=JSON.stringify(function(e){for(var t=e;t>=0;)H(t),t=Ne[t].parentIdx;return Se}(Ne[Ie].parentIdx)),G=H(Ie);G&&G.viewable.length+G.notViewable.length+G.undetermined.length>0&&(E.extViewableImpression=z,E.viewableImpression=G);var Q=function(e){var t=[],r=Ce.getSubNode(e,"AdVerifications");if(r){var n=Ce.getSubNodes(r,"Verification");if(n&&n.length>0)for(var i=0;i<n.length;i++){var a,o,s,l=n[i],u=Ce.getNodeAttributeValue(l,"vendor"),c=[],d=[],p=Ce.getSubNodes(l,"JavaScriptResource");if(p&&p.length>0)for(s=0;s<p.length;s++){a=Ce.getNodeValues(p[s]);var f=Ce.getNodeAttributeValue(p[s],"apiFramework"),h=Ce.getNodeAttributeBooleanValue(p[s],"browserOptional");c.push({url:a,framework:f,browserOptional:h})}if((p=Ce.getSubNodes(l,"FlashResource"))&&p.length>0)for(s=0;s<p.length;s++)a=Ce.getNodeValues(p[s]),o=Ce.getNodeAttributeValue(p[s],"apiFramework"),d.push({url:a,framework:o});var g=Ce.getSubNodeWholeValue(l,"ViewableImpression"),v={},m=!1,y=Ce.getSubNode(l,"TrackingEvents");if(y){var b=Ce.getSubNodes(y,"Tracking");if(b&&b.length>0)for(s=0;s<b.length;s++){a=Ce.getNodeValues(b[s]);var A=Ce.getNodeAttributeValue(b[s],"event");A&&a&&(m=!0,v.hasOwnProperty(A)?v[A].push(a):v[A]=[a])}}var w=Ce.getSubNodeWholeValue(l,"VerificationParameters"),k={};u&&(k.vendor=u),c.length>0&&(k.jsResources=c),d.length>0&&(k.flashResources=d),g&&(k.viewableImpression=g),m&&(k.trackingEvents=v),w&&(k.verificationParameters=w),t.push(k)}}return t.length>0?t:null}(r);Q&&Q.length>0&&(E.adVerifications=Q),ae&&(E.mezzanine=ae),oe&&oe.length>0&&(E.interactiveCreativeFiles=oe),void 0!==Y&&(E.fallbackOnNoAd=Y)}Me&&Be.length>0&&(E.notifyurl=Be),qe.length>0&&(E.creative_id=qe),De.length>0&&(E.buyerMemberId=De),je.length>0&&(E.viewabilityConfig=je);var K=!1;if(Me){var ne=Ce.getNodeAttributeValue(e,"rtb");ne&&"true"===ne&&(K=!0,E.rtb=!0)}if(_e)return u(Ie,"terminated"),void $(!1,re,"terminated",null,Be);for(var me=[],ye=0;ye<ie.length;ye++)-1===me.indexOf(ie[ye].type)&&me.push(ie[ye].type);u(Ie,"SUCCESS, Available="+JSON.stringify(me)),Me?(Le.push(E),K?We++:He++,S()):ze?(E.vastXml=J(E.vastXml,E.sequence),Le.push(E),S()):$(!0,re,E,null)}}function J(e,t){for(var r=(new DOMParser).parseFromString(e,"text/xml"),n=Ce.getSubNode(r,"VAST"),i=Ce.getSubNodes(n,"Ad"),a=0;a<i.length;){var s=Ce.getNodeAttributeValue(i[a],"sequence");s&&parseInt(s)!==t?n.removeChild(i[a]):a++}return"ie"===o.browser.name.toLowerCase()?(new XMLSerializer).serializeToString(r.childNodes[0]):r.childNodes[0].outerHTML}var Y,G=r(3),Q="VAST Parser",$=null,K=s,Z=K&&K.wrapperLimit&&K.wrapperLimit>0?K.wrapperLimit:5,ee=0,te=null,re=e,ne=t&&t>0?t:1e3,ie=[],ae=null,oe=[],se={},le=[],ue=[],ce=[],de=[],pe=[],fe="",he="",ge=0,ve="",me=null,ye=[],be={},Ae=[],we=[],ke=[],Te=[],Se={viewable:[],notViewable:[],undetermined:[]},Ce=new n,Ve=!1,Ee="",xe=!1,Ne=[],Ie=-1,_e=!1,Pe=r(10),Me=!1,Le=[],Re=!1,Oe={},Be="",Ue={},De="",Fe={},je="",Xe={},qe="",He=0,We=0,ze=s.vmap,Je="";G.always(Q,"Version 3.1.17"),this.parse=function(e,t,r,n){$=n,function(e,t){var r,n,i,a;if(t&&le.push(t.trim()),e)if(Array.isArray(e)&&1===e.length){var o=e[0];if(o.impression_urls)for(n=0;n<o.impression_urls.length;n++)r=o.impression_urls[n].trim(),le.push(r);if(o.error_urls)for(n=0;n<o.error_urls.length;n++)r=o.error_urls[n].trim(),de.push(r);if(o.video_click_urls)for(n=0;n<o.video_click_urls.length;n++)r=o.video_click_urls[n].trim(),ce.push(r);for(a in o.video_events)for(i=o.video_events[a],n=0;n<i.length;n++)r=i[n].trim(),se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r]}else for(a in e)if("service"!==a)if(Array.isArray(e[a]))for(i=e[a],n=0;n<i.length;n++)r=i[n].trim(),"click"===a?ce.push(r):"error"===a?de.push(r):"impression"===a?le.push(r):se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r];else r=e[a].trim(),"click"===a?ce.push(r):"error"===a?de.push(r):"impression"===a?le.push(r):se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r]}(t,r),Re=!0,_(e)},this.terminate=function(){_e=!0}},l=r(14),u=r(15);e.exports={parse:function(e,t,r,n,i,a,o){var l=new s(r,n,o);return l.parse(e,i,a,(function(e,r,n,i,a){t&&t(e,r,n,i,a),l=null})),l},getUnwrappedVastTag:function(e,t,r,n,i,a,o,s){if(!e||!e.vastXml)return null;var u=new l(e,t,r,n,i,a,o,s),c=u.addTrackers();return u=null,c},getMergedVastTag:function(e){if(!e||0===e.length)return null;var t=new u(e),r=t.getVastXml();return t=null,r}}},function(e,t){e.exports=function(){this.getSubNodes=function(e,t){var r=e.getElementsByTagName(t);return r.length>0?r:null},this.getSubNode=function(e,t,r){r||(r=0);var n=e.getElementsByTagName(t);return n.length>r?n[r]:null},this.getNodeValue=function(e){if(0===e.childNodes.length)return"";var t=e.childNodes[0].nodeValue;return t?t.trim():""},this.getNodeValues=function(e){if(0===e.childNodes.length)return"";for(var t="",r=0;r<e.childNodes.length;r++){var n=e.childNodes[r].nodeValue;n&&(t+=n)}return t.trim()},this.getNodeAttributeValue=function(e,t){var r=e.getAttribute(t);return null===r&&(r=""),r},this.getNodeAttributeNumberValue=function(e,t,r){r||(r=0);var n=r,i=this.getNodeAttributeValue(e,t);return i.length>0&&(n=i.indexOf(".")>=0?parseFloat(i):parseInt(i)),n},this.getNodeAttributeBooleanValue=function(e,t,r){r||(r=!1);var n=r,i=this.getNodeAttributeValue(e,t);i.length>0&&(n="t"===i.toLowerCase().charAt(0));return n},this.getSubNodeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValue(n):r},this.getSubNodeWholeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValues(n):r},this.getSubNodeBooleanValue=function(e,t,r){r=void 0===r?"false":r;var n=this.getSubNodeValue(e,t);return n.length>0&&"t"===n.toLowerCase().charAt(0)||!(n.length>0&&"f"===n.toLowerCase().charAt(0))&&r}}},function(e,t){var r={parse:function(e,t,r){var n=r.getNodeAttributeValue(t,"required");n&&n.length>0&&(e.required=n);var i=r.getSubNodes(t,"Companion");if(i)for(var a=0;a<i.length;a++){var o=i[a],s={},l=r.getNodeAttributeNumberValue(o,"width",-1),u=r.getNodeAttributeNumberValue(o,"height",-1);if(!(l<=0||u<=0)){s.width=l,s.height=u;var c=r.getNodeAttributeValue(o,"id");c&&(s.id=c),(c=r.getNodeAttributeNumberValue(o,"assetWidth",-1))>0&&(s.assetWidth=c),(c=r.getNodeAttributeNumberValue(o,"assetHeight",-1))>0&&(s.assetHeight=c),(c=r.getNodeAttributeNumberValue(o,"expandedWidth",-1))>0&&(s.expandedWidth=c),(c=r.getNodeAttributeNumberValue(o,"expandedHeight",-1))>0&&(s.expandedHeight=c),(c=r.getNodeAttributeValue(o,"apiFramework"))&&(s.apiFramework=c),(c=r.getNodeAttributeValue(o,"adSlotID"))&&(s.adSlotID=c);var d=r.getNodeAttributeNumberValue(o,"pxratio",1);1!==d&&(s.pxratio=d),(c=r.getNodeAttributeValue(o,"required"))&&(s.required=c),(c=r.getSubNodeValue(o,"AltText"))&&(s.AltText=c),(c=r.getSubNodeValue(o,"AdParameters"))&&(s.AdParameters=c);var p=r.getSubNode(o,"StaticResource");if(p&&(c=r.getNodeAttributeValue(p,"creativeType"))){var f="video/x-flv"===c||"video/x-f4v"===c||"video/f4v"===c||"application/x-shockwave-flash"===c,h=!1;if(/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(h=!0),h&&f)continue;var g={type:c};(c=r.getNodeValues(p))&&(g.src=c,s.StaticResource=g)}(c=r.getSubNodeWholeValue(o,"IFrameResource"))&&(s.IFrameResource=c),(c=r.getSubNodeWholeValue(o,"HTMLResource"))&&(s.HTMLResource=c),(c=r.getSubNodeValue(o,"CompanionClickThrough"))&&(s.CompanionClickThrough=c);var v,m,y,b=r.getSubNodes(o,"CompanionClickTracking");if(b)for(s.CompanionClickTracking=[],v=0;v<b.length;v++)m=b[v],(y=r.getNodeValues(m))&&s.CompanionClickTracking.push(y);var A=r.getSubNodes(o,"Tracking");if(A)for(s.TrackingEvents=[],v=0;v<A.length;v++){m=A[v];var w=r.getNodeAttributeValue(m,"event");y=r.getNodeValues(m),w&&y&&s.TrackingEvents.push({eventType:w,url:y})}e.companions.push(s)}}},mergeCompanions:function(e,t){"unknown"===e.required&&(e.required=t.required),e.companions=e.companions.concat(t.companions)},createCompanionNode:function(e,t){var r,n,i,a,o=e.createElement("Companion"),s=["id","width","height","assetWidth","assetHeight","expandedWidth","expandedHeight","apiFramework","adSlotID","required"];for(r=0;r<s.length;r++)t.hasOwnProperty(s[r])&&((i=e.createAttribute(s[r])).value=t[s[r]],o.setAttributeNode(i));t.hasOwnProperty("StaticResource")&&(n=e.createElement("StaticResource"),(i=e.createAttribute("creativeType")).value=t.StaticResource.type,n.setAttributeNode(i),a=e.createCDATASection(t.StaticResource.src),n.appendChild(a),o.appendChild(n));var l=["AdParameters","IFrameResource","HTMLResource","CompanionClickThrough"];for(r=0;r<l.length;r++)t.hasOwnProperty(l[r])&&(n=e.createElement(l[r]),a=e.createCDATASection(t[l[r]]),n.appendChild(a),o.appendChild(n));if(t.hasOwnProperty("AltText")){n=e.createElement("AltText");try{n.innerHTML=t.AltText}catch(e){try{n.textContent=t.AltText}catch(e){}}o.appendChild(n)}if(t.hasOwnProperty("CompanionClickTracking"))for(r=0;r<t.CompanionClickTracking.length;r++){var u=e.createElement("CompanionClickTracking");a=e.createCDATASection(t.CompanionClickTracking[r]),u.appendChild(a),o.appendChild(u)}if(t.hasOwnProperty("TrackingEvents")){for(n=e.createElement("TrackingEvents"),r=0;r<t.TrackingEvents.length;r++){var c=e.createElement("Tracking");(i=e.createAttribute("event")).value=t.TrackingEvents[r].eventType,c.setAttributeNode(i),a=e.createCDATASection(t.TrackingEvents[r].url),c.appendChild(a),n.appendChild(c)}o.appendChild(n)}return o}};e.exports=r},function(e,t){var r={parse:function(e,t,r){var n=r.getSubNodes(t,"Icon");if(n)for(var i=0;i<n.length;i++){var a=n[i],o={},s=r.getNodeAttributeNumberValue(a,"width",-1),l=r.getNodeAttributeNumberValue(a,"height",-1),u=r.getNodeAttributeValue(a,"program"),c=r.getNodeAttributeValue(a,"xPosition"),d=r.getNodeAttributeValue(a,"yPosition");if(!(s<=0||l<=0||0===u.length||0===c.length||0===d.length)){o.width=s,o.height=l,o.program=u,o.xPosition=c,o.yPosition=d;var p=r.getNodeAttributeValue(a,"apiFramework");p&&(o.apiFramework=p);var f=r.getNodeAttributeNumberValue(a,"pxratio",1);if(1!==f&&(o.pxratio=f),p=r.getNodeAttributeValue(a,"offset")){if(isNaN(Date.parse("January 1, 1970 "+p)))continue;o.offset=p}if(p=r.getNodeAttributeValue(a,"duration")){if(isNaN(Date.parse("January 1, 1970 "+p)))continue;o.duration=p}var h=r.getSubNode(a,"StaticResource");if(h&&(p=r.getNodeAttributeValue(h,"creativeType"))){var g="video/x-flv"===p||"video/x-f4v"===p||"video/f4v"===p||"application/x-shockwave-flash"===p,v=!1;if(/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(v=!0),v&&g)continue;var m={type:p};(p=r.getNodeValues(h))&&(m.src=p,o.StaticResource=m)}if((p=r.getSubNodeWholeValue(a,"IFrameResource"))&&(o.IFrameResource=p),(p=r.getSubNodeWholeValue(a,"HTMLResource"))&&(o.HTMLResource=p),o.StaticResource||o.IFrameResource||o.HTMLResource){var y=r.getSubNode(a,"IconClicks");if(y&&((p=r.getSubNodeValue(a,"IconClickThrough"))&&(o.IconClickThrough=p),p=r.getSubNodes(y,"IconClickTracking"))){o.IconClickTracking=[];for(var b=0;b<p.length;b++)o.IconClickTracking.push(r.getNodeValues(p[b]))}var A=r.getSubNodes(a,"IconViewTracking");if(A){o.IconViewTracking=[];for(var w=0;w<A.length;w++)o.IconViewTracking.push(r.getNodeValues(A[w]))}(function(e,t){for(var r=0;r<e.length;r++)e[r].program===t&&e.splice(r,1)})(e,u),e.push(o)}}}},createIconNode:function(e,t){var r,n,i,a,o=e.createElement("Icon"),s=["width","height","program","xPosition","yPosition","apiFramework","offset","duration"];for(r=0;r<s.length;r++)t.hasOwnProperty(s[r])&&((i=e.createAttribute(s[r])).value=t[s[r]],o.setAttributeNode(i));t.hasOwnProperty("StaticResource")&&(n=e.createElement("StaticResource"),(i=e.createAttribute("creativeType")).value=t.StaticResource.type,n.setAttributeNode(i),a=e.createCDATASection(t.StaticResource.src),n.appendChild(a),o.appendChild(n));var l=["IFrameResource","HTMLResource","IconViewTracking"];for(r=0;r<l.length;r++)t.hasOwnProperty(l[r])&&(n=e.createElement(l[r]),a=e.createCDATASection(t[l[r]]),n.appendChild(a),o.appendChild(n));if(t.hasOwnProperty("IconClickThrough")||t.hasOwnProperty("IconClickTracking")){var u=e.createElement("IconClicks");t.hasOwnProperty("IconClickThrough")&&(n=e.createElement("IconClickThrough"),a=e.createCDATASection(t.IconClickThrough),n.appendChild(a),u.appendChild(n)),t.hasOwnProperty("IconClickTracking")&&(n=e.createElement("IconClickTracking"),a=e.createCDATASection(t.IconClickTracking),n.appendChild(a),u.appendChild(n)),o.appendChild(u)}return o}};e.exports=r},function(e,t,r){r(3).always("UserAgentParser","Version 0.0.1");var n=function(e,t){var r="function",i="object",a="model",o="name",s="type",l="vendor",u="version",c="console",d="mobile",p="tablet",f="smarttv",h="wearable",g={extend:function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},v={rgx:function(){var e,t,n,a,o,s,l={},u=0,c=arguments;for(n=0;n<c[1].length;n++)l[typeof(a=c[1][n])===i?a[0]:a]=void 0;for(;u<c.length&&!o;){var d=c[u],p=c[u+1];for(e=t=0;e<d.length&&!o;)if(o=d[e++].exec(this.getUA()))for(n=0;n<p.length;n++)s=o[++t],typeof(a=p[n])===i&&a.length>0?2===a.length?typeof a[1]===r?l[a[0]]=a[1].call(this,s):l[a[0]]=a[1]:3===a.length?typeof a[1]!==r||a[1].exec&&a[1].test?l[a[0]]=s?s.replace(a[1],a[2]):void 0:l[a[0]]=s?a[1].call(this,s,a[2]):void 0:4===a.length&&(l[a[0]]=s?a[3].call(this,s.replace(a[1],a[2])):void 0):l[a]=s||void 0;u+=2}return l},str:function(e,t){for(var r in t)if(typeof t[r]===i&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(g.has(t[r][n],e))return"?"===r?void 0:r}else if(g.has(t[r],e))return"?"===r?void 0:r;return e}},m={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,u],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],u],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],u],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[o,u],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],u],[/(edge)\/((\d+)?[\w\.]+)/i],[o,u],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],u],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],u],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],u],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[u,[o,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],u],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[u,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[o,u],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],u],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],u],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],u],[/;fbav\/([\w\.]+);/i],[u,[o,"Facebook"]],[/fxios\/([\w\.-]+)/i],[u,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[u,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[u,o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[u,v.str,m.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,u],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],u],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,u]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[a,l,[s,p]],[/applecoremedia\/[\w\.]+ \((ipad)/],[a,[l,"Apple"],[s,p]],[/(apple\s{0,1}tv)/i],[[a,"Apple TV"],[l,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[l,a,[s,p]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[a,[l,"Amazon"],[s,p]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[a,v.str,m.device.amazon.model],[l,"Amazon"],[s,d]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[a,l,[s,d]],[/\((ip[honed|\s\w*]+);/i],[a,[l,"Apple"],[s,d]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[l,a,[s,d]],[/\(bb10;\s(\w+)/i],[a,[l,"BlackBerry"],[s,d]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[a,[l,"Asus"],[s,p]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[l,"Sony"],[a,"Xperia Tablet"],[s,p]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[l,"Sony"],[a,"Xperia Phone"],[s,d]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[l,a,[s,c]],[/android.+;\s(shield)\sbuild/i],[a,[l,"Nvidia"],[s,c]],[/(playstation\s[34portablevi]+)/i],[a,[l,"Sony"],[s,c]],[/(sprint\s(\w+))/i],[[l,v.str,m.device.sprint.vendor],[a,v.str,m.device.sprint.model],[s,d]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[l,a,[s,p]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[l,[a,/_/g," "],[s,d]],[/(nexus\s9)/i],[a,[l,"HTC"],[s,p]],[/(nexus\s6p)/i],[a,[l,"Huawei"],[s,d]],[/(microsoft);\s(lumia[\s\w]+)/i],[l,a,[s,d]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[a,[l,"Microsoft"],[s,c]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[l,"Microsoft"],[s,d]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[a,[l,"Motorola"],[s,d]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[a,[l,"Motorola"],[s,p]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[l,g.trim],[a,g.trim],[s,f]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[l,"Samsung"],[s,f]],[/\(dtv[\);].+(aquos)/i],[a,[l,"Sharp"],[s,f]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[l,"Samsung"],a,[s,p]],[/smart-tv.+(samsung)/i],[l,[s,f],a],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[l,"Samsung"],a,[s,d]],[/sie-(\w+)*/i],[a,[l,"Siemens"],[s,d]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[l,"Nokia"],a,[s,d]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[a,[l,"Acer"],[s,p]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[l,"LG"],a,[s,p]],[/(lg) netcast\.tv/i],[l,a,[s,f]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[a,[l,"LG"],[s,d]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[a,[l,"Lenovo"],[s,p]],[/linux;.+((jolla));/i],[l,a,[s,d]],[/((pebble))app\/[\d\.]+\s/i],[l,a,[s,h]],[/android.+;\s(glass)\s\d/i],[a,[l,"Google"],[s,h]],[/android.+;\s(pixel c)\s/i],[a,[l,"Google"],[s,p]],[/android.+;\s(pixel xl|pixel)\s/i],[a,[l,"Google"],[s,d]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[a,/_/g," "],[l,"Xiaomi"],[s,d]],[/android.+a000(1)\s+build/i],[a,[l,"OnePlus"],[s,d]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[s,g.lowerize],l,a]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[u,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,u],[/rv\:([\w\.]+).*(gecko)/i],[u,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[u,v.str,m.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[u,v.str,m.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[o,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[o,"Symbian"],u],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],u],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[o,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],u],[/(sunos)\s?([\w\.]+\d)*/i],[[o,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[o,u],[/(haiku)\s(\w+)/i],[o,u],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[o,"iOS"],[u,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[u,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[o,u]]};if(!(this instanceof n))return new n(e,t).getResult();var b=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""),A=t?g.extend(y,t):y;return this.getBrowser=function(){var e=v.rgx.apply(this,A.browser);return e.major=g.major(e.version),e},this.getDevice=function(){return v.rgx.apply(this,A.device)},this.getEngine=function(){return v.rgx.apply(this,A.engine)},this.getOS=function(){return v.rgx.apply(this,A.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice()}},this.getUA=function(){return b},this};e.exports=n},function(e,t,r){function n(){return!!/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)}function i(){var e=void 0!==navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"];return e||(e=window.ActiveXObject&&new ActiveXObject("ShockwaveFlash.ShockwaveFlash")),e}function a(){return/iphone/i.test(navigator.userAgent.toLowerCase())||/ipad/i.test(navigator.userAgent.toLowerCase())}var o=r(3),s=function(e){o.debug("CapabilityDetection",e)};e.exports={supportsFlash:function(){return!n()&&i()},isBrowserOnMobile:function(){return n()},getBrowserName:function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(r[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE"):"Chrome"===r[1]&&null!==(e=t.match(/\bOPR\/(\d+)/))?"Opera":(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),r[0])},canPlay:function(e,t){var r=function(e,t,r){if(s("invoke canPlayType with video("+e+") and type("+t+") and codec("+r+")"),e&&e.canPlayType){var n=e.canPlayType(t+';codecs="'+r+'"');return s("result : "+n),n}return s("result : failed to invoke canPlayType with "+e),""},a=null;if(function(e){return"video/x-flv"===e||"video/x-f4v"===e||"video/f4v"===e||"application/x-shockwave-flash"===e}(e.toLowerCase()))return!n()&&i();if(function(e){return"application/javascript"===e||"application/x-javascript"===e}(e.toLowerCase()))return!0;var o=e.toLowerCase();if(!t||""===t)if("video/mp4"===o)t="avc1.42E01E,mp4a.40.2",a="avc1.42E01E";else if("video/webm"===o)t="vp8,vorbis";else{if("video/ogg"!==o)return!1;t="theora,vorbis"}var l=document.createElement("video"),u=r(l,o,t);if("probably"===u)return!0;if("maybe"===u){if("video/webm"===o)return!0;if(a&&"probably"===r(l,o,a))return!0}return!1},getPlatformType:function(){return n()?/android/i.test(navigator.userAgent.toLowerCase())?"mobile-Android":a()?"mobile-iOS":"mobile-unknown":i()?"desktop-flash":"desktop-no-flash"}}},function(e,t,r){function n(e,t,i,a,o,s){var l,u=0,c=0,d=!1,p=r(12),f=r(13),h=!0,g=function(e){p.logDebug(e,"URL Loader")};if(o&&void 0!==o.withCredentials&&(h=o.withCredentials),window.XMLHttpRequest)l=new XMLHttpRequest;else if(window.ActiveXObject)try{l=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{l=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return l?(l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){if(i&&i.call(this,void 0,l.responseText,l),g("duration: "+c+", response length: "+l.responseText.length),d&&l.responseText&&l.responseText.length>2048){var e=8*l.responseText.length*1e3/(1024*Math.max(1,c)),t=parseInt(e.toString());g("Bandwidth: "+t);try{f.setGenericData("anxBandwidth",t)}catch(e){}}}else l.status>=400&&l.status<600&&i&&i.call(this,l.status,"",l);else 2===l.readyState?u=(new Date).getTime():3===l.readyState&&u>0&&(d=!0,c=(new Date).getTime()-u)},l.onerror=function(){if(h){var r=o||{};r.withCredentials=!1,n(e,t,i,a,r,s)}else if(i){var u=0===l.status?"404":l.status.toString();i.call(this,u,"",l)}},l.ontimeout=function(){i&&i.call(this,"Timeout","",l)},l.open(s,e),a&&(l.timeout=a),l.withCredentials=h,u=0,void("POST"===s?l.send(t):l.send())):void(i&&i.call(this,"406",""))}var i=r(3);e.exports={load:function(e,t,r){n(e,null,t,r,{withCredentials:!0},"GET")},loadPost:function(e,t,r,i){n(e,t,r,i,{withCredentials:!0},"POST")},trackPixel:function(e,t){!function(e,t){i.log("Logging Event: "+t+" at url:"+e),new Image(1,1).src=e}(e,t)}}},function(e,t,r){function n(e){if(e)return e.responseXML?e.responseXML:e.responseText}var i=r(3);e.exports={debug:function(){i.handleLogDebugLegacySupport.apply(this,arguments)},logDebug:function(){i.handleLogDebugLegacySupport.apply(this,arguments)},setDebugLevel:function(e){i.setDebugLevel(e)},isNotEmpty:function(e){var t=!1;return null!==e&&e&&(t=e.length>0),t},objectToString:function(e,t){var r="null";if(t=void 0!==t?t:0,null!==e){r="OBJ[";var n="";for(var i in e){var a=e[i];if("object"==typeof a)if(++t<9)try{a=this.objectToString(a)}catch(e){a="err:"+e}else a="err: max recursion hit";n.length>0&&(n+=","),n+=i+"="+a}r+=n,r+="]"}return r},getRandomString:function(){return Math.random().toString(36).substring(2)},traceVastFromXhr:function(e,t){try{if(e)if(Array.isArray(e)){if(e.length>0){var r=[];for(var a in e)r.push(e[a].responseURL);var o=e[e.length-1];if(o){var s=n(o),l=o.responseURL;i.info(t,"Tag load chain:",r,"\n","Final Tag URL: ",l,"\n","Final Tag: ",s)}}}else{var u=n(e);i.info(t,"Tag URL:",e.responseURL,"\n","Tag:",u)}}catch(e){}}}},function(e,t,r){function n(e,t,r){switch(s){case 0:!function(e,t){localStorage&&localStorage.setItem(e,t)}(e,t);break;case 1:!function(e,t,r){g.setItem(e,t,r?1/0:new Date(Date.now()+d).toUTCString())}(e,t,r);break;default:!function(e,t){h&&(h[e]=t)}(e,t)}}function i(e){switch(s){case 0:return function(e){if(localStorage)return localStorage.getItem(e)}(e);case 1:return function(e){return g.getItem(e)}(e);default:return function(e){if(h)return h[e]}(e)}}function a(e){switch(s){case 0:!function(e){localStorage&&localStorage.removeItem(e)}(e);break;case 1:!function(e){g.removeItem(e)}(e);break;default:!function(e){h&&delete h[e]}(e)}}function o(e){return"apn_"+e}var s,l=r(12),u="Cache Manager",c=6e4,d=40*c,p="___appnexus_video_cachemanager_generic_data___",f="___appnexus_video_cachemanager_ad_token___",h={};s=function(){try{if(localStorage){var e="apntestls"+Math.random();try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){}}}catch(e){}return!1}()?0:function(){try{if(document&&document.cookie){var e="apntestcookie"+Math.random();try{g.setItem(e,e,1/0);var t=g.hasItem(e)&&g.getItem(e)===e;return g.removeItem(e),t}catch(e){}}}catch(e){}return!1}()?1:2,l.debug("Using Cache Method "+s,u);var g={getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,r,n,i,a){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var o="";if(r)switch(r.constructor){case Number:o=r===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+r;break;case String:o="; expires="+r;break;case Date:o="; expires="+r.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+o+(i?"; domain="+i:"")+(n?"; path="+n:"")+(a?"; secure":""),!0},removeItem:function(e,t,r){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(r?"; domain="+r:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,r=0;r<t;r++)e[r]=decodeURIComponent(e[r]);return e}};e.exports={setGenericData:function(e,t){if(void 0!==e&&void 0!==t){e=p+e;try{return n(e,t),!0}catch(e){}}return!1},getGenericData:function(e){if(void 0!==e)return i(e=p+e)},deleteGenericData:function(e){void 0!==e&&a(e=p+e)},forceStorageMethod:function(e){s=e,l.debug("Forced usage of cache method "+s,u)},addAd:function(e,t){e&&function(e,t){var r={};r.timestamp=(new Date).getTime(),r.ad=e;try{n(t,JSON.stringify(r))}catch(e){}}(e,o(t))},getAd:function(e){return function(e){var t,r=(new Date).getTime();try{var n=i(e);t=n&&JSON.parse(n),a(e)}catch(e){}return t&&t.timestamp&&t.timestamp>0&&r-t.timestamp<=d?t.ad:null}(o(e))},clearAd:function(e){!function(e){try{a(e)}catch(e){}}(o(e))},setTimeToLive:function(e){!function(e){d=e*c}(e)},getNextAdToken:function(){return function(){var e,t;return e=(t=i(f))?parseInt(t):0,n(f,e+=1,!0),e}()}}},function(e,t,r){var n=r(6),i=r(7),a=r(8);e.exports=function(e,t,o,s,l,u,c,d){function p(e,t){var r=E.createCDATASection(t);e.appendChild(r)}function f(e,t){var r=V.getSubNodes(e,"Icon");if(r&&r.length>0)for(var n=0;n<r.length;n++){if(V.getNodeAttributeValue(r[n],"program").toLowerCase()===t.toLowerCase())return!0}return!1}function h(e){var t,r;if(y.extTrackingUrls&&"string"==typeof y.extTrackingUrls&&y.extTrackingUrls.length>5){var n=JSON.parse(y.extTrackingUrls),i=V.getSubNode(e,"TrackingEvents");for(var o in i||(i=E.createElement("TrackingEvents"),e.appendChild(i)),n){var s=n[o];for(t=0;t<s.length;t++){var l=E.createElement("Tracking"),u=E.createAttribute("event");u.value=o,l.setAttributeNode(u),p(l,s[t]),i.appendChild(l)}}delete y.extTrackingUrls}if(y.extClickUrls&&"string"==typeof y.extClickUrls){var c=JSON.parse(y.extClickUrls);if(Array.isArray(c)&&c.length>0&&((r=V.getSubNode(e,"VideoClicks"))||(r=E.createElement("TrackingEvents"),e.appendChild(r)),!V.getSubNode(r,"ClickThrough"))){var d=E.createElement("ClickThrough");p(d,c[0]),r.appendChild(d)}delete y.extClickUrls}if(y.extClickTrackingUrls&&"string"==typeof y.extClickTrackingUrls){var h=JSON.parse(y.extClickTrackingUrls);if(Array.isArray(h)&&h.length>0)for((r=V.getSubNode(e,"VideoClicks"))||(r=E.createElement("VideoClicks"),e.appendChild(r)),t=0;t<h.length;t++){var g=E.createElement("ClickTracking");p(g,h[t]),r.appendChild(g)}delete y.extClickTrackingUrls}if(y.extIcons&&"string"==typeof y.extIcons){var v=JSON.parse(y.extIcons);if(Array.isArray(v)&&v.length>0){var m=V.getSubNode(e,"Icons");for(m||(m=E.createElement("Icons"),e.appendChild(m)),t=0;t<v.length;t++)if(!f(m,v[t].program)){var b=a.createIconNode(E,v[t]);b&&m.appendChild(b)}}delete y.extIcons}}function g(e,t){var r,n,a={companions:[]};i.parse(a,e,V);var o=a.companions;if(t.StaticResource||t.IFrameResource||t.HTMLResource){var s=!1;for(n=0;n<o.length;n++)if(t.width===o[n].width&&t.height===o[n].height){s=!0;break}s||(r=i.createCompanionNode(E,t),e.appendChild(r))}else{var l=!1;for(n=0;n<o.length;n++)if(t.width===o[n].width&&t.height===o[n].height&&(t.id&&t.id===o[n].id||!t.id)){t.CompanionClickTracking&&(o[n].CompanionClickTracking||(o[n].CompanionClickTracking=[]),o[n].CompanionClickTracking=o[n].CompanionClickTracking.concat(t.CompanionClickTracking)),t.TrackingEvents&&(o[n].TrackingEvents||(o[n].TrackingEvents=[]),o[n].TrackingEvents=o[n].TrackingEvents.concat(t.TrackingEvents)),l=!0;break}if(l){for(;e.firstChild;)e.removeChild(e.firstChild);for(var u=0;u<o.length;u++)r=i.createCompanionNode(E,o[u]),e.appendChild(r)}}}var v=r(3),m="VAST Parser",y=e,b=t,A=o,w=d,k=l,T=s,S=u,C=c,V=new n,E=function(e){var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r}(e),r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{v.error(m,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return null}}else{if(void 0===window.ActiveXObject)return v.error(m,"Failed to get vast xml parser"),null;try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return v.error(m,r.parseError),null}catch(e){return v.error(m,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),null}}return r}(e.vastXml);(function(e){if(E){var t=V.getSubNode(E,"VAST");if(t){var r=E.createAttribute("version");r.value=e,t.setAttributeNode(r)}}})(e.vastVersion),function(){if(E){var e=V.getSubNode(E,"VAST");if(e){var t=V.getSubNodes(e,"Ad");if(t&&t.length>0)for(var r=0;r<t.length;r++){if(A){var n=E.createAttribute("notifyurl");n.value=A,t[r].setAttributeNode(n)}if(T&&"rtb"===T){var i=E.createAttribute("rtb");i.value="true",t[r].setAttributeNode(i)}var a=E.createAttribute("sequence");if(a.value=y.sequence.toString(),t[r].setAttributeNode(a),k){var o=E.createAttribute("buyerMemberId");o.value=k,t[r].setAttributeNode(o)}if(S){var s=E.createAttribute("viewabilityConfig");s.value=S,t[r].setAttributeNode(s)}if(w){var l=E.createAttribute("creativeId");l.value=w,t[r].setAttributeNode(l)}}}}}();var x=null;this.addTrackers=function(){if(!E)return"";var e=function(){if(b){var e=V.getSubNode(E,"VAST"),t=E.createAttribute("adtoken");t.value=b,e.setAttributeNode(t)}var n,i,a,o=V.getSubNode(E,"InLine");if(!o)return null;if(y.extImpressionUrls&&"string"==typeof y.extImpressionUrls){var s=JSON.parse(y.extImpressionUrls);if(Array.isArray(s)&&s.length>0)for(n=0;n<s.length;n++)p(i=E.createElement("Impression"),s[n]),o.appendChild(i);delete y.extImpressionUrls}if(C&&C.impressions)for(n=0;n<C.impressions.length;n++)C.impressions[n]&&(p(i=E.createElement("Impression"),C.impressions[n]),o.appendChild(i));if(y.extErrorUrls&&"string"==typeof y.extErrorUrls){var l=JSON.parse(y.extErrorUrls);if(Array.isArray(l)&&l.length>0)for(n=0;n<l.length;n++)p(a=E.createElement("Error"),l[n]),o.appendChild(a);delete y.extErrorUrls}if(C&&C.errors)for(n=0;n<C.errors.length;n++)C.errors[n]&&(p(a=E.createElement("Error"),C.errors[n]),o.appendChild(a));if(y.extViewableImpression&&"string"==typeof y.extViewableImpression){var u=JSON.parse(y.extViewableImpression),c=E.createElement("ViewableImpression");if(Array.isArray(u.viewable)&&u.viewable.length>0)for(n=0;n<u.viewable.length;n++){var d=E.createElement("Viewable");p(d,u.viewable[n]),c.appendChild(d)}if(Array.isArray(u.notViewable)&&u.notViewable.length>0)for(n=0;n<u.notViewable.length;n++){var f=E.createElement("NotViewable");p(f,u.notViewable[n]),c.appendChild(f)}if(Array.isArray(u.undetermined)&&u.undetermined.length>0)for(n=0;n<u.undetermined.length;n++){var h=E.createElement("ViewUndetermined");p(h,u.undetermined[n]),c.appendChild(h)}o.appendChild(c),delete y.extViewableImpression}var g=r(9)().browser.name.toLowerCase();if(y.extExtensions&&"string"==typeof y.extExtensions){var v=y.extExtensions;if(v.length>0){var m=V.getSubNode(o,"Extensions");m?"ie"===g?m.textContent=m.textContent.toString()+v:m.innerHTML=m.innerHTML.toString()+v:(m=E.createElement("Extensions"),o.appendChild(m),"ie"===g?m.textContent=v:m.innerHTML=v)}delete y.extExtensions}(x=V.getSubNode(o,"Creatives"))||(x=E.createElement("Creatives"),o.appendChild(x));var A=V.getSubNode(x,"Linear");if(!A){var w=E.createElement("Creative");x.appendChild(w),A=E.createElement("Linear"),w.appendChild(A)}return A}();if(!e)return"";h(e),x&&function(){if(y.extCompanions&&"string"==typeof y.extCompanions){var e=JSON.parse(y.extCompanions);if(Array.isArray(e.companions)&&e.companions.length>0){var t,r=V.getSubNode(x,"CompanionAds");r||(r=E.createElement("CompanionAds"),x.appendChild(r)),"unknown"!==e.required&&((t=E.createAttribute("required")).value=e.required,r.setAttributeNode(t));for(var n=0;n<e.companions.length;n++)g(r,e.companions[n])}}}();var t,n=r(9)().browser.name.toLowerCase();if("edge"===n)t=E.childNodes[0].outerHTML;else if("ie"===n){for(var i=E.getElementsByTagName("AdParameters"),a=0;a<i.length;a++)i[a].textContent.indexOf("]]>")>0&&"<![CDATA["!==i[a].textContent.substr(0,9)&&(i[a].textContent=i[a].textContent.replace(/]]>/g,"]]]]><![CDATA[>"),i[a].textContent="<![CDATA["+i[a].textContent+"]]>");t=(t=(t=(new XMLSerializer).serializeToString(E)).replace(/&lt;/g,"<")).replace(/&gt;/g,">")}else t=(new XMLSerializer).serializeToString(E);return t}}},function(e,t,r){var n=r(6);e.exports=function(e){function t(e){var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r}(e),r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{i.error(a,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return null}}else{if(void 0===window.ActiveXObject)return i.error(a,"Failed to get vast xml parser"),null;try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return i.error(a,r.parseError),null}catch(e){return i.error(a,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),null}}return r}var i=r(3),a="VAST Parser",o=e,s=new n,l=t(o[0]);if(l){var u=s.getSubNode(l,"VAST"),c=l.createAttribute("apn_waterfall");c.value=!0,u.setAttributeNode(c);for(var d=[],p=0;p<o.length;p++){var f=t(o[p]),h=s.getSubNode(f,"VAST"),g=s.getSubNodes(h,"Ad");if(g&&g.length>0)for(var v=0;v<g.length;v++)d.push(g[v])}d.sort((function(e,t){return s.getNodeAttributeNumberValue(e,"sequence")-s.getNodeAttributeNumberValue(t,"sequence")}));var m=r(9)().browser.name.toLowerCase();for("ie"===m?u.textContent="":u.innerHTML="",p=0;p<d.length;p++)u.appendChild(d[p]);this.getVastXml=function(){if(!l)return"";var e;if("edge"===m)e=l.childNodes[0].outerHTML;else if("ie"===m){for(var t=l.getElementsByTagName("AdParameters"),r=0;r<t.length;r++)t[r].textContent.indexOf("]]>")>0&&"<![CDATA["!==t[r].textContent.substr(0,9)&&(t[r].textContent=t[r].textContent.replace(/]]>/g,"]]]]><![CDATA[>"),t[r].textContent="<![CDATA["+t[r].textContent+"]]>");e=(e=(e=(new XMLSerializer).serializeToString(l)).replace(/&lt;/g,"<")).replace(/&gt;/g,">")}else e=(new XMLSerializer).serializeToString(l);return e}}}},function(e,t,r){var n=r(3),i=r(9),a="apnVmapVast->Utils";e.exports={convertSecsToString:function(e){var t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*r);return(t>9?"":"0")+t+":"+(r>9?"":"0")+r+":"+(n>9?"":"0")+n},getUUID:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}));return t},trackUrls:function(e){if(e&&Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;t++)new Image(1,1).src=e[t]},showNextOverlay:function(e){var t=document.getElementsByClassName("vjs-next-overlay");t&&t.length>0&&(t[0].style.display=e?"":"none")},convertStringToSeconds:function(e,t,r){if(!e||!t||t<=0)return null;var n,i=null;if(2===e.indexOf(":")&&e.length>=8){n=e.indexOf(":");var a=parseInt(e.substr(0,n));n=(e=e.substr(n+1,e.length-n-1)).indexOf(":");var o=parseInt(e.substr(0,n)),s=(n=(e=e.substr(n+1,e.length-n-1)).indexOf("."))>0?parseInt(e.substr(0,n)):parseInt(e),l=0;n>0&&(e=e.substr(n+1,e.length-n-1),l=parseInt(e)),i=3600*a+60*o+s+(l>=500?1:0)}else if(e.indexOf("%")>0){n=e.indexOf("%");var u=parseInt(e.substr(0,n));i=parseInt(t*u/100)}else"start"===e?i=0:"end"===e?i=t:"#"===e[0]?(e=e.substr(1,e.length-1),i=-1*parseInt(e)):"now"===e&&void 0!==r&&(i=parseInt(r+1));return i},convertStringToMseconds:function(e){if(!e)return null;var t,r=null;if(2===e.indexOf(":")&&e.length>=8){t=e.indexOf(":");var n=parseInt(e.substr(0,t));t=(e=e.substr(t+1,e.length-t-1)).indexOf(":");var i=parseInt(e.substr(0,t)),a=(t=(e=e.substr(t+1,e.length-t-1)).indexOf("."))>0?parseInt(e.substr(0,t)):parseInt(e),o=0;t>0&&(e=e.substr(t+1,e.length-t-1),o=parseInt(e)),r=1e3*(3600*n+60*i+a)+o}return r},getPlayerSnapshot:function(e){var t=e.el().querySelector(".vjs-tech"),r={ended:e.ended(),src:e.currentSrc(),currentTime:e.currentTime(),type:e.currentType(),playing:e.scrubbing_||!e.paused(),suppressedTracks:function(e){var t=e.remoteTextTracks?e.remoteTextTracks():[];t&&Array.isArray(t.tracks_)&&(t=t.tracks_),Array.isArray(t)||(t=[]);var r=[];return t.forEach((function(e){r.push({track:e,mode:e.mode}),e.mode="disabled"})),r}(e),muted:e.muted(),volume:e.volume()};t&&(r.nativePoster=t.poster,r.style=t.getAttribute("style")),"ios"===i().os.name.toLowerCase()&&Math.abs(e.duration()-r.currentTime)<2&&(r.postrollOnIOS=!0);var o=document.getElementsByClassName("vjs-dock-text");return o&&o.length>0&&(r.dockText=o[0],r.dockText.style.display="none"),n.log(a,"Break snapshot = ",r),r},restorePlayerSnapshot:function(e,t){var r=e.el().querySelector(".vjs-tech"),i=40;t.nativePoster&&(r.poster=t.nativePoster),"style"in t&&r.setAttribute("style",t.style||""),t.dockText&&(t.dockText.style.display="block"),e.one("contentloadedmetadata",(function(){t.suppressedTracks.forEach((function(e){e.track.mode=e.mode}))})),e.one("canplay",(function r(){if(e.play(),!function(e){return e.readyState()>1||void 0===e.seekable()||e.seekable().length>0}(e)&&i--)setTimeout(r,100);else try{e.currentTime()!==t.currentTime?(e.one("seeked",(function(){n.log(a,"Break seeked event. player time = ",e.currentTime()),t.playing?e.play():t.ended||e.pause(),e.trigger("tryToResumeDone")})),n.log(a,"Break snapshot.currentTime = ",t.currentTime),t.postrollOnIOS&&(t.currentTime=e.duration()-1,t.playing=!0),e.currentTime(t.currentTime)):t.playing&&(e.play(),e.trigger("tryToResumeDone"))}catch(t){e.trigger("tryToResumeDone"),n.log(a,"Failed to resume the content after an advertisement",t)}})),function(){var t=setTimeout((function(){e.trigger("canplay")}),1e3);e.one("canplay",(function(){clearTimeout(t)}))}(),n.log(a,"Break snapshot.src = ",t.src),e.src({src:t.src,type:t.type})}}},function(e,t,r){var n=r(3),i=r(11),a=r(5),o=r(18),s=r(16),l="apnVmapVast->impbusCommunicator";e.exports=function(){function e(e){if(v&&v.skippable)if(v.skippable.enabled){if(v.skippable.videoThreshold&&e.durationMsecs<1e3*v.skippable.videoThreshold&&e.skipOffset&&delete e.skipOffset,v.skippable.videoOffset){var t=s.convertSecsToString(v.skippable.videoOffset);e.skipOffset=t}}else e.skipOffset&&delete e.skipOffset;if(e.vastXml&&v&&v.skippable){var r=(new DOMParser).parseFromString(e.vastXml,"text/xml"),n=b.getSubNode(r,"Linear",0);if(n){if(n.removeAttribute("skipoffset"),e.skipOffset){var i=r.createAttribute("skipoffset");i.value=e.skipOffset,n.setAttributeNode(i)}e.vastXml=(new XMLSerializer).serializeToString(r)}}var o={};if(v&&v.trackers&&v.trackers.length>0){var l=v.trackers[0].impression_urls,u=v.trackers[0].error_urls;l&&(o.impressions=l),u&&(o.errors=u);var c=v.trackers[0].video_click_urls;c&&c.length>0&&(e.clickTrackingUrl?e.clickTrackingUrl=e.clickTrackingUrl.concat(c):e.clickTrackingUrl=c);var d=v.trackers[0].video_events;if(d)for(var p in d)e.trackingUrls.hasOwnProperty(p)?e.trackingUrls[p]=e.trackingUrls[p].concat(d[p]):e.trackingUrls[p]=d[p]}var f=a.getUnwrappedVastTag(e,null,null,null,null,null,o);f?g(f):g(null,"900","Failed to generate unwrapped VAST xml")}function t(e,t){i.load(e,(function(e,t,r){e?"Timeout"===e?A(null,"408",e):A(null,e,r.statusText):A(t)}),t)}function u(e,t,r){if(t.uuid=s.getUUID(),t.tags&&t.tags.length>0)for(var a=0;a<t.tags.length;a++)t.tags[a].uuid=s.getUUID();var o=JSON.stringify(t);i.loadPost(e,o,(function(e,t,r){if(e)if("Timeout"===(n.warn(l,"Unable to load from ib:"+e),e))k(null,"408",e);else k(null,e,r.statusText);else if(r&&"json"===r.responseType)k(r.response);else try{if(r.responseText){var i=JSON.parse(r.responseText);k(i)}else k(null,"900","load failure: empty impbus response")}catch(e){k(this,"100","failed to parse UT impbus response")}}),r)}function c(e,t,r){i.load(e,(function(t,n,i){t?"Timeout"===t?r(e,null,"408",t):r(e,null,t,i.statusText):r(e,n)}),t)}function d(e){var t=e;if(y){var r={"{player.id}":h.bcinfo.playerId,"{mediainfo.id}":y.id,"{mediainfo.name}":y.name,"{mediainfo.description}":y.description?y.description:"","{mediainfo.tags}":y.tags,"{mediainfo.referenceID}":y.referenceId?y.referenceId:"","{mediainfo.duration}":y.duration,"{mediainfo.ad_keys}":y.adKeys?y.adKeys:"","{player.duration}":h.duration(),"{document.referrer}":document.referrer,"{window.location.href}":window.location.href,"{player.url}":h.bcinfo.scriptUrl,"{timestamp}":Date.now(),"{random}":parseInt(1e12*Math.random())};for(var n in r)t=t.split(n).join(encodeURIComponent(r[n]))}return t}function p(e){var t=e;if(y&&y.customFields)for(var r in y.customFields)t=t.split("{mediainfo.customFields."+r+"}").join(encodeURIComponent(y.customFields[r]));return t}function f(e){var t=e;if(v.tagKeywords)for(var r in v.tagKeywords){t+="&kw_"+r+"="+v.tagKeywords[r]}return p(t=d(t))}var h,g,v,m,y,b=new o,A=function(t,r,n){r?g(null,r,n):a.parse(t,(function(t,r,n,i){if(t)e(n);else{var a="100";0===n.indexOf("vast")&&(a=n.substr(4,n.length-4)),i&&i.length>0&&s.trackUrls(i),g(null,a,"failed to parse VAST xml from impbus")}}),null,1e3,null,null,v)},w=function(e,t,n){if(e&&e.tags&&e.tags.length>0){var o=e.tags[0];if(v.noAdUrl=o.no_ad_url,o.ads&&o.ads.length>0){var l,u=null;for(l=0;l<o.ads.length;l++)if("rtb"===o.ads[l].content_source&&"video"===o.ads[l].ad_type){u=o.ads[l];break}if(!u)for(l=0;l<o.ads.length;l++)if("video"===o.ads[l].ad_type){u=o.ads[l];break}if(u){v.notifyUrl=u.notify_url,v.usersyncUrl=u.usersync_url,v.viewability=u.viewability,v.requestUrl=u[u.content_source].request_url,v.responseUrl=u[u.content_source].respondse_url,v.trackers=u[u.content_source].trackers;var c=null;if(u[u.content_source].video&&u[u.content_source].video.content)c=u[u.content_source].video.content;else if(u[u.content_source].video&&u[u.content_source].video.content_b64){var d=r(19).Base64;c=d.decode(u[u.content_source].video.content_b64)}else u[u.content_source].handler&&u[u.content_source].handler.length>0&&u[u.content_source].handler[0].url?i.load(u[u.content_source].handler[0].url,(function(e,r,n){e?"Timeout"===e?t(null,"408",e):t(null,e,n.statusText):(c=r,a.parse(c,(function(e,r,n,i){if(e)t(n);else{var a="100";0===n.indexOf("vast")&&(a=n.substr(4,n.length-4)),i&&i.length>0&&s.trackUrls(i),t(null,a,"failed to parse VAST xml from impbus")}}),null,1e3,null,null,v))}),n):t(null,"900","Failed to get xml from ad in impbus response");c&&a.parse(c,(function(e,r,n,i){if(e)t(n);else{var a="100";0===n.indexOf("vast")&&(a=n.substr(4,n.length-4)),i&&i.length>0&&s.trackUrls(i),t(null,a,"failed to parse VAST xml from impbus")}}),null,1e3,null,null,v)}else t(null,"900","No available ad had been found in impbus response")}else t(null,"900","No ads in first tag in impbus response")}else t(null,"900","No tags in impbus response")},k=function(t,r,n){return r?void g(null,r,n):void w(t,(function(t,r,n){return r?void g(null,r,n):void e(t)}),m)};this.getXML=function(e,r,i){var a;if(g=i,v=e,(h=r).mediainfo&&h.mediainfo.name&&(y=h.mediainfo),a=v&&v.endpointUrl?v.endpointUrl:"//lax1-ib.adnxs.com/prebid/cache",m=v&&v.timeouts&&v.timeouts.adCallTimeout?v.timeouts.adCallTimeout:700,v.vmapEnabled){var o,s=[];if(Array.isArray(v.apnTagParams))for(o=0;o<v.apnTagParams.length;o++)s.push(a+"/vmap"+("?"===v.apnTagParams[o][0]?"":"?")+v.apnTagParams[o]);else s.push(a+"/vmap"+("?"===v.apnTagParams[0]?"":"?")+v.apnTagParams);var b=[],A=0,w=function(e,t,r,a){r||a?(n.warn(l,"VMAP request url: "+s[o]),n.warn(l,"Unable to get VMAP xml from ib. Error code: "+r+", message: "+a)):t&&t.length>0&&b.push({url:e,xml:t}),++A===s.length&&i(b.length>0?b:null)},k=function(){for(o=0;o<s.length;o++){c(f(s[o]),m,w)}};y?k():h.one("loadstart",(function(){y=h.mediainfo,k()}))}else if("string"==typeof v.apnTagParams){v&&!v.skippable&&v.apnTagParams.indexOf("vskippable=0")>=0&&(v.skippable={enabled:!1});var T=a+("?"===v.apnTagParams[0]?"":"?")+v.apnTagParams,S=function(){t(f(T),m)};y?S():h.one("loadstart",(function(){y=h.mediainfo,!isNaN(h.duration())&&h.duration()>0?S():h.one("loadedmetadata",S)}))}else{var C=function(){var e=d(JSON.stringify(v.apnTagParams));e=p(e);var t=JSON.parse(e);u(a+"/ut/v3",t,m)};y?C():h.one("loadstart",(function(){y=h.mediainfo,!isNaN(h.duration())&&h.duration()>0?C():h.one("loadedmetadata",C)}))}},this.test=function(){return{callback:function(e){g=e},options:function(e){v=e},makePtvRequest:t,processPtvResponse:A,setProcessPtvResponse:function(e){A=e},convertSecsToString:s.convertSecsToString,makeUtRequest:u,processUtResponse:k,setProcessUtResponse:function(e){k=e},getVastObjFromUtResponse:w,modifyAndReturnVastXml:e,makeVmapRequest:c,resolveKeywordsAndMacros:f,setPlayer:function(e){h=e,y=e.mediainfo}}}}},function(e,t){e.exports=function(){this.getSubNodes=function(e,t){var r=e.getElementsByTagName(t);return r.length>0?r:null},this.getSubNode=function(e,t,r){r||(r=0);var n=e.getElementsByTagName(t);return n.length>r?n[r]:null},this.getNodeValue=function(e){if(0===e.childNodes.length)return"";var t=e.childNodes[0].nodeValue;return t?t.trim():""},this.getNodeValues=function(e){if(0===e.childNodes.length)return"";for(var t="",r=0;r<e.childNodes.length;r++){var n=e.childNodes[r].nodeValue;n&&(t+=n)}return t.trim()},this.getNodeAttributeValue=function(e,t){var r=e.getAttribute(t);return null===r&&(r=""),r},this.getNodeAttributeNumberValue=function(e,t,r){r||(r=0);var n=r,i=this.getNodeAttributeValue(e,t);return i.length>0&&(n=i.indexOf(".")>=0?parseFloat(i):parseInt(i)),n},this.getNodeAttributeBooleanValue=function(e,t,r){r||(r=!1);var n=r,i=this.getNodeAttributeValue(e,t);i.length>0&&(n="t"===i.toLowerCase().charAt(0));return n},this.getSubNodeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValue(n):r},this.getSubNodeWholeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValues(n):r},this.getSubNodeBooleanValue=function(e,t,r){r=void 0===r?"false":r;var n=this.getSubNodeValue(e,t);return n.length>0&&"t"===n.toLowerCase().charAt(0)||!(n.length>0&&"f"===n.toLowerCase().charAt(0))&&r}}},function(e,t,r){var n;(function(i){!function(t,r){e.exports=r(t)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:this,(function(i){"use strict";var a,o=i.Base64;if(void 0!==e&&e.exports)if("undefined"!=typeof navigator&&"ReactNative"==navigator.product);else try{a=r(20).Buffer}catch(e){}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(s),u=String.fromCharCode,c=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?u(192|t>>>6)+u(128|63&t):u(224|t>>>12&15)+u(128|t>>>6&63)+u(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return u(240|t>>>18&7)+u(128|t>>>12&63)+u(128|t>>>6&63)+u(128|63&t)},d=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,p=function(e){return e.replace(d,c)},f=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[s.charAt(r>>>18),s.charAt(r>>>12&63),t>=2?"=":s.charAt(r>>>6&63),t>=1?"=":s.charAt(63&r)].join("")},h=i.btoa?function(e){return i.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,f)},g=a?a.from&&Uint8Array&&a.from!==Uint8Array.from?function(e){return(e.constructor===a.constructor?e:a.from(e)).toString("base64")}:function(e){return(e.constructor===a.constructor?e:new a(e)).toString("base64")}:function(e){return h(p(e))},v=function(e,t){return t?g(String(e)).replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,""):g(String(e))},m=new RegExp(["[-][-]","[ -][-]{2}","[-][-]{3}"].join("|"),"g"),y=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return u(55296+(t>>>10))+u(56320+(1023&t));case 3:return u((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return u((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},b=function(e){return e.replace(m,y)},A=function(e){var t=e.length,r=t%4,n=(t>0?l[e.charAt(0)]<<18:0)|(t>1?l[e.charAt(1)]<<12:0)|(t>2?l[e.charAt(2)]<<6:0)|(t>3?l[e.charAt(3)]:0),i=[u(n>>>16),u(n>>>8&255),u(255&n)];return i.length-=[0,0,2,1][r],i.join("")},w=i.atob?function(e){return i.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,A)},k=a?a.from&&Uint8Array&&a.from!==Uint8Array.from?function(e){return(e.constructor===a.constructor?e:a.from(e,"base64")).toString()}:function(e){return(e.constructor===a.constructor?e:new a(e,"base64")).toString()}:function(e){return b(w(e))},T=function(e){return k(String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))};if(i.Base64={VERSION:"2.4.8",atob:w,btoa:h,fromBase64:T,toBase64:v,utob:p,encode:v,encodeURI:function(e){return v(e,!0)},btou:b,decode:T,noConflict:function(){var e=i.Base64;return i.Base64=o,e}},"function"==typeof Object.defineProperty){var S=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};i.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",S((function(){return T(this)}))),Object.defineProperty(String.prototype,"toBase64",S((function(e){return v(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",S((function(){return v(this,!0)})))}}return i.Meteor&&(Base64=i.Base64),void 0!==e&&e.exports?e.exports.Base64=i.Base64:void 0!==(n=function(){return i.Base64}.apply(t,[]))&&(e.exports=n),{Base64:i.Base64}}))}).call(t,function(){return this}())},function(e,t,r){(function(e){
/*!
             * The buffer module from node.js, for the browser.
             *
             * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
             * @license  MIT
             */
"use strict";function n(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,r){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return o(this,e,t,r)}function o(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),a.TYPED_ARRAY_SUPPORT?(e=t).__proto__=a.prototype:e=u(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!a.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(t,r),o=(e=i(e,n)).write(t,r);return o!==n&&(e=e.slice(0,o)),e}(e,t,r):function(e,t){if(a.isBuffer(t)){var r=0|c(t.length);return 0===(e=i(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?i(e,0):u(e,t);if("Buffer"===t.type&&j(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(s(t),e=i(e,t<0?0:0|c(t)),!a.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function u(e,t){var r=t.length<0?0:0|c(t.length);e=i(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function c(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return B(e).length;default:if(n)return O(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return V(this,t,r);case"utf8":case"utf-8":return T(this,t,r);case"ascii":return S(this,t,r);case"latin1":case"binary":return C(this,t,r);case"base64":return k(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function h(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=a.from(t,n)),a.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){function a(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var o,s=1,l=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,l/=2,u/=2,r/=2}if(i){var c=-1;for(o=r;o<l;o++)if(a(e,o)===a(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+u>l&&(r=l-u),o=r;o>=0;o--){for(var d=!0,p=0;p<u;p++)if(a(e,o+p)!==a(t,p)){d=!1;break}if(d)return o}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function m(e,t,r,n){return U(O(t,e.length-r),e,r,n)}function y(e,t,r,n){return U(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return y(e,t,r,n)}function A(e,t,r,n){return U(B(t),e,r,n)}function w(e,t,r,n){return U(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function k(e,t,r){return 0===t&&r===e.length?D.fromByteArray(e):D.fromByteArray(e.slice(t,r))}function T(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&((l=(31&u)<<6|63&a)>127&&(c=l));break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l));break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l))}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=X)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=X));return r}(n)}function S(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function C(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function V(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=R(e[a]);return i}function E(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function x(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function I(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function _(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function P(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,i){return i||P(e,0,r,4),F.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,i){return i||P(e,0,r,8),F.write(e,t,r,n,52,8),r+8}function R(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){t=t||1/0;for(var r,n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function B(e){return D.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}var D=r(21),F=r(22),j=r(23);t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,r){return o(null,e,t,r)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,r){return function(e,t,r,n){return s(t),t<=0?i(e,t):void 0!==r?"string"==typeof n?i(e,t).fill(r,n):i(e,t).fill(r):i(e,t)}(null,e,t,r)},a.allocUnsafe=function(e){return l(null,e)},a.allocUnsafeSlow=function(e){return l(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!j(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=a.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):p.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,r,n,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),l=Math.min(o,s),u=this.slice(n,i),c=e.slice(t,r),d=0;d<l;++d)if(u[d]!==c[d]){o=u[d],s=c[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},a.prototype.indexOf=function(e,t,r){return h(this,e,t,r,!0)},a.prototype.lastIndexOf=function(e,t,r){return h(this,e,t,r,!1)},a.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return m(this,e,t,r);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return A(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var X=4096;a.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=a.prototype;else{var i=t-e;r=new a(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},a.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||x(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},a.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||x(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},a.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||x(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},a.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||x(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},a.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),F.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),F.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),F.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),F.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},a.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},a.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):_(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},a.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},a.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):_(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):_(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},a.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},a.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},a.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},a.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},a.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=a.isBuffer(e)?e:O(new a(e,n).toString()),l=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%l]}return this};var q=/[^+\/0-9A-Za-z-_]/g}).call(t,function(){return this}())},function(e,t){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function n(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function i(e,t,r){for(var i,a=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n(i));return a.join("")}t.byteLength=function(e){var t=r(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){for(var t,n=r(e),i=n[0],a=n[1],l=new s(function(e,t,r){return 3*(t+r)/4-r}(0,i,a)),u=0,c=a>0?i-4:i,d=0;d<c;d+=4)t=o[e.charCodeAt(d)]<<18|o[e.charCodeAt(d+1)]<<12|o[e.charCodeAt(d+2)]<<6|o[e.charCodeAt(d+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=o[e.charCodeAt(d)]<<2|o[e.charCodeAt(d+1)]>>4,l[u++]=255&t),1===a&&(t=o[e.charCodeAt(d)]<<10|o[e.charCodeAt(d+1)]<<4|o[e.charCodeAt(d+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],s=16383,l=0,u=r-n;l<u;l+=s)o.push(i(e,l,l+s>u?u:l+s));return 1===n?(t=e[r-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"=")),o.join("")};for(var a=[],o=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,c=l.length;u<c;++u)a[u]=l[u],o[l.charCodeAt(u)]=u;o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,d=r?i-1:0,p=r?-1:1,f=e[t+d];for(d+=p,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+d],d+=p,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=u}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,h=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(s=0,o=c):o+d>=1?(s=(t*l-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=h,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+f]=255&o,f+=h,o/=256,u-=8);e[r+f-h]|=128*g}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){function n(e,t){for(var r=0;r<e.length;r++)if(e[r].timeOffset===t)return e[r];return null}function i(e,t){for(var r=0;r<e.length;r++)if(e[r].event===t)return e[r];return null}var a=r(25),o=function(e,t){function n(e){var t;if("ie"===A.browser.name.toLowerCase()){var r=(t=(t=(t=(new XMLSerializer).serializeToString(e)).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).indexOf(">");r>0&&(t=t.substr(r+1)),(r=t.lastIndexOf("</"))>0&&(t=t.substr(0,r))}else t=e.innerHTML;return t}function i(e,t){if(e&&e.length>0)for(var r=0;r<e.length;r++)e[r]=e[r].replace("[ERROR_CODE]",t)}function o(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function s(e,t){var r=C.getSubNodes(e,"vmap:Tracking");if(r)for(var n=0;n<r.length;n++){var i=r[n],a=C.getNodeValues(i);if(a){var s=C.getNodeAttributeValue(i,"event");if(s){for(var l=null,u=0;u<t.length;u++)if(t[u].event===s){l=t[u].uris;break}l||(l=[],t.push({event:s,uris:l})),l.length>0&&o(l,a)||l.push(a)}}}}function l(e,t){if(t){var r=C.getSubNode(t,"vmap:Extensions");if(r){e.extensions=[];var i=C.getSubNodes(r,"vmap:Extension");if(i)for(var a=0;a<i.length;a++){var o=n(i[a]);if(o&&(o=u(o)).length>0){var s=C.getNodeAttributeValue(i[a],"type");s&&e.extensions.push({type:s,xmlData:o})}}}}}function u(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r.trim()}function c(e,t,r,n){if(r&&r.length>0)for(var a=0;a<r.length;a++)if("error"===r[a].event){i(r[a].uris,e),y.error(b,"Error "+e+" - "+t),E=E.concat(r[a].uris);break}!n&&w&&(w(!1,null,E),w=null),w&&p()&&h()}function d(e){var t=u(e);if(0!==t.length){var r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{y.error(b,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return void c("1002","VMAP XML parsing error")}}else{if(void 0===window.ActiveXObject)return y.error(b,"Failed to parse vmap xml by window.ActiveXObject(Microsoft.XMLDOM)"),void c("1002","Failed to get vmap xml");try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return y.error(b,r.parseError),void c("1002",r.parseError.errorCode+", Error reason = "+r.parseError.reason)}catch(e){return y.error(b,"Failed to parse vmap xml by window.ActiveXObject(Microsoft.XMLDOM)",e),void c("1002","Failed to parse vmap xml by window.ActiveXObject(Microsoft.XMLDOM)")}}if(r){var n=C.getSubNode(r,"vmap:VMAP");if(n&&n.firstChild){var i=function(e){var t="unknown";return e&&(t=(t=C.getNodeAttributeValue(e,"version")).trim()).length>3&&(t=t.substr(0,3)),t}(n);if(function(e){return"1.0"===e}(i)){i,V.version=i;var a,o=C.getSubNodes(n,"vmap:AdBreak");if(!o||0===o.length)return void c("900","no AdBreak available");for(V.adBreaks=[],a=0;a<o.length;a++){var s=C.getNodeAttributeValue(o[a],"breakId");if(s)s=s+"_"+a;else{var d=r.createAttribute("breakId");s="apn_vmap_"+a,d.value=s,o[a].setAttributeNode(d)}var p={breakId:s,startTime:Date.now()};V.adBreaks.push(p)}for(a=0;a<V.adBreaks.length;a++)m(o[a],V.adBreaks[a])}else c("1001","VMAP version not supported");l(V,n)}else c("1000","VMAP node does not exist")}else c("1002","VMAP XML parsing error")}else c("1000","Empty VMAP xml")}function p(){for(var e=0;e<V.adBreaks.length;e++)if(!V.adBreaks[e].endTime)return!1;return!0}function f(e,t){if(e.adSource){if(t.adSource)if(!e.adSource.customAdData&&t.adSource.customAdData&&(e.adSource.customAdData=t.adSource.customAdData),!e.adSource.vastData&&t.adSource.vastData)e.adSource.vastData=t.adSource.vastData;else if(e.adSource.vastData&&t.adSource.vastData)for(var r in t.adSource.vastData)e.adSource.vastData[r]?e.adSource.vastData[r]=e.adSource.vastData[r].concat(t.adSource.vastData[r]):e.adSource.vastData[r]=t.adSource.vastData[r]}else t.adSource&&(e.adSource=t.adSource);if(e.extensions&&t.extensions?e.extensions=e.extensions.concat(t.extensions):!e.extensions&&t.extensions&&(e.extensions=t.extensions),t.trackings){e.trackings||(e.trackings=[]);for(var n=0;n<t.trackings.length;n++){for(var i=!1,a=0;a<e.trackings.length;a++)if(t.trackings[n].event===e.trackings[a].event){i=!0,e.trackings[a].uris=e.trackings[a].uris.concat(t.trackings[n].uris);break}i||e.trackings.push(t.trackings[n])}}}function h(){for(var e=0;e<V.adBreaks.length;){var t=V.adBreaks[e];if(t.timeOffset)if(t.breakType){var r=!1,n=!1;t.adSource&&(r=!0,t.adSource.vastData||t.adSource.customAdData||(r=!1,delete t.adSource,y.error(b,"AdBreak does not have valid AdSource. Remove adSource object from break object."))),t.trackings&&(n=!0,0===t.trackings.length&&(n=!1,delete t.trackings,y.error(b,"AdBreak does not have valid tracking event. Remove trackings object from break object."))),r||n?e++:(V.adBreaks.splice(e,1),y.error(b,"AdBreak does not have valid AdSource and tracking event. Remove break object from response object."))}else V.adBreaks.splice(e,1),y.error(b,"AdBreak does not have breakType. Remove break object from response object.");else V.adBreaks.splice(e,1),y.error(b,"AdBreak does not have timeOffset. Remove break object from response object.")}0===V.adBreaks.length?c("900","No AdBreaks have been resolved"):(function(){for(var e=0;e<V.adBreaks.length;e++){var t=V.adBreaks[e];if(e<V.adBreaks.length-1)for(var r=e+1;r<V.adBreaks.length;)t.timeOffset===V.adBreaks[r].timeOffset?(f(t,V.adBreaks[r]),V.adBreaks.splice(r,1)):r++}}(),w(!0,V,E),w=null)}function g(e,t,r){t[e]?t[e].push(r):t[e]=[r]}function v(e,t,r,n){var i=function(e){for(var t=0;t<V.adBreaks.length;t++)if(V.adBreaks[t].breakId===e)return V.adBreaks[t];return null}(t);if(i){if(i.endTime=Date.now(),e)if("proprietary"!==i.adSource.templateType)if(Array.isArray(r)){var a;for(a=0;a<r.length;)r[a].vastVersion.substr(0,1)!==i.adSource.templateType.substr(4,1)?(y.error(b,"VAST version "+r[a].vastVersion+" does not match template type "+i.adSource.templateType),r.splice(a,1)):a++;if(r.length>0)for(i.adSource.vastData={},a=0;a<r.length;a++){g(parseInt(r[a].sequence),i.adSource.vastData,r[a])}}else r.vastVersion.substr(0,1)!==i.adSource.templateType.substr(4,1)?c("1005","invalid AdSource template type",i.trackings,!0):i.adSource.vastData=r;else i.adSource.vastData=r;else n&&n.length>0&&(E=E.concat(n)),"vast"===r.substr(0,4)?c(r=r.substr(4),"VAST parsing error",i.trackings,!0):"Timeout"===r?c("1007","VAST parsing timeout",i.trackings,!0):c("900","VAST parsing error",i.trackings,!0);w&&p()&&h()}else c("900","failed to found AdBreak after VAST parsing")}function m(e,t){l(t,e);var i=C.getSubNode(e,"vmap:TrackingEvents");i&&(t.trackings=[],s(i,t.trackings));var a=C.getNodeAttributeValue(e,"timeOffset");if(!a)return t.endTime=Date.now(),void c("900","missing timeOffset attribute in AdBreak node",t.trackings,!0);if(t.timeOffset=a,!(a=C.getNodeAttributeValue(e,"breakType")))return t.endTime=Date.now(),void c("1003","AdBreak not supported",t.trackings,!0);t.breakType=a,(a=C.getNodeAttributeValue(e,"repeatAfter"))&&(t.repeatAfter=a);var o=C.getSubNode(e,"vmap:AdSource");if(o){var u={};t.adSource=u,(a=C.getNodeAttributeValue(o,"id"))&&(u.id=a),(a=C.getNodeAttributeBooleanValue(o,"allowMultipleAds",!0))&&(u.allowMultipleAds=a),(a=C.getNodeAttributeValue(o,"followRedirects"))&&(u.followRedirects="true"===a);var d,f=r(26),g=S-Date.now(),m=C.getSubNode(o,"vmap:VASTAdData");if(m){if(!(d=n(m)))return t.endTime=Date.now(),void c("1004","empty VASTAdData for AdBreak",t.trackings,!0);u.templateType="vast3",f.parse(d,v,t.breakId,g,null,null,k)}else if(m=C.getSubNode(o,"vmap:CustomAdData")){if(t.endTime=Date.now(),!(d=C.getNodeValues(m)))return void c("1004","empty CustomAdData for AdBreak",t.trackings,!0);if(!(a=C.getNodeAttributeValue(m,"templateType")))return void c("1005","missing templateType attribute in CustomAdData node",t.trackings,!0);u.templateType=a,u.customAdData=d,w&&p()&&h()}else if(m=C.getSubNode(o,"vmap:AdTagURI")){if(!(d=C.getNodeValues(m)))return t.endTime=Date.now(),void c("1004","empty AdTagURI for AdBreak",t.trackings,!0);if(!(a=C.getNodeAttributeValue(m,"templateType")))return t.endTime=Date.now(),void c("1005","missing templateType attribute in AdTagURI node",t.trackings,!0);u.templateType=a,r(11).load(d,(function(e,r){e?v(!1,t.breakId,"Timeout"===e?"vast1007":"vast1008"):(g=S-Date.now(),f.parse(r,v,t.breakId,g,null,null,k))}),g)}}}var y=r(3),b="VMAP Parser:",A=r(9)(),w=null,k=t||{},T=e&&e>0?e:1e3,S=Date.now()+T,C=new a,V={},E=[];y.always(b,"Version 1.0.5"),k.vmap=!0,this.parse=function(e,t){w=t,d(e)}};e.exports={parse:function(e,t,r,n){var i=new o(r,n);return i.parse(e,(function(e,r,n){t&&t(e,r,n),i=null})),i},mergeVmapData:function(e,t){return function(e,t){if(!e)return t;if(!t)return e;if(t.extensions&&t.extensions.length>0&&(e.extensions||(e.extensions=[]),e.extensions=e.extensions.concat(t.extensions)),t.adBreaks&&t.adBreaks.length>0)if(e.adBreaks)for(var r=0;r<t.adBreaks.length;r++){var a=n(e.adBreaks,t.adBreaks[r].timeOffset);if(a){if(t.adBreaks[r].extensions&&t.adBreaks[r].extensions.length>0&&(a.extensions||(a.extensions=[]),a.extensions=a.extensions.concat(t.adBreaks[r].extensions)),t.adBreaks[r].trackings&&t.adBreaks[r].trackings.length>0)if(a.trackings)for(var o=0;o<t.adBreaks[r].trackings.length;o++){var s=i(a.trackings,t.adBreaks[r].trackings[o].event);s?s.uris=s.uris.concat(t.adBreaks[r].trackings[o].uris):a.trackings.push(t.adBreaks[r].trackings[o])}else a.trackings=[],a.trackings=a.trackings.concat(t.adBreaks[r].trackings);if(t.adBreaks[r].adSource)if(a.adSource){if(t.adBreaks[r].adSource.vastData)if(a.adSource.vastData)for(var l in t.adBreaks[r].adSource.vastData)a.adSource.vastData[l]?a.adSource.vastData[l]=a.adSource.vastData[l].concat(t.adBreaks[r].adSource.vastData[l]):a.adSource.vastData[l]=t.adBreaks[r].adSource.vastData[l];else a.adSource.vastData=t.adBreaks[r].adSource.vastData}else a.adSource=t.adBreaks[r].adSource}else e.adBreaks.push(t.adBreaks[r])}else e.adBreaks=[],e.adBreaks=e.adBreaks.concat(t.adBreaks);return e}(e,t)}}},function(e,t,r){var n=r(9)();e.exports=function(){function e(e){var t=e;return"edge"===n.browser.name.toLowerCase()&&0===e.indexOf("vmap:")&&(t=t.substr(5,e.length-5)),t}this.getSubNodes=function(t,r){var n=t.getElementsByTagName(e(r));return n.length>0?n:null},this.getSubNode=function(t,r,n){var i=!1;n||(i=!0,n=0);var a=t.getElementsByTagName(e(r));if(a.length>n){if(!i)return a[n];for(var o=0;o<a.length;o++)if(a[o].parentNode===t)return a[o];return a[0]}return null},this.getNodeValue=function(e){if(0===e.childNodes.length)return"";var t=e.childNodes[0].nodeValue;return t?t.trim():""},this.getNodeValues=function(e){if(0===e.childNodes.length)return"";for(var t="",r=0;r<e.childNodes.length;r++){var n=e.childNodes[r].nodeValue;n&&(t+=n)}return t.trim()},this.getNodeAttributeValue=function(e,t){var r=e.getAttribute(t);return null===r&&(r=""),r},this.getNodeAttributeNumberValue=function(e,t,r){r||(r=0);var n=r,i=this.getNodeAttributeValue(e,t);return i.length>0&&(n=i.indexOf(".")>=0?parseFloat(i):parseInt(i)),n},this.getNodeAttributeBooleanValue=function(e,t,r){r||(r=!1);var n=r,i=this.getNodeAttributeValue(e,t);i.length>0&&(n="t"===i.toLowerCase().charAt(0));return n},this.getSubNodeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValue(n):r},this.getSubNodeWholeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValues(n):r},this.getSubNodeBooleanValue=function(e,t,r){r=void 0===r?"false":r;var n=this.getSubNodeValue(e,t);return n.length>0&&"t"===n.toLowerCase().charAt(0)||!(n.length>0&&"f"===n.toLowerCase().charAt(0))&&r}}},function(e,t,r){var n=r(27),i=r(28),a=r(29),o=r(9)(),s=function(e,t,s){function l(e,t){if(e&&e.length>0)for(var r=0;r<e.length;r++)e[r]=e[r].replace("[ERRORCODE]",t)}function u(e,t){for(var r=e,n="AD DETECTED="+("SUCCESS"===t.substr(0,7)?"SUCCESS":"NONE")+" :: Reason="+t+", playerTechnology="+(K.hasOwnProperty("playerTechnology")?JSON.stringify(K.playerTechnology):"unknown")+", platform="+Pe.getPlatformType()+", Ad tree path=",i="";-1!==r;){var a=Ne[r].children[0];if(a){var o=Ce.getNodeAttributeValue(a,"id");i.length>0&&(i=" -> "+i),i=o+i}r=Ne[r].parentIdx}G.info(Q,n+i)}function c(e){var t=Ce.getSubNode(e,"VASTAdTagURI");if(!t)return u(Ie,"INVALID WRAPPER NODE"),void(0===Ne.length?T("300","invalid wrapper node"):S());var n=Ce.getNodeValues(t);if(!n||0===n.length)return u(Ie,"EMPTY VASTAdTagURI"),void(0===Ne.length?T("300","Invalid VASTAdTagURI node value"):S());if(_e)return u(Ie,"terminated"),void $(!1,re,"terminated",null,Be);if(Ve=!0,Ee>="4.0"){var i=Ce.getNodeAttributeBooleanValue(e,"followAdditionalWrappers",!0);Ne[Ie].state.followAdditionalWrappers=i,i=Ce.getNodeAttributeBooleanValue(e,"allowMultipleAds",!1),Ne[Ie].state.allowMultipleAds=i,""!==(i=Ce.getNodeAttributeValue(e,"fallbackOnNoAd"))&&(Y=Ce.getNodeAttributeBooleanValue(e,"fallbackOnNoAd"))}Je=n,r(11).load(n,(function(e,t){return _e?(u(Ie,"terminated"),void $(!1,re,"terminated",null,Be)):void(e||0===t.length?(u(Ie,"VASTAdTagURI TIMED OUT: "+n),0===Ne.length?T("301","Timeout of VAST URI provided in wrapper element"):S()):(Re=!1,_(t)))}),K.adServerTimeout?K.adServerTimeout:ne)}function d(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function p(e,t){if(e){var r=Ce.getSubNodes(e,"Error");if(r)for(var n=0;n<r.length;n++){var i=r[n],a=Ce.getNodeValues(i);a&&!d(t,a)&&t.push(a)}}}function f(e,t){if(e){var r=Ce.getSubNodes(e,"Impression");if(r)for(var n=0;n<r.length;n++){var i=r[n],a=Ce.getNodeValues(i);a&&!d(t,a)&&t.push(a)}}}function h(e,t){if(e){var r=Ce.getSubNode(e,"Linear",0);if(r){var n=Ce.getSubNode(r,"TrackingEvents");if(n){var i=Ce.getSubNodes(n,"Tracking");if(i)for(var a=0;a<i.length;a++){n=i[a];var o=Ce.getNodeValues(n);if(o){var s=Ce.getNodeAttributeValue(n,"event");if("progress"===s){var l=Ce.getNodeAttributeValue(n,"offset");s=l?"progress_"+l:""}s&&(t.hasOwnProperty(s)?d(t[s],o)||t[s].push(o):(t[s]=[],t[s].push(o)))}}}}}}function g(e,t){if(e){var r=Ce.getSubNode(e,"CompanionAds");r&&(r.innerHTML&&r.innerHTML.length>0||r.textContent&&r.textContent.length>0)&&i.parse(Ne[t].state.companions,r,Ce)}}function v(e,t){if(e){var r=Ce.getSubNode(e,"Icons");r&&(r.innerHTML&&r.innerHTML.length>0||r.textContent&&r.textContent.length>0)&&a.parse(Ne[t].state.icons,r,Ce)}}function m(e,t,r){if(e){var n=Ce.getSubNode(e,"Linear",0);if(n){var i=null,a=Ce.getSubNode(n,"VideoClicks");if(a){var o=Ce.getSubNode(a,"ClickThrough");o&&((i=Ce.getNodeValues(o))&&!d(t,i)&&t.push(i));var s=Ce.getSubNodes(a,"ClickTracking");if(s)for(var l=0;l<s.length;l++)o=s[l],(i=Ce.getNodeValues(o))&&!d(r,i)&&r.push(i)}}}}function y(e,t){if(e){var r=Ce.getSubNode(e,"ViewableImpression",0);if(r){var n,i=null,a=null,o=Ce.getSubNodes(r,"Viewable");if(o&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.viewable,i)&&t.viewable.push(i);if((o=Ce.getSubNodes(r,"NotViewable"))&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.notViewable,i)&&t.notViewable.push(i);if((o=Ce.getSubNodes(r,"ViewUndetermined"))&&o.length>0)for(n=0;n<o.length;n++)a=o[n],(i=Ce.getNodeValues(a))&&!d(t.undetermined,i)&&t.undetermined.push(i)}}}function b(e){return"video/x-flv"===e||"video/x-f4v"===e||"video/f4v"===e||"application/x-shockwave-flash"===e}function A(e){return"video/webm"===e||"video/ogg"===e||"application/javascript"===e||"application/x-javascript"===e}function w(e,t,r,n){var i=null;if(e){if((i={}).type=Ce.getNodeAttributeValue(e,"type"),-1===n.indexOf(i.type)&&n.push(i.type),!i.type||0===i.type.length)return null;var a=Ce.getNodeAttributeValue(e,"codec");if(a&&a.length>0&&((a=(a=a.trim()).length>2?a:"").length>0&&(i.codec=a)),!function(e,t){return Pe.canPlay(e,t)}(i.type,a))return null;if(K&&!function(e){if(K.playerTechnology&&Array.isArray(K.playerTechnology)&&K.playerTechnology.length>0){for(var t=!1,r=0;r<K.playerTechnology.length;r++){var n=K.playerTechnology[r].toLowerCase();if(!b(e.toLowerCase())&&!A(e.toLowerCase())){t=!0;break}if("flash"===n&&!A(e.toLowerCase())){t=!0;break}if("html5"===n&&!b(e.toLowerCase())){t=!0;break}}if(!t)return!1}return!(K.hasOwnProperty("supportVpaid")&&!K.supportVpaid&&function(e){return"application/x-shockwave-flash"===e||"application/javascript"===e||"application/x-javascript"===e}(e.toLowerCase()))}(i.type))return null;i.url=t,i.variation="Media#"+r,i.delivery=Ce.getNodeAttributeValue(e,"delivery");var o=Ce.getNodeAttributeNumberValue(e,"bitrate",-1);-1!==o&&(i.bitrate=o),i.width=Ce.getNodeAttributeNumberValue(e,"width"),i.height=Ce.getNodeAttributeNumberValue(e,"height");var s=Ce.getNodeAttributeValue(e,"scalable");s.length>0&&(i.scalable=Ce.getNodeAttributeBooleanValue(e,"scalable",!0)),(s=Ce.getNodeAttributeValue(e,"maintainAspectRatio")).length>0&&(i.maintainAspectRatio=Ce.getNodeAttributeBooleanValue(e,"maintainAspectRatio",!0));var l=Ce.getNodeAttributeValue(e,"apiFramework");l&&l.length>0&&(i.apiFramework=l.toUpperCase())}return i}function k(e){ge=0,ve="",he="",ie=[],ae=null,oe=[];var t="",r=[];if(e){var n=Ce.getSubNode(e,"Linear",0);if(n){var i=Ce.getSubNode(n,"Duration");if(i){var a=Ce.getNodeValue(i);ge=function(e,t){var r=e.indexOf("%");if(r>0)return t&&t>0?Number(e.substring(0,r)):0;var n=(r=e.indexOf("."))>0?Number(e.substring(r+1)):0;r>0&&(e=e.substring(0,r));var i=e.split(":");return 3===i.length?1e3*(3600*Number(i[0])+60*Number(i[1])+Number(i[2]))+n:0}(a,-1)}var o=Ce.getNodeAttributeValue(n,"skipoffset");if(ve=o,he=Ce.getSubNodeWholeValue(n,"AdParameters",""),i=Ce.getSubNode(n,"MediaFiles")){var s,l=Ce.getSubNodes(i,"MediaFile");if(l){for(var u=0;u<l.length;u++)if(i=l[u],(s=Ce.getNodeValues(i)).length>0){var c=w(i,s,u,r);c&&ie.push(c)}if(0===ie.length)t="INCOMPATIBLE MEDIA TYPE, Available = "+JSON.stringify(r);else{i=Ce.getSubNode(n,"MediaFiles"),ae=Ce.getSubNodeWholeValue(i,"Mezzanine","");var d=Ce.getSubNodes(i,"InteractiveCreativeFile");if(d&&d.length>0)for(var p=0;p<d.length;p++){var f=d[p];if(s=Ce.getNodeValues(f)){var h=Ce.getNodeAttributeValue(f,"type"),g=Ce.getNodeAttributeValue(f,"apiFramework");oe.push({url:s,type:h,apiFramework:g})}}}}else t="MISSING MEDIA FILES"}else t="MISSING MEDIA FILES"}else t="INVALID VAST STRUCTURE"}return t}function T(e,t){var r=de.concat(pe);l(r,e),ye&&ye.length>0&&(l(ye,"303"),r=r.concat(ye)),G.error(Q,"Error "+e+" - "+t),$(!1,re,"vast"+e,r,Be)}function S(){var e=Ne[Ie].state;if(e&&Array.isArray(e.arrErrorUrls)&&e.arrErrorUrls.forEach((function(e){pe.push(e)})),Ie>=0){if(Ne[Ie].children[0]=null,Ne[Ie].children.splice(0,1),0===Ne[Ie].children.length){var t=Ne[Ie].parentIdx;return Ne.splice(Ie,1),-1===(Ie=t)?void(Me&&Le.length>0?(G.info(Q,"Waterfall: Vast XML node count detected: # csm nodes: "+He+", # rtb nodes: "+We),$(!0,re,Le,null)):ze&&Le.length>0?(G.info(Q,"VMAP: Ad XML node count detected: "+Le.length),$(!0,re,Le,null)):T("900","no Ad available")):void S()}ee=Ie,Ne[Ie].state=C(),z(Ne[Ie].children[0])}}function C(){return{arrTrackings:{},arrImpressions:[],arrClickUrls:[],arrClickTrackings:[],arrErrorUrls:[],sExtensions:"",sequence:ze?0:1,companions:{required:"unknown",companions:[]},icons:[],arrViewableImpressions:{viewable:[],notViewable:[],undetermined:[]}}}function V(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"notifyurl");r&&r.length>0&&(Oe[t]=r)}}function E(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"creativeId");r&&r.length>0&&(Xe[t]=r)}}function x(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"buyerMemberId");r&&r.length>0&&(Ue[t]=r)}}function N(e){var t=Ce.getNodeAttributeValue(e,"id");if(t.length>0){var r=Ce.getNodeAttributeValue(e,"viewabilityConfig");r&&r.length>0&&(Fe[t]=r)}}function I(){if(me&&me.length>0)for(var e=0;e<me.length;e++){var t=me[e],r=Ce.getNodeValues(t);r&&!d(ye,r)&&ye.push(r)}}function _(e){(new Date).getTime(),ye=[],te=e;var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r.trim()}(e);if(0===t.length)return u(Ie,"EMPTY VAST"),void(0===Ne.length?T("110","no bid response for mediation"):S());var r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{G.error(Q,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","VAST XML parsing error"):S())}}else{if(void 0===window.ActiveXObject)return G.error(Q,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)"),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","Failed to get vast xml"):S());try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return G.error(Q,r.parseError),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100",r.parseError.errorCode+", Error reason = "+r.parseError.reason):S())}catch(e){return G.error(Q,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("100","Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)"):S())}}if(!r)return u(Ie,"INVALID VAST STRUCTURE"),void(0===Ne.length?T("102","VAST XML parsing error"):S());var n=Ce.getSubNode(r,"VAST");if(!n||!n.firstChild)return u(Ie,"EMPTY VAST"),void(0===Ne.length?T("110","no bid response for mediation"):S());me=Ce.getSubNodes(n,"Error");var i=function(e){var t="unknown";return e&&(t=(t=Ce.getNodeAttributeValue(e,"version")).trim()).length>3&&(t=t.substr(0,3)),t}(n);if(function(e){return"2.0"===e||"3.0"===e||"4.0"===e||"4.1"===e}(i)){Re&&((Me=Ce.getNodeAttributeBooleanValue(n,"apn_waterfall"))&&(K.waterfall=!0));var a=Ce.getSubNodes(n,"Ad");if(!a||0===a.length)return I(),u(Ie,"NO AD NODE"),void(0===Ne.length?T("900","no Ad available"):S());for(var o=[],s=0;s<a.length;s++){if(Re){var l=Ce.getNodeAttributeValue(a[s],"id");l&&(l+="_suffix"+s,a[s].id=l)}if(Ee>="4.0"&&Ie>0&&!Ne[Ie].state.allowMultiAds){if(Ce.getNodeAttributeValue(a[s],"sequence"))continue;if(o.length>0)break}o.push(a[s]),Me&&Re&&V(a[s]),Re&&(x(a[s]),E(a[s]),N(a[s]))}if(0===o.length)return I(),u(Ie,"NO VALID AD NODES"),void(0===Ne.length?T("900","no Ad available"):S());var c={parentIdx:Ie,currentIdx:0,children:o,state:C()};Ne.push(c),c.currentIdx=Ne.length-1,Ie=c.currentIdx,z(Ne[Ie].children[0],i)}else u(Ie,"INVALID VAST VERSION: "+i),0===Ne.length?T("102","VAST version not supported"):S()}function P(e){for(var t in Ne[e].state.arrTrackings)for(var r=0;r<Ne[e].state.arrTrackings[t].length;r++)be.hasOwnProperty(t)?d(be[t],Ne[e].state.arrTrackings[t][r])||be[t].push(Ne[e].state.arrTrackings[t][r]):(be[t]=[],be[t].push(Ne[e].state.arrTrackings[t][r]));return be}function M(e){for(var t=0;t<Ne[e].state.arrImpressions.length;t++)d(Ae,Ne[e].state.arrImpressions[t])||Ae.push(Ne[e].state.arrImpressions[t]);return Ae}function L(e){for(var t=0;t<Ne[e].state.arrClickUrls.length;t++)d(we,Ne[e].state.arrClickUrls[t])||we.push(Ne[e].state.arrClickUrls[t]);return we}function R(e){for(var t=0;t<Ne[e].state.arrClickTrackings.length;t++)d(ke,Ne[e].state.arrClickTrackings[t])||ke.push(Ne[e].state.arrClickTrackings[t]);return ke}function O(e){for(var t=0;t<Ne[e].state.arrErrorUrls.length;t++)d(Te,Ne[e].state.arrErrorUrls[t])||Te.push(Ne[e].state.arrErrorUrls[t]);return Te}function B(e){return Ne[e].state.sExtensions.length>0&&(fe+=Ne[e].state.sExtensions),fe}function U(e){for(var t=e;t>0;){var r=Ne[t].parentIdx;i.mergeCompanions(Ne[r].state.companions,Ne[t].state.companions),t=r}return"unknown"===Ne[t].state.companions.required&&delete Ne[t].state.companions.required,Ne[t].state.companions}function D(e){for(var t={required:"unknown",companions:[]},r=e;r>=0;)i.mergeCompanions(t,Ne[r].state.companions),r=Ne[r].parentIdx;return t}function F(e,t){for(var r=0;r<e.length;r++)if(e[r].program.toLowerCase()===t.toLowerCase())return!0;return!1}function j(e,t){for(var r=0;r<e.length;r++)if(e[r].program.toLowerCase()===t.toLowerCase())return void e.splice(r,1)}function X(e){for(var t=e;t>0;){for(var r=Ne[t].parentIdx,n=0;n<Ne[t].state.icons.length;n++)F(Ne[r].state.icons,Ne[t].state.icons[n].program)&&j(Ne[r].state.icons,Ne[t].state.icons[n].program),Ne[r].state.icons.push(Ne[t].state.icons[n]);t=r}return Ne[t].state.icons}function q(e){for(var t=[],r=e;r>=0;){for(var n=0;n<Ne[r].state.icons.length;n++)F(t,Ne[r].state.icons[n].program)||t.push(Ne[r].state.icons[n]);r=Ne[r].parentIdx}return t}function H(e){var t;for(t=0;t<Ne[e].state.arrViewableImpressions.viewable.length;t++)d(Se.viewable,Ne[e].state.arrViewableImpressions.viewable[t])||Se.viewable.push(Ne[e].state.arrViewableImpressions.viewable[t]);for(t=0;t<Ne[e].state.arrViewableImpressions.notViewable.length;t++)d(Se.notViewable,Ne[e].state.arrViewableImpressions.notViewable[t])||Se.notViewable.push(Ne[e].state.arrViewableImpressions.notViewable[t]);for(t=0;t<Ne[e].state.arrViewableImpressions.undetermined.length;t++)d(Se.undetermined,Ne[e].state.arrViewableImpressions.undetermined[t])||Se.undetermined.push(Ne[e].state.arrViewableImpressions.undetermined[t]);return Se}function W(e){var t=e,r=t.indexOf("_suffix");return r>0&&(t=t.substring(0,r)),t}function z(e,t){var r=Ce.getSubNode(e,"Wrapper"),n=null!==r;if(n||(r=Ce.getSubNode(e,"InLine")),!r)return I(),u(Ie,"MISSING WRAPPER / INLINE NODE"),void S();if(++ee>Z)return u(Ie,"Reach Wrapper limit"),void S();t>Ee&&(Ee=t);var i=Ce.getNodeAttributeValue(e,"id");if(Oe.hasOwnProperty(i)&&(Be=Oe[i]),Xe.hasOwnProperty(i)&&(qe=Xe[i]),Ue.hasOwnProperty(i)&&(De=Ue[i]),Fe.hasOwnProperty(i)&&(je=Fe[i]),0===Ie){var a=Ce.getNodeAttributeValue(e,"sequence");a&&(Ne[Ie].state.sequence=parseInt(a)),Ce.getNodeAttributeValue(e,"conditionalAd")&&(xe=Ce.getNodeAttributeBooleanValue(e,"conditionalAd"))}if(p(r,Ne[Ie].state.arrErrorUrls),f(r,Ne[Ie].state.arrImpressions),h(r,Ne[Ie].state.arrTrackings),m(r,Ne[Ie].state.arrClickUrls,Ne[Ie].state.arrClickTrackings),function(e,t){if(e){var r=Ce.getSubNode(e,"Extensions");r&&r.innerHTML&&r.innerHTML.length>0?Ne[t].state.sExtensions=Ne[t].state.sExtensions+r.innerHTML.toString():r&&r.textContent&&r.textContent.length>0&&(Ne[t].state.sExtensions=Ne[t].state.sExtensions+r.textContent.toString())}}(r,Ie),g(r,Ie),v(r,Ie),y(r,Ne[Ie].state.arrViewableImpressions),pe=[],n){if(Ee>="4.0"&&Ie>0&&!Ne[Ie-1].state.followAdditionalWrappers)return u(Ie,"Additional Wrappers are not allowed"),void S();c(r)}else{var o=k(r);if(0===ie.length||o.length>0)return u(Ie,o),void S();be=JSON.parse(JSON.stringify(se)),Ae=le.slice(0),we=ue.slice(0),ke=ce.slice(0),Te=de.slice(0),fe="";var s=JSON.stringify(function(e){for(var t=e;t>=0;)P(t),t=Ne[t].parentIdx;return be}(Ne[Ie].parentIdx)),l=JSON.stringify(function(e){for(var t=e;t>=0;)M(t),t=Ne[t].parentIdx;return Ae}(Ne[Ie].parentIdx)),d=JSON.stringify(function(e){for(var t=e;t>=0;)L(t),t=Ne[t].parentIdx;return we}(Ne[Ie].parentIdx)),b=JSON.stringify(function(e){for(var t=e;t>=0;)R(t),t=Ne[t].parentIdx;return ke}(Ne[Ie].parentIdx)),A=JSON.stringify(function(e){for(var t=e;t>=0;)O(t),t=Ne[t].parentIdx;return Te}(Ne[Ie].parentIdx)),w=function(e){for(var t=e;t>=0;)B(t),t=Ne[t].parentIdx;return fe}(Ne[Ie].parentIdx),T=JSON.stringify(D(Ne[Ie].parentIdx)),C=JSON.stringify(q(Ne[Ie].parentIdx));fe="";var V=U(Ie);V=function(e){var t,r,n,i=[],a=[],o=e.companions;if(!e.companions)return e;for(r=o.length-1;r>=0;r--)if((t=o[r]).StaticResource||t.IFrameResource||t.HTMLResource){var s=!1;for(n=0;n<i.length;n++)if(t.width===i[n].width&&t.height===i[n].height){s=!0;break}s||i.push(t)}else a.push(t);for(r=0;r<a.length;r++)for(n=0;n<i.length;n++)a[r].width===i[n].width&&a[r].height===i[n].height&&(a[r].id&&a[r].id===i[n].id||!a[r].id)&&(a[r].CompanionClickTracking&&(i[n].CompanionClickTracking||(i[n].CompanionClickTracking=[]),i[n].CompanionClickTracking=i[n].CompanionClickTracking.concat(a[r].CompanionClickTracking)),a[r].TrackingEvents&&(i[n].TrackingEvents||(i[n].TrackingEvents=[]),i[n].TrackingEvents=i[n].TrackingEvents.concat(a[r].TrackingEvents)));var l={companions:i};return e.required&&(l.required=e.required),l}(V);var E={vastVersion:Ee,withWrapper:Ve,mediaFiles:ie,trackingUrls:P(Ie),impressionUrls:M(Ie),clickUrls:L(Ie),clickTrackingUrls:R(Ie),errorUrls:O(Ie),durationMsecs:ge,skipOffset:ve,extensions:B(Ie),adParameters:he,vastXml:te,extTrackingUrls:s,extImpressionUrls:l,extClickUrls:d,extClickTrackingUrls:b,extErrorUrls:A,extExtensions:w,adId:W(i),sequence:Ne[0].state.sequence,companionAds:V,extCompanions:T,icons:X(Ie),extIcons:C,finalVastUri:Je};if(Ee.substr(0,1)>"3"){var x=function(e){var t=Ce.getSubNodes(e,"Creative");if(t&&t.length>0)for(var r=0;r<t.length;r++)if(Ce.getSubNode(t[r],"Linear"))return Ce.getSubNode(t[r],"UniversalAdId");return null}(r);if(x){var N=Ce.getNodeAttributeValue(x,"idRegistry"),_=Ce.getNodeAttributeValue(x,"idValue");if(0===N.length||0===_.length)return u(Ie,"universalAdId is invalid"),void S();E.universalAdId={idRegistry:N,idValue:_}}E.conditionalAd=xe;var F=function(e){var t=[],r=Ce.getSubNodes(e,"Category");if(r&&r.length>0)for(var n=0;n<r.length;n++){var i=Ce.getNodeValues(r[n]);if(i&&i.length>0){var a=Ce.getNodeAttributeValue(r[n],"authority");t.push({category:i,authority:a})}}return t.length>0?t:null}(r);if(F){for(var j=0;j<F.length;j++)if(!F[j].category||!F[j].authority)return u(Ie,"invalid Category node"),void S();E.categories=F}var z=JSON.stringify(function(e){for(var t=e;t>=0;)H(t),t=Ne[t].parentIdx;return Se}(Ne[Ie].parentIdx)),G=H(Ie);G&&G.viewable.length+G.notViewable.length+G.undetermined.length>0&&(E.extViewableImpression=z,E.viewableImpression=G);var Q=function(e){var t=[],r=Ce.getSubNode(e,"AdVerifications");if(r){var n=Ce.getSubNodes(r,"Verification");if(n&&n.length>0)for(var i=0;i<n.length;i++){var a,o,s,l=n[i],u=Ce.getNodeAttributeValue(l,"vendor"),c=[],d=[],p=Ce.getSubNodes(l,"JavaScriptResource");if(p&&p.length>0)for(s=0;s<p.length;s++){a=Ce.getNodeValues(p[s]);var f=Ce.getNodeAttributeValue(p[s],"apiFramework"),h=Ce.getNodeAttributeBooleanValue(p[s],"browserOptional");c.push({url:a,framework:f,browserOptional:h})}if((p=Ce.getSubNodes(l,"FlashResource"))&&p.length>0)for(s=0;s<p.length;s++)a=Ce.getNodeValues(p[s]),o=Ce.getNodeAttributeValue(p[s],"apiFramework"),d.push({url:a,framework:o});var g=Ce.getSubNodeWholeValue(l,"ViewableImpression"),v={},m=!1,y=Ce.getSubNode(l,"TrackingEvents");if(y){var b=Ce.getSubNodes(y,"Tracking");if(b&&b.length>0)for(s=0;s<b.length;s++){a=Ce.getNodeValues(b[s]);var A=Ce.getNodeAttributeValue(b[s],"event");A&&a&&(m=!0,v.hasOwnProperty(A)?v[A].push(a):v[A]=[a])}}var w=Ce.getSubNodeWholeValue(l,"VerificationParameters"),k={};u&&(k.vendor=u),c.length>0&&(k.jsResources=c),d.length>0&&(k.flashResources=d),g&&(k.viewableImpression=g),m&&(k.trackingEvents=v),w&&(k.verificationParameters=w),t.push(k)}}return t.length>0?t:null}(r);Q&&Q.length>0&&(E.adVerifications=Q),ae&&(E.mezzanine=ae),oe&&oe.length>0&&(E.interactiveCreativeFiles=oe),void 0!==Y&&(E.fallbackOnNoAd=Y)}Me&&Be.length>0&&(E.notifyurl=Be),qe.length>0&&(E.creative_id=qe),De.length>0&&(E.buyerMemberId=De),je.length>0&&(E.viewabilityConfig=je);var K=!1;if(Me){var ne=Ce.getNodeAttributeValue(e,"rtb");ne&&"true"===ne&&(K=!0,E.rtb=!0)}if(_e)return u(Ie,"terminated"),void $(!1,re,"terminated",null,Be);for(var me=[],ye=0;ye<ie.length;ye++)-1===me.indexOf(ie[ye].type)&&me.push(ie[ye].type);u(Ie,"SUCCESS, Available="+JSON.stringify(me)),Me?(Le.push(E),K?We++:He++,S()):ze?(E.vastXml=J(E.vastXml,E.sequence),Le.push(E),S()):$(!0,re,E,null)}}function J(e,t){for(var r=(new DOMParser).parseFromString(e,"text/xml"),n=Ce.getSubNode(r,"VAST"),i=Ce.getSubNodes(n,"Ad"),a=0;a<i.length;){var s=Ce.getNodeAttributeValue(i[a],"sequence");s&&parseInt(s)!==t?n.removeChild(i[a]):a++}return"ie"===o.browser.name.toLowerCase()?(new XMLSerializer).serializeToString(r.childNodes[0]):r.childNodes[0].outerHTML}var Y,G=r(3),Q="VAST Parser",$=null,K=s,Z=K&&K.wrapperLimit&&K.wrapperLimit>0?K.wrapperLimit:5,ee=0,te=null,re=e,ne=t&&t>0?t:1e3,ie=[],ae=null,oe=[],se={},le=[],ue=[],ce=[],de=[],pe=[],fe="",he="",ge=0,ve="",me=null,ye=[],be={},Ae=[],we=[],ke=[],Te=[],Se={viewable:[],notViewable:[],undetermined:[]},Ce=new n,Ve=!1,Ee="",xe=!1,Ne=[],Ie=-1,_e=!1,Pe=r(10),Me=!1,Le=[],Re=!1,Oe={},Be="",Ue={},De="",Fe={},je="",Xe={},qe="",He=0,We=0,ze=s.vmap,Je="";G.always(Q,"Version 3.1.17"),this.parse=function(e,t,r,n){$=n,function(e,t){var r,n,i,a;if(t&&le.push(t.trim()),e)if(Array.isArray(e)&&1===e.length){var o=e[0];if(o.impression_urls)for(n=0;n<o.impression_urls.length;n++)r=o.impression_urls[n].trim(),le.push(r);if(o.error_urls)for(n=0;n<o.error_urls.length;n++)r=o.error_urls[n].trim(),de.push(r);if(o.video_click_urls)for(n=0;n<o.video_click_urls.length;n++)r=o.video_click_urls[n].trim(),ce.push(r);for(a in o.video_events)for(i=o.video_events[a],n=0;n<i.length;n++)r=i[n].trim(),se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r]}else for(a in e)if("service"!==a)if(Array.isArray(e[a]))for(i=e[a],n=0;n<i.length;n++)r=i[n].trim(),"click"===a?ce.push(r):"error"===a?de.push(r):"impression"===a?le.push(r):se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r];else r=e[a].trim(),"click"===a?ce.push(r):"error"===a?de.push(r):"impression"===a?le.push(r):se.hasOwnProperty(a)?d(se[a],r)||se[a].push(r):se[a]=[r]}(t,r),Re=!0,_(e)},this.terminate=function(){_e=!0}},l=r(30),u=r(31);e.exports={parse:function(e,t,r,n,i,a,o){var l=new s(r,n,o);return l.parse(e,i,a,(function(e,r,n,i,a){t&&t(e,r,n,i,a),l=null})),l},getUnwrappedVastTag:function(e,t,r,n,i,a,o,s){if(!e||!e.vastXml)return null;var u=new l(e,t,r,n,i,a,o,s),c=u.addTrackers();return u=null,c},getMergedVastTag:function(e){if(!e||0===e.length)return null;var t=new u(e),r=t.getVastXml();return t=null,r}}},function(e,t){e.exports=function(){this.getSubNodes=function(e,t){var r=e.getElementsByTagName(t);return r.length>0?r:null},this.getSubNode=function(e,t,r){r||(r=0);var n=e.getElementsByTagName(t);return n.length>r?n[r]:null},this.getNodeValue=function(e){if(0===e.childNodes.length)return"";var t=e.childNodes[0].nodeValue;return t?t.trim():""},this.getNodeValues=function(e){if(0===e.childNodes.length)return"";for(var t="",r=0;r<e.childNodes.length;r++){var n=e.childNodes[r].nodeValue;n&&(t+=n)}return t.trim()},this.getNodeAttributeValue=function(e,t){var r=e.getAttribute(t);return null===r&&(r=""),r},this.getNodeAttributeNumberValue=function(e,t,r){r||(r=0);var n=r,i=this.getNodeAttributeValue(e,t);return i.length>0&&(n=i.indexOf(".")>=0?parseFloat(i):parseInt(i)),n},this.getNodeAttributeBooleanValue=function(e,t,r){r||(r=!1);var n=r,i=this.getNodeAttributeValue(e,t);i.length>0&&(n="t"===i.toLowerCase().charAt(0));return n},this.getSubNodeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValue(n):r},this.getSubNodeWholeValue=function(e,t,r){r=void 0===r?"":r;var n=this.getSubNode(e,t);return null!==n?this.getNodeValues(n):r},this.getSubNodeBooleanValue=function(e,t,r){r=void 0===r?"false":r;var n=this.getSubNodeValue(e,t);return n.length>0&&"t"===n.toLowerCase().charAt(0)||!(n.length>0&&"f"===n.toLowerCase().charAt(0))&&r}}},function(e,t){var r={parse:function(e,t,r){var n=r.getNodeAttributeValue(t,"required");n&&n.length>0&&(e.required=n);var i=r.getSubNodes(t,"Companion");if(i)for(var a=0;a<i.length;a++){var o=i[a],s={},l=r.getNodeAttributeNumberValue(o,"width",-1),u=r.getNodeAttributeNumberValue(o,"height",-1);if(!(l<=0||u<=0)){s.width=l,s.height=u;var c=r.getNodeAttributeValue(o,"id");c&&(s.id=c),(c=r.getNodeAttributeNumberValue(o,"assetWidth",-1))>0&&(s.assetWidth=c),(c=r.getNodeAttributeNumberValue(o,"assetHeight",-1))>0&&(s.assetHeight=c),(c=r.getNodeAttributeNumberValue(o,"expandedWidth",-1))>0&&(s.expandedWidth=c),(c=r.getNodeAttributeNumberValue(o,"expandedHeight",-1))>0&&(s.expandedHeight=c),(c=r.getNodeAttributeValue(o,"apiFramework"))&&(s.apiFramework=c),(c=r.getNodeAttributeValue(o,"adSlotID"))&&(s.adSlotID=c);var d=r.getNodeAttributeNumberValue(o,"pxratio",1);1!==d&&(s.pxratio=d),(c=r.getNodeAttributeValue(o,"required"))&&(s.required=c),(c=r.getSubNodeValue(o,"AltText"))&&(s.AltText=c),(c=r.getSubNodeValue(o,"AdParameters"))&&(s.AdParameters=c);var p=r.getSubNode(o,"StaticResource");if(p&&(c=r.getNodeAttributeValue(p,"creativeType"))){var f="video/x-flv"===c||"video/x-f4v"===c||"video/f4v"===c||"application/x-shockwave-flash"===c,h=!1;if(/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(h=!0),h&&f)continue;var g={type:c};(c=r.getNodeValues(p))&&(g.src=c,s.StaticResource=g)}(c=r.getSubNodeWholeValue(o,"IFrameResource"))&&(s.IFrameResource=c),(c=r.getSubNodeWholeValue(o,"HTMLResource"))&&(s.HTMLResource=c),(c=r.getSubNodeValue(o,"CompanionClickThrough"))&&(s.CompanionClickThrough=c);var v,m,y,b=r.getSubNodes(o,"CompanionClickTracking");if(b)for(s.CompanionClickTracking=[],v=0;v<b.length;v++)m=b[v],(y=r.getNodeValues(m))&&s.CompanionClickTracking.push(y);var A=r.getSubNodes(o,"Tracking");if(A)for(s.TrackingEvents=[],v=0;v<A.length;v++){m=A[v];var w=r.getNodeAttributeValue(m,"event");y=r.getNodeValues(m),w&&y&&s.TrackingEvents.push({eventType:w,url:y})}e.companions.push(s)}}},mergeCompanions:function(e,t){"unknown"===e.required&&(e.required=t.required),e.companions=e.companions.concat(t.companions)},createCompanionNode:function(e,t){var r,n,i,a,o=e.createElement("Companion"),s=["id","width","height","assetWidth","assetHeight","expandedWidth","expandedHeight","apiFramework","adSlotID","required"];for(r=0;r<s.length;r++)t.hasOwnProperty(s[r])&&((i=e.createAttribute(s[r])).value=t[s[r]],o.setAttributeNode(i));t.hasOwnProperty("StaticResource")&&(n=e.createElement("StaticResource"),(i=e.createAttribute("creativeType")).value=t.StaticResource.type,n.setAttributeNode(i),a=e.createCDATASection(t.StaticResource.src),n.appendChild(a),o.appendChild(n));var l=["AdParameters","IFrameResource","HTMLResource","CompanionClickThrough"];for(r=0;r<l.length;r++)t.hasOwnProperty(l[r])&&(n=e.createElement(l[r]),a=e.createCDATASection(t[l[r]]),n.appendChild(a),o.appendChild(n));if(t.hasOwnProperty("AltText")){n=e.createElement("AltText");try{n.innerHTML=t.AltText}catch(e){try{n.textContent=t.AltText}catch(e){}}o.appendChild(n)}if(t.hasOwnProperty("CompanionClickTracking"))for(r=0;r<t.CompanionClickTracking.length;r++){var u=e.createElement("CompanionClickTracking");a=e.createCDATASection(t.CompanionClickTracking[r]),u.appendChild(a),o.appendChild(u)}if(t.hasOwnProperty("TrackingEvents")){for(n=e.createElement("TrackingEvents"),r=0;r<t.TrackingEvents.length;r++){var c=e.createElement("Tracking");(i=e.createAttribute("event")).value=t.TrackingEvents[r].eventType,c.setAttributeNode(i),a=e.createCDATASection(t.TrackingEvents[r].url),c.appendChild(a),n.appendChild(c)}o.appendChild(n)}return o}};e.exports=r},function(e,t){var r={parse:function(e,t,r){var n=r.getSubNodes(t,"Icon");if(n)for(var i=0;i<n.length;i++){var a=n[i],o={},s=r.getNodeAttributeNumberValue(a,"width",-1),l=r.getNodeAttributeNumberValue(a,"height",-1),u=r.getNodeAttributeValue(a,"program"),c=r.getNodeAttributeValue(a,"xPosition"),d=r.getNodeAttributeValue(a,"yPosition");if(!(s<=0||l<=0||0===u.length||0===c.length||0===d.length)){o.width=s,o.height=l,o.program=u,o.xPosition=c,o.yPosition=d;var p=r.getNodeAttributeValue(a,"apiFramework");p&&(o.apiFramework=p);var f=r.getNodeAttributeNumberValue(a,"pxratio",1);if(1!==f&&(o.pxratio=f),p=r.getNodeAttributeValue(a,"offset")){if(isNaN(Date.parse("January 1, 1970 "+p)))continue;o.offset=p}if(p=r.getNodeAttributeValue(a,"duration")){if(isNaN(Date.parse("January 1, 1970 "+p)))continue;o.duration=p}var h=r.getSubNode(a,"StaticResource");if(h&&(p=r.getNodeAttributeValue(h,"creativeType"))){var g="video/x-flv"===p||"video/x-f4v"===p||"video/f4v"===p||"application/x-shockwave-flash"===p,v=!1;if(/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(v=!0),v&&g)continue;var m={type:p};(p=r.getNodeValues(h))&&(m.src=p,o.StaticResource=m)}if((p=r.getSubNodeWholeValue(a,"IFrameResource"))&&(o.IFrameResource=p),(p=r.getSubNodeWholeValue(a,"HTMLResource"))&&(o.HTMLResource=p),o.StaticResource||o.IFrameResource||o.HTMLResource){var y=r.getSubNode(a,"IconClicks");if(y&&((p=r.getSubNodeValue(a,"IconClickThrough"))&&(o.IconClickThrough=p),p=r.getSubNodes(y,"IconClickTracking"))){o.IconClickTracking=[];for(var b=0;b<p.length;b++)o.IconClickTracking.push(r.getNodeValues(p[b]))}var A=r.getSubNodes(a,"IconViewTracking");if(A){o.IconViewTracking=[];for(var w=0;w<A.length;w++)o.IconViewTracking.push(r.getNodeValues(A[w]))}(function(e,t){for(var r=0;r<e.length;r++)e[r].program===t&&e.splice(r,1)})(e,u),e.push(o)}}}},createIconNode:function(e,t){var r,n,i,a,o=e.createElement("Icon"),s=["width","height","program","xPosition","yPosition","apiFramework","offset","duration"];for(r=0;r<s.length;r++)t.hasOwnProperty(s[r])&&((i=e.createAttribute(s[r])).value=t[s[r]],o.setAttributeNode(i));t.hasOwnProperty("StaticResource")&&(n=e.createElement("StaticResource"),(i=e.createAttribute("creativeType")).value=t.StaticResource.type,n.setAttributeNode(i),a=e.createCDATASection(t.StaticResource.src),n.appendChild(a),o.appendChild(n));var l=["IFrameResource","HTMLResource","IconViewTracking"];for(r=0;r<l.length;r++)t.hasOwnProperty(l[r])&&(n=e.createElement(l[r]),a=e.createCDATASection(t[l[r]]),n.appendChild(a),o.appendChild(n));if(t.hasOwnProperty("IconClickThrough")||t.hasOwnProperty("IconClickTracking")){var u=e.createElement("IconClicks");t.hasOwnProperty("IconClickThrough")&&(n=e.createElement("IconClickThrough"),a=e.createCDATASection(t.IconClickThrough),n.appendChild(a),u.appendChild(n)),t.hasOwnProperty("IconClickTracking")&&(n=e.createElement("IconClickTracking"),a=e.createCDATASection(t.IconClickTracking),n.appendChild(a),u.appendChild(n)),o.appendChild(u)}return o}};e.exports=r},function(e,t,r){var n=r(27),i=r(28),a=r(29);e.exports=function(e,t,o,s,l,u,c,d){function p(e,t){var r=E.createCDATASection(t);e.appendChild(r)}function f(e,t){var r=V.getSubNodes(e,"Icon");if(r&&r.length>0)for(var n=0;n<r.length;n++){if(V.getNodeAttributeValue(r[n],"program").toLowerCase()===t.toLowerCase())return!0}return!1}function h(e){var t,r;if(y.extTrackingUrls&&"string"==typeof y.extTrackingUrls&&y.extTrackingUrls.length>5){var n=JSON.parse(y.extTrackingUrls),i=V.getSubNode(e,"TrackingEvents");for(var o in i||(i=E.createElement("TrackingEvents"),e.appendChild(i)),n){var s=n[o];for(t=0;t<s.length;t++){var l=E.createElement("Tracking"),u=E.createAttribute("event");u.value=o,l.setAttributeNode(u),p(l,s[t]),i.appendChild(l)}}delete y.extTrackingUrls}if(y.extClickUrls&&"string"==typeof y.extClickUrls){var c=JSON.parse(y.extClickUrls);if(Array.isArray(c)&&c.length>0&&((r=V.getSubNode(e,"VideoClicks"))||(r=E.createElement("TrackingEvents"),e.appendChild(r)),!V.getSubNode(r,"ClickThrough"))){var d=E.createElement("ClickThrough");p(d,c[0]),r.appendChild(d)}delete y.extClickUrls}if(y.extClickTrackingUrls&&"string"==typeof y.extClickTrackingUrls){var h=JSON.parse(y.extClickTrackingUrls);if(Array.isArray(h)&&h.length>0)for((r=V.getSubNode(e,"VideoClicks"))||(r=E.createElement("VideoClicks"),e.appendChild(r)),t=0;t<h.length;t++){var g=E.createElement("ClickTracking");p(g,h[t]),r.appendChild(g)}delete y.extClickTrackingUrls}if(y.extIcons&&"string"==typeof y.extIcons){var v=JSON.parse(y.extIcons);if(Array.isArray(v)&&v.length>0){var m=V.getSubNode(e,"Icons");for(m||(m=E.createElement("Icons"),e.appendChild(m)),t=0;t<v.length;t++)if(!f(m,v[t].program)){var b=a.createIconNode(E,v[t]);b&&m.appendChild(b)}}delete y.extIcons}}function g(e,t){var r,n,a={companions:[]};i.parse(a,e,V);var o=a.companions;if(t.StaticResource||t.IFrameResource||t.HTMLResource){var s=!1;for(n=0;n<o.length;n++)if(t.width===o[n].width&&t.height===o[n].height){s=!0;break}s||(r=i.createCompanionNode(E,t),e.appendChild(r))}else{var l=!1;for(n=0;n<o.length;n++)if(t.width===o[n].width&&t.height===o[n].height&&(t.id&&t.id===o[n].id||!t.id)){t.CompanionClickTracking&&(o[n].CompanionClickTracking||(o[n].CompanionClickTracking=[]),o[n].CompanionClickTracking=o[n].CompanionClickTracking.concat(t.CompanionClickTracking)),t.TrackingEvents&&(o[n].TrackingEvents||(o[n].TrackingEvents=[]),o[n].TrackingEvents=o[n].TrackingEvents.concat(t.TrackingEvents)),l=!0;break}if(l){for(;e.firstChild;)e.removeChild(e.firstChild);for(var u=0;u<o.length;u++)r=i.createCompanionNode(E,o[u]),e.appendChild(r)}}}var v=r(3),m="VAST Parser",y=e,b=t,A=o,w=d,k=l,T=s,S=u,C=c,V=new n,E=function(e){var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r}(e),r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{v.error(m,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return null}}else{if(void 0===window.ActiveXObject)return v.error(m,"Failed to get vast xml parser"),null;try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return v.error(m,r.parseError),null}catch(e){return v.error(m,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),null}}return r}(e.vastXml);(function(e){if(E){var t=V.getSubNode(E,"VAST");if(t){var r=E.createAttribute("version");r.value=e,t.setAttributeNode(r)}}})(e.vastVersion),function(){if(E){var e=V.getSubNode(E,"VAST");if(e){var t=V.getSubNodes(e,"Ad");if(t&&t.length>0)for(var r=0;r<t.length;r++){if(A){var n=E.createAttribute("notifyurl");n.value=A,t[r].setAttributeNode(n)}if(T&&"rtb"===T){var i=E.createAttribute("rtb");i.value="true",t[r].setAttributeNode(i)}var a=E.createAttribute("sequence");if(a.value=y.sequence.toString(),t[r].setAttributeNode(a),k){var o=E.createAttribute("buyerMemberId");o.value=k,t[r].setAttributeNode(o)}if(S){var s=E.createAttribute("viewabilityConfig");s.value=S,t[r].setAttributeNode(s)}if(w){var l=E.createAttribute("creativeId");l.value=w,t[r].setAttributeNode(l)}}}}}();var x=null;this.addTrackers=function(){if(!E)return"";var e=function(){if(b){var e=V.getSubNode(E,"VAST"),t=E.createAttribute("adtoken");t.value=b,e.setAttributeNode(t)}var n,i,a,o=V.getSubNode(E,"InLine");if(!o)return null;if(y.extImpressionUrls&&"string"==typeof y.extImpressionUrls){var s=JSON.parse(y.extImpressionUrls);if(Array.isArray(s)&&s.length>0)for(n=0;n<s.length;n++)p(i=E.createElement("Impression"),s[n]),o.appendChild(i);delete y.extImpressionUrls}if(C&&C.impressions)for(n=0;n<C.impressions.length;n++)C.impressions[n]&&(p(i=E.createElement("Impression"),C.impressions[n]),o.appendChild(i));if(y.extErrorUrls&&"string"==typeof y.extErrorUrls){var l=JSON.parse(y.extErrorUrls);if(Array.isArray(l)&&l.length>0)for(n=0;n<l.length;n++)p(a=E.createElement("Error"),l[n]),o.appendChild(a);delete y.extErrorUrls}if(C&&C.errors)for(n=0;n<C.errors.length;n++)C.errors[n]&&(p(a=E.createElement("Error"),C.errors[n]),o.appendChild(a));if(y.extViewableImpression&&"string"==typeof y.extViewableImpression){var u=JSON.parse(y.extViewableImpression),c=E.createElement("ViewableImpression");if(Array.isArray(u.viewable)&&u.viewable.length>0)for(n=0;n<u.viewable.length;n++){var d=E.createElement("Viewable");p(d,u.viewable[n]),c.appendChild(d)}if(Array.isArray(u.notViewable)&&u.notViewable.length>0)for(n=0;n<u.notViewable.length;n++){var f=E.createElement("NotViewable");p(f,u.notViewable[n]),c.appendChild(f)}if(Array.isArray(u.undetermined)&&u.undetermined.length>0)for(n=0;n<u.undetermined.length;n++){var h=E.createElement("ViewUndetermined");p(h,u.undetermined[n]),c.appendChild(h)}o.appendChild(c),delete y.extViewableImpression}var g=r(9)().browser.name.toLowerCase();if(y.extExtensions&&"string"==typeof y.extExtensions){var v=y.extExtensions;if(v.length>0){var m=V.getSubNode(o,"Extensions");m?"ie"===g?m.textContent=m.textContent.toString()+v:m.innerHTML=m.innerHTML.toString()+v:(m=E.createElement("Extensions"),o.appendChild(m),"ie"===g?m.textContent=v:m.innerHTML=v)}delete y.extExtensions}(x=V.getSubNode(o,"Creatives"))||(x=E.createElement("Creatives"),o.appendChild(x));var A=V.getSubNode(x,"Linear");if(!A){var w=E.createElement("Creative");x.appendChild(w),A=E.createElement("Linear"),w.appendChild(A)}return A}();if(!e)return"";h(e),x&&function(){if(y.extCompanions&&"string"==typeof y.extCompanions){var e=JSON.parse(y.extCompanions);if(Array.isArray(e.companions)&&e.companions.length>0){var t,r=V.getSubNode(x,"CompanionAds");r||(r=E.createElement("CompanionAds"),x.appendChild(r)),"unknown"!==e.required&&((t=E.createAttribute("required")).value=e.required,r.setAttributeNode(t));for(var n=0;n<e.companions.length;n++)g(r,e.companions[n])}}}();var t,n=r(9)().browser.name.toLowerCase();if("edge"===n)t=E.childNodes[0].outerHTML;else if("ie"===n){for(var i=E.getElementsByTagName("AdParameters"),a=0;a<i.length;a++)i[a].textContent.indexOf("]]>")>0&&"<![CDATA["!==i[a].textContent.substr(0,9)&&(i[a].textContent=i[a].textContent.replace(/]]>/g,"]]]]><![CDATA[>"),i[a].textContent="<![CDATA["+i[a].textContent+"]]>");t=(t=(t=(new XMLSerializer).serializeToString(E)).replace(/&lt;/g,"<")).replace(/&gt;/g,">")}else t=(new XMLSerializer).serializeToString(E);return t}}},function(e,t,r){var n=r(27);e.exports=function(e){function t(e){var t=function(e){var t=e.indexOf("<"),r=e.substr(-1===t?0:t);return-1!==(t=r.lastIndexOf(">"))&&(r=r.substr(0,t+1)),r}(e),r=null;if(void 0!==window.DOMParser){if("parsererror"===(r=(new DOMParser).parseFromString(t,"text/xml")).documentElement.nodeName){try{i.error(a,"Error reason = "+r.documentElement.childNodes[0].nodeValue)}catch(e){}return null}}else{if(void 0===window.ActiveXObject)return i.error(a,"Failed to get vast xml parser"),null;try{if((r=new window.ActiveXObject("Microsoft.XMLDOM")).loadXML(t),0!==r.parseError.errorCode)return i.error(a,r.parseError),null}catch(e){return i.error(a,"Failed to parse vast xml by window.ActiveXObject(Microsoft.XMLDOM)",e),null}}return r}var i=r(3),a="VAST Parser",o=e,s=new n,l=t(o[0]);if(l){var u=s.getSubNode(l,"VAST"),c=l.createAttribute("apn_waterfall");c.value=!0,u.setAttributeNode(c);for(var d=[],p=0;p<o.length;p++){var f=t(o[p]),h=s.getSubNode(f,"VAST"),g=s.getSubNodes(h,"Ad");if(g&&g.length>0)for(var v=0;v<g.length;v++)d.push(g[v])}d.sort((function(e,t){return s.getNodeAttributeNumberValue(e,"sequence")-s.getNodeAttributeNumberValue(t,"sequence")}));var m=r(9)().browser.name.toLowerCase();for("ie"===m?u.textContent="":u.innerHTML="",p=0;p<d.length;p++)u.appendChild(d[p]);this.getVastXml=function(){if(!l)return"";var e;if("edge"===m)e=l.childNodes[0].outerHTML;else if("ie"===m){for(var t=l.getElementsByTagName("AdParameters"),r=0;r<t.length;r++)t[r].textContent.indexOf("]]>")>0&&"<![CDATA["!==t[r].textContent.substr(0,9)&&(t[r].textContent=t[r].textContent.replace(/]]>/g,"]]]]><![CDATA[>"),t[r].textContent="<![CDATA["+t[r].textContent+"]]>");e=(e=(e=(new XMLSerializer).serializeToString(l)).replace(/&lt;/g,"<")).replace(/&gt;/g,">")}else e=(new XMLSerializer).serializeToString(l);return e}}}},function(e,t,r){var n=r(3),i=r(17);try{r(33)}catch(e){}var a=r(2),o=r(9),s=r(34),l=r(16),u="apnVmapVast->vastManager";e.exports=function(){function e(e){n.log(u,(e?"Show":"Hide")+" ad cover with spinner"),e?(M.style.display="block",A.el().classList.add("vjs-waiting")):(M.style.display="none",A.el().classList.remove("vjs-waiting"))}function t(){e(!1),setTimeout((function(){x=!1,k&&A.markers.reset(JSON.parse(k))}),1e3),S.style.display="none",A.off("vast.adError",t),A.off("vast.adsCancel",t),A.off("vast.adSkip",t),A.off("vast.reset",t),A.off("vast.contentEnd",t),A.off("adFinished",t),A.off("trace.message",g),A.off("trace.event",v),l.showNextOverlay(!0),O=!1,V&&L.length>0&&A.one("ended",(function(){setTimeout((function(){!O&&V&&A.playlist.next()}),500)}))}function r(e,t){if(!e||"start"===e)return 0;if("end"===e)return N>0?N:A.duration()>0?N=parseInt(A.duration())-.5:(A.one("loadedmetadata",(function(){N=parseInt(A.duration())-.5,t(N)})),-1);if(!(e.indexOf(":")>0)){if(e.indexOf("%")>0){var r=parseInt(e.substr(0,e.indexOf("%")));return N>0?parseInt(N*r/100):A.duration()>0?(N=parseInt(A.duration())-.5,parseInt(N*r/100)):(A.one("loadedmetadata",(function(){N=parseInt(A.duration())-.5,t(parseInt(N*r/100))})),-1)}return n.warn(u,"Invalid time format: "+e),0}try{var i=parseInt(e.substr(0,e.indexOf(":")));e=e.substr(3,e.length-3);var a,o=parseInt(e.substr(0,e.indexOf(":")));if((e=e.substr(3,e.length-3)).indexOf(".")>0)a=parseInt(e.substr(0,e.indexOf("."))),e=e.substr(3,e.length-3),parseInt(e)>=500&&a++;else a=parseInt(e);return 3600*i+60*o+a}catch(e){return n.warn(u,"Failed to convert time to seconds"),0}}function c(e){return!(w.frequencyRules&&w.frequencyRules.playlistClips&&w.frequencyRules.playlistClips>1)||0===e%w.frequencyRules.playlistClips}function d(){if(O=!0,e(!0),R++,T&&A.markers&&A.markers.destroy&&A.markers.destroy(),V){if(c(A.playlist.currentIndex()))return y(V),void(V=null);e(!1),A.playlist.autoadvance(0)}else b.getXML(w,A,(function(t,r,i){V=t,r?(e(!1),A.playlist.autoadvance(0),n.error(u,"Error to get VAST xml for next playlist item. Eror code: "+r+". Error message: "+i)):c(A.playlist.currentIndex())?(y(V),V=null):(e(!1),A.playlist.autoadvance(0))}))}function p(){(L=A.playlist&&"function"==typeof A.playlist?A.playlist():[])||(L=[]),L.length>0&&R<L.length?V||b.getXML(w,A,(function(e){V=e})):A.off("playlistitem",d)}function f(){N=parseInt(A.duration())-.5,A.off("loadedmetadata",f),n.log(u,"loadedmetadata event, duration: "+N)}function h(){if(w&&w.apnTagParams){var e="auto";0===A.currentTime()&&(e=A.autoplay()?"auto":"click");var t=A.muted()?"off":"on";w.initialPlayback=e,w.initialAudio=t}}function g(e){n.log(u,"trace event message: "+e.data.message),w.pageNotificationCallback&&w.pageNotificationCallback("message",e.data.message)}function v(e){n.log(u,"trace event: "+e.data.event),w.pageNotificationCallback&&w.pageNotificationCallback("event",e.data.event)}function m(){A.one("loadedmetadata",f),A.one("vast.adStart",(function(){e(!1),S.style.display="block",x=!0,C&&s.sharedInstance().run({userSyncTargetElement:A.el_,usersync_url:C})})),A.on("vast.adError",t),A.on("vast.adsCancel",t),A.on("vast.adSkip",t),A.on("vast.reset",t),A.on("vast.contentEnd",t),A.on("adFinished",t),A.on("trace.message",g),A.on("trace.event",v)}function y(t){if(w.timeOffset){var n={markerStyle:{width:"5px","border-radius":"10%","background-color":"white"},markerTip:{display:!1},onMarkerReached:function(t){I[t.time]&&((_=B&&0===t.time)&&A.playlist&&"function"==typeof A.playlist&&A.playlist.currentIndex()>0&&(_=!1),_?(A.bigPlayButton.el_.style.opacity=1,U?D?(A.bigPlayButton.el_.style.display="block",e(!1),A.one("play",(function(){F(I[t.time]),delete I[t.time]}))):setTimeout((function(){e(!1),A.pause(),A.bigPlayButton.el_.style.display="block",A.one("play",(function(){F(I[t.time]),delete I[t.time]}))}),1e3):(e(!1),A.one("play",(function(){F(I[t.time]),delete I[t.time]})))):(P=!1,0===t.time&&A.paused()&&(e(!1),P=!0,A.bigPlayButton.el_.style.display="block",A.bigPlayButton.el_.style.opacity=1),F(I[t.time]),delete I[t.time]))},markers:[]};T=new a(videojs);var i=r(w.timeOffset,(function(r){if(I[r]=t,T){var n=[];if(n.push({time:r}),k){var i=JSON.parse(k);i=i.concat(n),k=JSON.stringify(i)}else A.markers.add(n);r>1&&e(!1)}}));i>=0&&(n.markers.push({time:i}),I[i]=t,i>1&&e(!1)),T.init(A),T.markers(n)}else A.currentSrc()&&A.duration()>0?F(t):A.one("loadeddata",(function(){F(t)}))}var b,A,w,k,T,S,C,V,E=o(),x=!1,N=0,I={},_=!1,P=!1,M=document.getElementById("apn-break-cover"),L=[],R=-1,O=!1,B=E.device.type||E.device.model,U="ios"===E.os.name.toLowerCase(),D=B&&"iphone"===E.device.model.toLowerCase(),F=function(e){if(!x){m(),h(),(!B||!A.paused())&&A.pause(),x=!0,T&&(k=JSON.stringify(A.markers.getMarkers()));var t={verbosity:5,adTagXML:function(t){setTimeout((function(){t(null,e)}),0)},playAdAlways:!1,adCancelTimeout:w&&w.timeouts&&w.timeouts.adStartTimeout?w.timeouts.adStartTimeout:3e3,adsEnabled:!0,initialPlayback:w.initialPlayback,initialAudio:w.initialAudio};w&&w.skippable&&w.skippable.skipText&&(t.skipText=w.skippable.skipText),w&&w.skippable&&w.skippable.skipButtonText&&(t.skipButtonText=w.skippable.skipButtonText),w&&w.viewability&&(w.viewability.contextId="anoutstream",t.viewability=w.viewability),w&&!1===w.clickThruEnabled&&(t.disableClickThru=!0),w&&w.skippable&&w.skippable.hasOwnProperty("enabled")&&(t.skippable={},t.skippable.enabled=w.skippable.enabled,t.skippable.videoThreshold=1e3*w.skippable.videoThreshold,t.skippable.videoOffset=1e3*w.skippable.videoOffset),w&&w.wrapperLimit&&w.wrapperLimit>0&&(t.wrapperLimit=w.wrapperLimit),A.vastClient(t),("click"!==w.initialPlayback||_)&&(P||setTimeout((function(){A.play()}),0)),l.showNextOverlay(!1),p()}};this.play=function(t,r){A=t,w=r,M||((M=document.createElement("div")).id="apn-break-cover",M.style.width="100%",M.style.height="100%",M.style.backgroundColor="black",M.style.position="absolute",M.style.zIndex=101,A.el().appendChild(M)),M.style.display="none",(S=document.createElement("p")).className="vjs-overlay",S.innerHTML=w.adText?w.adText:"Ad",S.style.display="none",S.style.left="10px",A.el().appendChild(S),w&&w.usersyncUrl&&(C=w.usersyncUrl),(isNaN(A.duration())||A.duration()<=0)&&e(!0),(b=new i).getXML(w,A,(function(t,r,i){r?(n.error(u,"Error to get VAST xml. Eror code: "+r+". Error message: "+i),B?setTimeout((function(){e(!1),A.bigPlayButton.el_.style.display="block",A.one("play",(function(){A.bigPlayButton.el_.style.display="none"}))}),500):e(!1)):A.duration()>0?y(t):(e(!0),E.device.type||E.device.model?(!0===A.autoplay()&&A.autoplay("any"),A.one("loadedmetadata",(function(){y(t)}))):(setTimeout((function(){A.paused()&&"block"!==A.bigPlayButton.el_.style.display&&!x&&(e(!1),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.one("click",(function(){A.bigPlayButton.el_.style.display="none"})))}),1e3),A.one("playing",(function(){A.paused()?(e(!1),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.one("click",(function(){A.bigPlayButton.el_.style.display="none",y(t)}))):(A.bigPlayButton.el_.style.display="none",y(t))})))),setTimeout((function(){A.on("playlistitem",d)}),1e3)}))},this.stop=function(){x&&A.trigger("vast.adsCancel"),T&&A.markers.destroy()},this.test=function(){return{convertStringToSeconds:r,setDuration:function(e){N=e},setOptions:function(e){w=e},options:function(){return w},setPlaybackMethodData:h,resetContent:t,nextListItemHandler:d,getXmlForNextPlaylistItem:p,playAd:F,play:y,setPlayer:function(e){A=e},setAdIndicator:function(e){S=e},setImpbusCommunicator:function(e){b=e},getPlaylistCreative:function(){return V},setAdPlaying:function(e){x=e},getMarker:function(){return I}}}}},function(e,t,r){!function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,r,n)}return r[o].exports}for(var a=!1,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";function n(e,t,r){}function i(e,t,r){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:r})}var a=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];n.prototype.handshakeVersion=function(e,t){},n.prototype.initAd=function(e,t,r,n,i,a,o){},n.prototype.startAd=function(e){},n.prototype.stopAd=function(e){},n.prototype.skipAd=function(e){},n.prototype.resizeAd=function(e,t,r,n){},n.prototype.pauseAd=function(e){},n.prototype.resumeAd=function(e){},n.prototype.expandAd=function(e){},n.prototype.collapseAd=function(e){},n.prototype.subscribe=function(e,t,r){},n.prototype.unsubscribe=function(e,t){},n.prototype.getAdLinear=function(e){},n.prototype.getAdWidth=function(e){},n.prototype.getAdHeight=function(e){},n.prototype.getAdExpanded=function(e){},n.prototype.getAdSkippableState=function(e){},n.prototype.getAdRemainingTime=function(e){},n.prototype.getAdDuration=function(e){},n.prototype.getAdVolume=function(e){},n.prototype.getAdCompanions=function(e){},n.prototype.getAdIcons=function(e){},n.prototype.setAdVolume=function(e,t){},i(n,"METHODS",a),i(n,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),i(n,"SETTERS",["setAdVolume"]),i(n,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var o=a.filter((function(e){return-1===["skipAd"].indexOf(e)}));i(n,"checkVPAIDInterface",(function(e){return o.every((function(t){return"function"==typeof e[t]}))})),t.exports=n},{}],2:[function(e,t,r){"use strict";function n(e,t,r,n){this._isValid=c(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=r,this._iframe=n,this._subscribers=new u,d.setFullSizeStyle(t),i.call(this))}function i(){if(h.forEach(function(e){this._creative.subscribe(o.bind(this,e),e)}.bind(this)),this._creative.subscribe(a.bind(this),f),this._videoEl){var e=this._iframe.contentDocument.documentElement,t=this._videoEl;e.addEventListener("click",(function(r){r.target===e&&t.click()}))}}function a(e,t,r){this._subscribers.triggerSync(f,{url:e,id:t,playerHandles:r})}function o(e){this._subscribers.trigger(e,Array.prototype.slice(arguments,1))}function s(e,t,r,n){e?e(r,n):r&&t.trigger(p,r)}var l=e("./IVPAIDAdUnit"),u=e("./subscriber"),c=l.checkVPAIDInterface,d=e("./utils"),p=(l.METHODS,"AdError"),f="AdClickThru",h=l.EVENTS.filter((function(e){return e!=f}));n.prototype=Object.create(l.prototype),n.prototype.isValidVPAIDAd=function(){return this._isValid},l.METHODS.forEach((function(e){-1===["subscribe","unsubscribe","initAd"].indexOf(e)&&(n.prototype[e]=function(){var t=l.prototype[e].length,r=Array.prototype.slice.call(arguments),n=t===r.length?r.pop():void 0;setTimeout(function(){var t,i=null;try{t=this._creative[e].apply(this._creative,r)}catch(e){i=e}s(n,this._subscribers,i,t)}.bind(this),0)})})),n.prototype.initAd=function(e,t,r,n,i,a,o){i=i||{},a=d.extend({slot:this._el,videoSlot:this._videoEl},a||{}),setTimeout(function(){var l;try{this._creative.initAd(e,t,r,n,i,a)}catch(e){l=e}s(o,this._subscribers,l)}.bind(this),0)},n.prototype.subscribe=function(e,t,r){this._subscribers.subscribe(t,e,r)},n.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},n.prototype.on=n.prototype.subscribe,n.prototype.off=n.prototype.unsubscribe,l.GETTERS.forEach((function(e){n.prototype[e]=function(t){setTimeout(function(){var r,n=null;try{r=this._creative[e]()}catch(e){n=e}s(t,this._subscribers,n,r)}.bind(this),0)}})),n.prototype.setAdVolume=function(e,t){setTimeout(function(){var r,n=null;try{this._creative.setAdVolume(e),r=this._creative.getAdVolume()}catch(e){n=e}n||(n=d.validate(r===e,"failed to apply volume: "+e)),s(t,this._subscribers,n,r)}.bind(this),0)},n.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},t.exports=n},{"./IVPAIDAdUnit":1,"./subscriber":4,"./utils":5}],3:[function(e,t,r){"use strict";function n(e,t,r,n){r=r||{},this._id=f(),this._destroyed=!1,this._frameContainer=p.createElementInEl(e,"div"),this._videoEl=t,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:r.template||g,extraOptions:r.extraOptions||{}}}function i(e){var t=this[e];t&&(t.remove(),delete this[e])}function a(){s.call(this),delete this._adUnit}function o(){s.call(this),u.call(this)}function s(){i.call(this,"_frame"),l.call(this)}function l(){this._onLoad&&(window.removeEventListener("message",this._onLoad),p.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function u(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function c(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function d(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var p=e("./utils"),f=p.unique("vpaidIframe"),h=e("./VPAIDAdUnit"),g='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>';n.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,o.call(this))},n.prototype.isDestroyed=function(){return this._destroyed},n.prototype.loadAdUnit=function(e,t){c.call(this),o.call(this);var r=this,n=p.createIframeWithContent(this._frameContainer,this._templateConfig.template,p.extend({iframeURL_JS:e,iframeID:this.getID(),origin:d()},this._templateConfig.extraOptions));this._frame=n,this._onLoad=p.callbackTimeout(this._vpaidOptions.timeout,function(e){if(e.origin===d()&&JSON.parse(e.data).id===r.getID()){var n,i,o;if(r._frame.contentWindow?(o=r._frame.contentWindow.getVPAIDAd,i=p.validate("function"==typeof o,"the ad didn't return a function to create an ad")):i="the iframe is not anymore in the DOM tree",!i){var s=r._frame.contentWindow.document.querySelector(".ad-element");(n=new h(o(),s,r._videoEl,r._frame)).subscribe("AdStopped",a.bind(r)),i=p.validate(n.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return r._adUnit=n,l.call(r),t(i,i?null:n),!0}}.bind(this),function(){t("timeout",null)}.bind(this)),window.addEventListener("message",this._onLoad)},n.prototype.unloadAdUnit=function(){o.call(this)},n.prototype.getID=function(){return this._id},t.exports=n},{"./VPAIDAdUnit":2,"./utils":5}],4:[function(e,t,r){"use strict";function n(){this._subscribers={}}n.prototype.subscribe=function(e,t,r){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:r,eventName:t})},n.prototype.unsubscribe=function(e,t){this._subscribers[t]=this.get(t).filter((function(t){return e!==t.handler}))},n.prototype.unsubscribeAll=function(){this._subscribers={}},n.prototype.trigger=function(e,t){var r=this;this.get(e).concat(this.get("*")).forEach((function(e){setTimeout((function(){r.isHandlerAttached(e.handler,e.eventName)&&e.handler.call(e.context,t)}),0)}))},n.prototype.triggerSync=function(e,t){this.get(e).concat(this.get("*")).forEach((function(e){e.handler.call(e.context,t)}))},n.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]},n.prototype.isHandlerAttached=function(e,t){return this.get(t).some((function(t){return e===t.handler}))},t.exports=n},{}],5:[function(e,t,r){"use strict";function n(){}function i(e){var t=u[e];t&&(clearTimeout(t),delete u[e])}function a(e,t,r){var n=document.createElement("iframe");return n.src=t||"about:blank",n.marginWidth="0",n.marginHeight="0",n.frameBorder="0",n.width="100%",n.height="100%",o(n),r&&(n.style.zIndex=r),n.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(n),n}function o(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"}function s(e,t){return Object.keys(t).forEach((function(r){var n="object"==typeof n?JSON.stringify(t[r]):t[r];e=e.replace(new RegExp("{{"+r+"}}","g"),n)})),e}function l(e,t){var r=e.contentWindow&&e.contentWindow.document;return!!r&&(r.write(t),!0)}var u={};t.exports={noop:n,validate:function(e,t){return e?null:new Error(t)},clearCallbackTimeout:i,callbackTimeout:function(e,t,r){var a,o;return o=setTimeout((function(){t=n,delete o[a],r()}),e),a=function(){t.apply(this,arguments)&&i(a)},u[a]=o,a},createElementInEl:function(e,t,r){var n=document.createElement(t);return r&&(n.id=r),e.appendChild(n),n},createIframeWithContent:function(e,t,r){var n=a(e,null,r.zIndex);if(l(n,s(t,r)))return n},createIframe:a,setFullSizeStyle:o,simpleTemplate:s,setIframeContent:l,extend:function(e,t){return Object.keys(t).forEach((function(r){e[r]=t[r]})),e},unique:function(e){var t=-1;return function(){return e+"_"+ ++t}}}},{}],6:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.player=e,this.icons=[],this.controlBarTimer=null,void this.cbHidden):new n(e)}var i=e("../vast/VASTError"),a=e("../../utils/async"),o=e("../../utils/playerUtils"),s=e("../../utils/utilityFunctions");n.prototype.renderIcons=function(e,t){var r=this;return t=t||s.noop,Array.isArray(e)&&0!==e.length?void a.waterfall([function(t){t(null,e)},this._createIcons.bind(this),this._setupEvents.bind(this),this._renderIcons.bind(this)],(function(e,n){e&&n&&r._trackError(e,n),t(e,n)})):t(new i("On IconIntegrator, missing required icon array"))},n.prototype._createIcons=function(e,t){function r(e){var t=null;if(e.staticResource){["image/gif","image/jpeg","image/png"].indexOf(e.creativeType)&&(t="<img src='"+e.staticResource+"' width='"+e.width+"' height='"+e.height+"'>")}return t}function n(e){for(var t=0;t<a.icons.length;t++)if(a.icons[t].icon.program===e)return t;return-1}for(var a=this,o=0;o<e.length;o++){var s={};s.icon=e[o];var l=n(s.icon.program);l>=0&&this.icons.splice(l,1),s.content=r(s.icon),s.content&&this.icons.push(s)}t(this.icons.length>0?null:new i("Could not create AdIcon content",900))},n.prototype._setupEvents=function(e){var t=this.player,r=this;return o.once(t,["vast.adEnd","vast.adsCancel","vast.adSkip","adStop"],(function(){if(r.icons.length>0){r.controlBarTimer&&(clearInterval(r.controlBarTimer),r.controlBarTimer=null);for(var e=0;e<r.icons.length;e++){var n=r.icons[e];n.div&&t.el().removeChild(n.div)}r.icons=[]}})),e(null)},n.prototype._renderIcons=function(){function e(r,n,i,a){for(var o=0;o<i.icons.length;o++){var s=i.icons[o];if("block"===s.div.style.display&&s.div!=r.div&&t(r.div,s.div)){if(s.div.style.top&&s.div.style.top.length>0){var l=s.origY-n;l<0&&(l=0),s.div.style.top=l+"px"}else s.div.style.bottom=s.origY+n+"px";++a<5&&e(s,n,i,a)}}}function t(e,t){var r=function(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect();return n.top<=r.top&&r.top<=n.bottom&&n.top<=r.bottom&&r.bottom<=n.bottom&&n.left<=r.left&&r.left<=n.right&&n.left<=r.right&&r.right<=n.right};return function(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect();return!(r.top>n.bottom||r.right<n.left||r.bottom<n.top||r.left>n.right)}(e,t)||r(e,t)||r(t,e)}function r(e){e.forEach((function(e){(new Image).src=e}))}function n(e){return function(){e.div.removeEventListener("click",n(e)),r(e.icon.iconClickTrackings),a.pause(),window.open(e.icon.iconClickThrough,"_blank")}}function i(e,n){var i=e.icon.offset&&e.icon.offset>0?e.icon.offset:0;setTimeout((function(){e.div.style.display="block",r(e.icon.iconViewTrackings);for(var i=0;i<o.icons.length;i++)if(o.icons[i].div&&o.icons[i].div!=e.div&&t(o.icons[i].div,e.div)){var s=o.icons[i].div.getBoundingClientRect();if("top"===n)e.div.style.top=o.icons[i].div.offsetTop+o.icons[i].div.offsetHeight+1+"px",e.origY=o.icons[i].div.offsetTop+o.icons[i].div.offsetHeight+1;else{var l=o.player.el().getBoundingClientRect();e.div.style.bottom=l.height+l.top-s.top+1+"px",e.origY=l.height+l.top-s.top+1}}if(e.icon.duration&&e.icon.duration>0){var u=e.icon.duration;setTimeout((function(){var t=o.icons.indexOf(e);t>=0&&(a.el().removeChild(e.div),o.icons.splice(t,1))}),u)}}),i)}for(var a=this.player,o=this,l=0;l<this.icons.length;l++){var u=this.icons[l],c="left",d=0,p="top",f=0;u&&"left"===u.icon.xPosition&&(c="left",d=0),u&&"right"===u.icon.xPosition&&(c="right",d=0),u&&Number(u.icon.xPosition)>=0&&(c="left",d=Number(u.xPosition)),u&&"bottom"===u.icon.yPosition&&(p="bottom",f=0,f+=0),u&&"top"===u.icon.yPosition&&(p="top",f=0,f+=0),u&&Number(u.icon.yPosition)>=0&&(p="top",f=Number(u.icon.yPosition),f+=0);var h=a.el().ownerDocument.createElement("div");a.el().appendChild(h),h.setAttribute("name","adicon"),h.id="adicon_"+u.icon.program,h.innerHTML=u.content,h.style.position="absolute",h.style[c]=d+"px",h.style[p]=f+"px",h.style.zIndex=2147483647,h.style.display="none",u.origY=f,h.style.width=u.width+"px",h.style.height=u.height+"px",u.div=h,u.icon.iconClickThrough&&(u.div.style.cursor="pointer",u.div.addEventListener("click",n(u))),i(u,p)}this.icons.length>0&&(this.controlBarTimer=setInterval((function(){var r=window.getComputedStyle(o.player.controlBar.el(),null),n="hidden"===r.backfaceVisibility||"none"!=r.transform;if(n!=o.cbHidden){o.cbHidden=n;for(var i=n?0:o.player.controlBar.el().offsetHeight,a=0;a<o.icons.length;a++){var s=o.icons[a];if(s.div&&"block"===s.div.style.display)if(i>0){if(t(s.div,o.player.controlBar.el())){if(s.div.style.top&&s.div.style.top.length>0){var l=s.origY-i;l<0&&(l=0),s.div.style.top=l+"px"}else s.div.style.bottom=s.origY+i+"px";e(s,i,o,1)}}else s.div.style.top&&s.div.style.top.length>0?s.div.style.top=s.origY+"px":s.div.style.bottom=s.origY+i+"px"}}}),s.isIE11()?100:500))},t.exports=n},{"../../utils/async":38,"../../utils/playerUtils":43,"../../utils/utilityFunctions":45,"../vast/VASTError":19}],7:[function(e,t,r){"use strict";function n(e){return this instanceof n?void this.initialize(e):new n(e)}var i=e("./InLine"),a=e("./Wrapper");n.prototype.initialize=function(e){this.id=e.attr("id"),this.sequence=e.attr("sequence"),4===window.mol_vastVersion&&(this.conditionalAd=e.attr("conditionalAd")),e.inLine&&(this.inLine=new i(e.inLine)),e.wrapper&&(this.wrapper=new a(e.wrapper))},t.exports=n},{"./InLine":12,"./Wrapper":26}],8:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.authority=e.attr("authority"),void(this.category=i.keyValue(e))):new n(e)}var i=e("../../utils/xml"),a=e("../../utils/utilityFunctions");n.parseCategories=function(e){var t=[];return t&&(a.isArray(e)?e:[e]).forEach((function(e){var r=new n(e);r.category&&r.category.length>0&&r.authority&&r.authority.length>0&&t.push(new n(e))})),t},t.exports=n},{"../../utils/utilityFunctions":45,"../../utils/xml":46}],9:[function(e,t,r){"use strict";var n=e("./TrackingEvent"),i=e("../../utils/utilityFunctions"),a=e("../../utils/xml"),o=e("../../utils/consoleLogger");t.exports=function e(t){if(!(this instanceof e))return new e(t);o.info("<Companion> found companion ad"),o.debug("<Companion>  companionJTree:",t),this.creativeType=a.attr(t.staticResource,"creativeType"),this.staticResource=a.keyValue(t.staticResource),o.info("<Companion>  creativeType: "+this.creativeType),o.info("<Companion>  staticResource: "+this.staticResource);var r=null;a.keyValue(t.HTMLResource)?r=a.keyValue(t.HTMLResource):a.keyValue(t.hTMLResource)&&(r=a.keyValue(t.hTMLResource)),null!==r&&o.info("<Companion> found html resource",r),this.htmlResource=r;var s=null;a.keyValue(t.IFrameResource)?s=a.keyValue(t.IFrameResource):a.keyValue(t.iFrameresource)&&(s=a.keyValue(t.iFrameresource)),null!==s&&o.info("<Companion> found iframe resource",s),this.iframeResource=s,this.id=a.attr(t,"id"),this.width=a.attr(t,"width"),this.height=a.attr(t,"height"),this.assetWidth=a.attr(t,"assetWidth"),this.assetHeight=a.attr(t,"assetHeight"),this.expandedWidth=a.attr(t,"expandedWidth"),this.expandedHeight=a.attr(t,"expandedHeight"),this.apiFramework=a.attr(t,"apiFramework"),this.adSlotID=a.attr(t,"adSlotID"),this.companionClickThrough=a.keyValue(t.companionClickThrough),this.trackingEvents=function(e){var t=[];return i.isDefined(e)&&(e=i.isArray(e)?e:[e]).forEach((function(e){t.push(new n(e))})),t}(t.trackingEvents&&t.trackingEvents.tracking),4===window.mol_vastVersion&&(this.pxratio=a.attr(t,"pxratio")),o.info("<Companion>  companionClickThrough: "+this.companionClickThrough)}},{"../../utils/consoleLogger":39,"../../utils/utilityFunctions":45,"../../utils/xml":46,"./TrackingEvent":16}],10:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);if(this.id=e.attr("id"),this.sequence=e.attr("sequence"),this.adId=e.attr("adId"),this.apiFramework=e.attr("apiFramework"),e.linear&&(this.linear=new i(e.linear)),e.companionAds){var t=[],r=e.companionAds&&e.companionAds.companion;s.isDefined(r)&&(r=s.isArray(r)?r:[r]).forEach((function(e){t.push(new a(e))})),this.companionAds=t}4===window.mol_vastVersion&&(this.universalAdId=new o(e.universalAdId))}var i=e("./Linear"),a=e("./Companion"),o=e("./UniversalAdId"),s=e("../../utils/utilityFunctions");n.prototype.isSupported=function(){return!this.linear||this.linear.isSupported()},n.parseCreatives=function(e){var t=[];return s.isDefined(e)&&s.isDefined(e.creative)&&(s.isArray(e.creative)?e.creative:[e.creative]).forEach((function(e){t.push(new n(e))})),t},t.exports=n},{"../../utils/utilityFunctions":45,"./Companion":9,"./Linear":14,"./UniversalAdId":17}],11:[function(e,t,r){"use strict";var n=e("../../utils/utilityFunctions"),i=e("../../utils/xml"),a=e("./parsers"),o=["program","width","height","xPosition","yPosition","duration","offset","apiFramework","pxratio"];t.exports=function e(t){function r(e){return e?(e=n.isArray(e)?e:[e],n.transformArray(e,(function(e){if(n.isNotEmptyString(e.keyValue))return e.keyValue}))):[]}if(!(this instanceof e))return new e(t);for(var s=0;s<o.length;s++){var l=o[s];this[l]=t.attr(l)}this.duration&&(this.duration=a.duration(this.duration)),this.offset&&(this.offset=a.duration(this.offset)),this.creativeType=i.attr(t.staticResource,"creativeType"),this.staticResource=i.keyValue(t.staticResource);var u=null;i.keyValue(t.HTMLResource)?u=i.keyValue(t.HTMLResource):i.keyValue(t.hTMLResource)&&(u=i.keyValue(t.hTMLResource)),this.htmlResource=u;var c=null;i.keyValue(t.IFrameResource)?c=i.keyValue(t.IFrameResource):i.keyValue(t.iFrameresource)&&(c=i.keyValue(t.iFrameresource)),this.iframeResource=c,this.iconViewTrackings=r(t.iconViewTracking),t.iconClicks&&(this.iconClickThrough=i.keyValue(t.iconClicks.iconClickThrough),this.iconClickTrackings=r(t.iconClicks.iconClickTracking))}},{"../../utils/utilityFunctions":45,"../../utils/xml":46,"./parsers":27}],12:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.adTitle=c.keyValue(e.adTitle),this.adSystem=c.keyValue(e.adSystem),this.impressions=i.parseImpressions(e.impression),this.creatives=a.parseCreatives(e.creatives),this.description=c.keyValue(e.description),this.advertiser=c.keyValue(e.advertiser),this.surveys=function(e){return e?u.transformArray(u.isArray(e)?e:[e],(function(e){if(u.isNotEmptyString(e.keyValue))return{uri:e.keyValue,type:e.attr("type")}})):[]}(e.survey),this.errors=i.parseErrors(e.error),this.pricing=c.keyValue(e.pricing),this.extensions=e.extensions,this.extensions&&(this.moat=function(e){if(e)return function(e){for(var t=0;t<e.length;t++){var r=e[t].extension;if(r&&r.moat){for(var n={},i=c.keyValue(r.moat).split(";"),a=0;a<i.length;a++){var o=i[a].split("=");o&&2===o.length&&(n[o[0]]=o[1])}return n}}}(u.isArray(e)?e:[e])}(this.extensions)),void(4===window.mol_vastVersion&&(e.category&&(this.categories=o.parseCategories(e.category)),e.viewableImpression&&(this.viewableImpression=new s(e.viewableImpression)),e.adVerifications&&(this.adVerifications=l.parseAdVerifications(e.adVerifications))))):new n(e)}var i=e("./vastUtil"),a=e("./Creative"),o=e("./Category"),s=e("./ViewableImpression"),l=e("./Verification"),u=e("../../utils/utilityFunctions"),c=e("../../utils/xml");n.prototype.isSupported=function(){var e,t;if(0===this.creatives.length)return!1;for(e=0,t=this.creatives.length;e<t;e+=1)if(!this.creatives[e].isSupported())return!1;return!0},t.exports=n},{"../../utils/utilityFunctions":45,"../../utils/xml":46,"./Category":8,"./Creative":10,"./Verification":23,"./ViewableImpression":25,"./vastUtil":28}],13:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.type=e.attr("type"),this.apiFramework=e.attr("apiFramework"),void(this.src=i.keyValue(e))):new n(e)}var i=e("../../utils/xml"),a=e("../../utils/utilityFunctions");n.parseInteractiveCreativeFiles=function(e){var t=[];return a.isDefined(e)&&(a.isArray(e)?e:[e]).forEach((function(e){t.push(new n(e))})),t},t.exports=n},{"../../utils/utilityFunctions":45,"../../utils/xml":46}],14:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.duration=c.duration(d.keyValue(e.duration)),this.mediaFiles=function(e){var t=[];return u.isDefined(e)&&(e=u.isArray(e)?e:[e]).forEach((function(e){t.push(new a(e))})),t}(e.mediaFiles&&e.mediaFiles.mediaFile),this.trackingEvents=function(e,t){var r=[];return u.isDefined(e)&&(e=u.isArray(e)?e:[e]).forEach((function(e){r.push(new i(e,t))})),r}(e.trackingEvents&&e.trackingEvents.tracking,this.duration),this.skipoffset=c.offset(d.attr(e,"skipoffset"),this.duration),this.duration&&window._molSettings&&window._molSettings.skippable&&(window._molSettings.skippable.enabled&&this.duration>=window._molSettings.skippable.videoThreshold?this.skipoffset=window._molSettings.skippable.videoOffset:this.skipoffset=null),e.videoClicks&&(this.videoClicks=new o(e.videoClicks)),e.adParameters&&(this.adParameters=d.keyValue(e.adParameters),d.attr(e.adParameters,"xmlEncoded")&&(this.adParameters=d.decode(this.adParameters))),4===window.mol_vastVersion&&(e.mediaFiles&&e.mediaFiles.mezzanine&&(this.mezzanine=d.keyValue(e.mediaFiles.mezzanine)),e.mediaFiles&&e.mediaFiles.interactiveCreativeFile&&(this.interactiveCreativeFiles=s.parseInteractiveCreativeFiles(e.mediaFiles.interactiveCreativeFile))),void(e.icons&&(this.icons=function(e){var t=[];return u.isDefined(e)&&(e=u.isArray(e)?e:[e]).forEach((function(e){t.push(new l(e))})),t}(e.icons&&e.icons.icon)))):new n(e)}var i=e("./TrackingEvent"),a=e("./MediaFile"),o=e("./VideoClicks"),s=e("./InteractiveCreativeFile"),l=e("./Icon"),u=e("../../utils/utilityFunctions"),c=e("./parsers"),d=e("../../utils/xml");n.prototype.isSupported=function(){var e,t;for(e=0,t=this.mediaFiles.length;e<t;e+=1)if(this.mediaFiles[e].isSupported())return!0;return!1},t.exports=n},{"../../utils/utilityFunctions":45,"../../utils/xml":46,"./Icon":11,"./InteractiveCreativeFile":13,"./MediaFile":15,"./TrackingEvent":16,"./VideoClicks":24,"./parsers":27}],15:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.src=i.keyValue(e);for(var t=0;t<o.length;t++){var r=o[t];this[r]=e.attr(r)}}var i=e("../../utils/xml"),a=e("./vastUtil"),o=["delivery","type","width","height","codec","id","bitrate","minBitrate","maxBitrate","scalable","maintainAspectRatio","apiFramework"];n.prototype.isSupported=function(){return a.isVPAID(this)?!!a.findSupportedVPAIDTech(this.type):"video/x-flv"!==this.type},t.exports=n},{"../../utils/xml":46,"./vastUtil":28}],16:[function(e,t,r){"use strict";var n=e("./parsers"),i=e("../../utils/xml");t.exports=function e(t,r){return this instanceof e?(this.name=t.attr("event"),this.uri=i.keyValue(t),void("progress"===this.name&&(this.offset=n.offset(t.attr("offset"),r)))):new e(t,r)}},{"../../utils/xml":46,"./parsers":27}],17:[function(e,t,r){"use strict";t.exports=function e(t){return this instanceof e?(this.idRegistry=t.attr("idRegistry"),void(this.idValue=t.attr("idValue"))):new e(t)}},{}],18:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);var t={WRAPPER_LIMIT:e&&e.wrapperLimit&&e.wrapperLimit>0?e.wrapperLimit:5};e=e||{},this.settings=c.extend({},e,t),this.errorURLMacros=[]}var i=e("./Ad"),a=e("./VASTError"),o=e("./VASTResponse"),s=e("./vastUtil"),l=e("../../utils/async"),u=e("../../utils/http").http,c=e("../../utils/utilityFunctions"),d=e("../../utils/xml"),p=e("../../utils/consoleLogger");n.prototype.getVASTResponse=function(e,t){var r=this,n=function(e,t){return e?c.isFunction(t)?void 0:new a("on VASTClient.getVASTResponse, missing callback function"):new a("on VASTClient.getVASTResponse, missing ad tag URL")}(e,t);if(n){if(c.isFunction(t))return t(n);throw n}l.waterfall([this._getVASTAd.bind(this,e),function(e,t){try{t(null,r._buildVASTResponse(e))}catch(e){t(e)}}],t)},n.prototype._getVASTAd=function(e,t){function r(e,t){var r;try{r=d.toJXONTree(e),p.debug("built JXONTree from VAST response:",r),c.isArray(r.ad)?r.ads=r.ad:r.ad?r.ads=[r.ad]:r.ads=[],t(n(r),r)}catch(e){t(new a("on VASTClient.getVASTAd.buildVastWaterfall, error parsing xml",100),null)}}function n(e){var t=d.attr(e,"version");return e.ad?t&&3!=t&&2!=t&&4!=t?new a('on VASTClient.getVASTAd.validateVASTTree, not supported VAST version "'+t+'"',102):(window.mol_vastVersion=t,null):new a("on VASTClient.getVASTAd.validateVASTTree, no Ad in VAST tree",303)}function o(e,t,r){return t.length>=u.settings.WRAPPER_LIMIT?r(new a("on VASTClient.getVASTAd.getAd, players wrapper limit reached (the limit is "+u.settings.WRAPPER_LIMIT+")",302),t):void l.waterfall([function(t){c.isString(e)?function(e,t){u._requestVASTXml(e,(function(e,r){if(e)return t(e);try{var i=d.toJXONTree(r);t(n(i),i.ad)}catch(e){t(new a("on VASTClient.getVASTAd.requestVASTAd, error parsing xml",100))}}))}(e,t):t(null,e)},s],(function(e,n){return n&&t.push(n),e?r(e,t):n.wrapper?o(n.wrapper.VASTAdTagURI,t,r):r(null,t)}))}function s(e,t){try{var r=new i(e);t(function(e){var t=e.wrapper,r=e.inLine,n="on VASTClient.getVASTAd.validateAd, ";return r&&t?new a(n+"InLine and Wrapper both found on the same Ad",101):r||t?r&&!r.isSupported()?new a(n+"could not find MediaFile that is supported by this video player",403):t&&!t.VASTAdTagURI?new a(n+"missing 'VASTAdTagURI' in wrapper",101):null:new a(n+"nor wrapper nor inline elements found on the Ad",101)}(r),r)}catch(e){t(new a("on VASTClient.getVASTAd.buildAd, error parsing xml",100),null)}}var u=this;!function(e,t){var n=u._requestVASTXml.bind(u,e);l.waterfall([n,r],t)}(e,(function(e,r){var n=r&&c.isArray(r.ads)?r.ads:null;return e?(u._trackError(e,n),t(e,n)):void o(n.shift(),[],(function e(r,i){r?(u._trackError(r,i),n.length>0?o(n.shift(),[],e):t(r,i)):t(null,i)}))}))},n.prototype._requestVASTXml=function(e,t){function r(e,r,n){if(e){var i=c.isDefined(n)?"on VASTClient.requestVastXML, HTTP request error with status '"+n+"'":"on VASTClient.requestVastXML, Error getting the the VAST XML with he passed adTagXML fn";return t(new a(i,301),null)}t(null,r)}try{c.isFunction(e)?e(r):(p.info("requesting adTagUrl: "+e),u.get(e,r,{withCredentials:!0}))}catch(e){t(e)}},n.prototype._buildVASTResponse=function(e){var t=new o;return function(e,t){t.forEach((function(t){e.addAd(t)}))}(t,e),function(e){var t=e.trackingEvents.progress;if(!e.hasLinear())throw new a("on VASTClient._buildVASTResponse, Received an Ad type that is not supported",200);if(void 0===e.duration)throw new a("on VASTClient._buildVASTResponse, Missing duration field in VAST response",101);t&&t.forEach((function(e){if(!c.isNumber(e.offset))throw new a("on VASTClient._buildVASTResponse, missing or wrong offset attribute on progress tracking event",101)}))}(t),t},n.prototype._trackError=function(e,t){if(c.isArray(t)&&0!==t.length){var r=[];t.forEach((function(e){e.wrapper&&e.wrapper.errors&&Array.isArray(e.wrapper.errors)&&(r=r.concat(e.wrapper.errors)),e.inLine&&e.inLine.errors&&Array.isArray(e.inLine.errors)&&(r=r.concat(e.inLine.errors))})),s.track(r,{ERRORCODE:e.code||900})}},t.exports=n},{"../../utils/async":38,"../../utils/consoleLogger":39,"../../utils/http":41,"../../utils/utilityFunctions":45,"../../utils/xml":46,"./Ad":7,"./VASTError":19,"./VASTResponse":21,"./vastUtil":28}],19:[function(e,t,r){"use strict";function n(e,t){this.message="VAST Error: "+(e||""),t&&(this.code=t)}n.prototype=new Error,n.prototype.name="VAST Error",t.exports=n},{}],20:[function(e,t,r){"use strict";function n(e){return this instanceof n?(this.player=e,void(this.enableFullscreenClickIFrame=!1)):new n(e)}var i=e("./VASTResponse"),a=e("./VASTError"),o=e("./VASTTracker"),s=e("./vastUtil"),l=e("../../utils/async"),u=e("../../utils/dom"),c=e("../../utils/playerUtils"),d=e("../../utils/utilityFunctions"),p=e("../../utils/consoleLogger");n.prototype.playAd=function(e,t){var r=this;return t=t||d.noop,e instanceof i?(l.waterfall([function(t){t(null,e)},this._selectAdSource.bind(this),this._createVASTTracker.bind(this),this._addClickThrough.bind(this),this._addClickThroughDivBlocker.bind(this),this._addSkipButton.bind(this),this._setupEvents.bind(this),this._playSelectedAd.bind(this)],(function(e,n){e&&n&&(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdError",adVolume:r.player.volume()}),r._trackError(e,n)),t(e,n)})),this._adUnit={_src:null,type:"VAST",pauseAd:function(){r.player.pause(!0)},resumeAd:function(){r.player.play(!0)},isPaused:function(){return r.player.paused(!0)},getSrc:function(){return this._src}},this._adUnit):t(new a("On VASTIntegrator, missing required VASTResponse"))},n.prototype._selectAdSource=function(e,t){var r,n=u.getDimension(this.player.el()).width;return e.mediaFiles.sort((function(e,t){return Math.abs(n-e.width)-Math.abs(n-t.width)})),(r=this.player.selectSource(e.mediaFiles).source)&&this.player.trigger({type:"trace.message",data:{message:"Playing "+r.src+" (type = "+r.type+")"}}),r?(p.info("selected source: ",r),this._adUnit&&(this._adUnit._src=r),t(null,r,e)):void t(new a("Could not find Ad mediafile supported by this player",403),e)},n.prototype._createVASTTracker=function(e,t,r){try{r(null,e,new o(e.src,t),t)}catch(e){r(e,t)}},n.prototype._setupEvents=function(e,t,r,n){function i(){d.isFullscreen()?t.trackFullscreen():t.trackExitFullscreen()}function a(){if(window._molSettings.breakDuration){if(window._molSettings.realVideoDuration&&Math.abs(window._molSettings.realVideoDuration-d.currentTime())<2)return}else if(Math.abs(d.duration()-d.currentTime())<2)return;window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPaused",adVolume:d.volume()}),t.trackPause(),c.showBigPlayButton(d,!0),c.once(d,["play","vast.adEnd","vast.adsCancel"],(function(e){"play"===e.type&&(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPlaying",adVolume:d.volume()}),t.trackResume(),c.showBigPlayButton(d,!1))}))}function o(){var e=1e3*d.currentTime();t.trackProgress(e)}function s(){window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdImpression",adVolume:d.volume()}),t.trackImpressions(),t.trackCreativeView()}function l(){window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVolumeChange",adVolume:d.volume()});var e=d.muted();e?t.trackMute():u&&t.trackUnmute(),u=e}var u,d=this.player;return d.on("fullscreenchange",i),d.on("vast.adStart",s),d.on("pause",a),d.on("timeupdate",o),d.on("volumechange",l),c.once(d,["vast.adEnd","vast.adsCancel"],(function(){d.off("fullscreenchange",i),d.off("vast.adStart",s),d.off("pause",a),d.off("timeupdate",o),d.off("volumechange",l)})),c.once(d,["vast.adEnd","vast.adsCancel","vast.adSkip"],(function(e){if("vast.adEnd"===e.type&&t.trackComplete(),window.MoatApiReference){var r="vast.adEnd"===e.type?"AdVideoComplete":"AdStopped";window.MoatApiReference.dispatchEvent({type:r,adVolume:d.volume()})}})),d.one("adStop",(function(){d.trigger("vast.adsCancel")})),n(null,e,r)},n.prototype._addSkipButton=function(e,t,r,n){function i(e){var r=window.document.createElement("div");return u.addClass(r,"vast-skip-button"),r.id="adSkipButton",r.onclick=function(n){return u.hasClass(r,"enabled")&&(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdSkipped",adVolume:e.volume()}),t.trackSkip(),e.trigger("vast.adSkip")),c.showBigPlayButton(e,!1),void 0!==window.Event.prototype.stopPropagation&&void n.stopPropagation()},r}function a(e,t,r){var n=Math.ceil(t-r.currentTime());n>0?e.innerHTML='<p class="vast-skip-button-text">'+window._molSettings.skipText.replace("%%TIME%%",d.toFixedDigits(n,2))+"</p>":u.hasClass(e,"enabled")||(u.addClass(e,"enabled"),e.innerHTML=window._molSettings.skipButtonText),window.document.getElementById("iframeBackButton")||(e.style.display="block")}var o,s=this;d.isNumber(r.skipoffset)&&(o=r.skipoffset/1e3,function(e,t){var r=i(e),n=a.bind(s,r,t,e);e.el().appendChild(r),e.on("timeupdate",n),c.once(e,["vast.adEnd","vast.adsCancel"],(function(){e.off("timeupdate",n),u.remove(r)}))}(this.player,o)),n(null,e,t,r)},n.prototype._addClickThrough=function(e,t,r,n){function i(t,r){var n={ASSETURI:e.src,CONTENTPLAYHEAD:s.formatProgress(1e3*r.currentTime())};return t?s.parseURLMacro(t,n):"#"}function a(){p.style.display=l.isFullscreen()?"none":"block"}var o=this.enableFullscreenClickIFrame,l=this.player,p=function(e,t,r){if(window._molSettings.disableClickThru){var n=window.document.createElement("div");return u.addClass(n,"vast-blocker"),n}var a=window.document.createElement("a"),s=r.clickThrough;u.addClass(a,"vast-blocker"),a.href=i(s,e),d.isString(s)&&(a.target="_blank");var l=function(r){return e.paused()?(e.play(),void 0!==window.Event.prototype.stopPropagation&&r.stopPropagation(),!1):(e.pause(),t.trackClick(),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdClickThru",adVolume:e.volume()}),void(d.isIDevice()&&(window.open(i(s,e),"_blank"),void 0!==window.Event.prototype.stopPropagation&&r.stopPropagation())))};return d.isIDevice()?a.ontouchend=l:a.onclick=l,e.isFullscreen()&&o&&(a.style.display="none"),a}(l,t,r),f=function(e,t,r){e.href=i(t.clickThrough,r)}.bind(this,p,r,l);return l.el().insertBefore(p,l.controlBar.el()),l.on("timeupdate",f),c.once(l,["vast.adEnd","vast.adsCancel"],(function(){l.off("timeupdate",f),l.off("fullscreenchange",a),u.remove(p)})),o&&l.on("fullscreenchange",a),n(null,e,t,r)},n.prototype._addClickThroughDivBlocker=function(e,t,r,n){function i(t,r){var n={ASSETURI:e.src,CONTENTPLAYHEAD:s.formatProgress(1e3*r.currentTime())};return t?s.parseURLMacro(t,n):"#"}function a(){if(f.style.display=p.isFullscreen()?"block":"none",!p.isFullscreen()&&l){f.removeChild(l),l=null,f.removeChild(d),d=null,c.showBigPlayButton(p,!0);var e=window.document.getElementById("adSkipButton");e&&(e.style.display="none"),p.controls(!0)}}if(!this.enableFullscreenClickIFrame)return n(null,e,t,r);var o,l,d,p=this.player,f=function(e,t){var r=window.document.createElement("div");return u.addClass(r,"vast-blocker"),window._molSettings.disableClickThru||(r.onclick=function(n){if(e.paused())return e.play(),void 0!==window.Event.prototype.stopPropagation&&n.stopPropagation(),!1;e.pause(),t.trackClick(),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdClickThru",adVolume:e.volume()}),l=window.document.createElement("iframe"),u.addClass(l,"vast-blocker"),l.src=o,r.appendChild(l),d=window.document.createElement("div"),u.addClass(d,"vast-back-button"),u.addClass(d,"enabled"),d.innerHTML="Back",d.id="iframeBackButton",r.appendChild(d),d.addEventListener("click",(function(){r.removeChild(l),l=null,r.removeChild(d),d=null;var t=window.document.getElementById("adSkipButton");t&&(t.style.display="block"),e.controls(!0),void 0!==window.Event.prototype.stopPropagation&&n.stopPropagation()})),setTimeout((function(){c.showBigPlayButton(e,!1)}),1);var i=window.document.getElementById("adSkipButton");i&&(i.style.display="none"),e.controls(!1)}),e.isFullscreen()||(r.style.display="none"),r}(p,t),h=function(e,t,r){o=i(t.clickThrough,r)}.bind(this,f,r,p);return p.el().insertBefore(f,p.controlBar.el()),p.on("timeupdate",h),c.once(p,["vast.adEnd","vast.adsCancel"],(function(){p.off("timeupdate",h),p.off("fullscreenchange",a),u.remove(f)})),p.on("fullscreenchange",a),n(null,e,t,r)},n.prototype._playSelectedAd=function(e,t,r){var n=this.player;n.preload("auto"),n.src(e),p.debug("<VASTIntegrator._playSelectedAd> waiting for durationchange to play the ad..."),c.once(n,["durationchange","error","vast.adsCancel"],(function(e){"durationchange"===e.type?(p.debug("<VASTIntegrator._playSelectedAd> got durationchange; calling playAd()"),c.once(n,["playing","vast.adsCancel"],(function(e){function i(e){if("ended"===e.type)if(window._molSettings.breakDuration){if(window._molSettings.realVideoDuration&&window._molSettings.realVideoDuration-n.currentTime()>3)return}else if(n.duration()-n.currentTime()>3)return;n.off("ended",i),n.off("vast.adsCancel",i),n.off("vast.adSkip",i),"ended"!==e.type&&"vast.adSkip"!==e.type||r(null,t)}if("vast.adsCancel"!==e.type){if(p.debug("<VASTIntegrator._playSelectedAd/playAd> got playing event; triggering vast.adStart..."),n.trigger("vast.adStart"),d.isMobile())for(var a=0;a<5;a++)setTimeout((function(){n.userActive(!0)}),2e3*a);window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoStart",adVolume:n.volume()}),n.on("ended",i),n.on("vast.adsCancel",i),n.on("vast.adSkip",i)}})),p.debug("<VASTIntegrator._playSelectedAd/playAd> calling player.play()..."),n.play()):"error"===e.type&&r(new a("on VASTIntegrator, Player is unable to play the Ad",400),t)}))},n.prototype._trackError=function(e,t){s.track(t.errorURLMacros,{ERRORCODE:e.code||900})},t.exports=n},{"../../utils/async":38,"../../utils/consoleLogger":39,"../../utils/dom":40,"../../utils/playerUtils":43,"../../utils/utilityFunctions":45,"./VASTError":19,"./VASTResponse":21,"./VASTTracker":22,"./vastUtil":28}],21:[function(e,t,r){"use strict";function n(){return this instanceof n?(this._linearAdded=!1,this.vastVersion=void 0,this.ads=[],this.errorURLMacros=[],this.impressions=[],this.clickTrackings=[],this.customClicks=[],this.trackingEvents={},this.mediaFiles=[],this.clickThrough=void 0,this.adTitle="",this.duration=void 0,this.skipoffset=void 0,void(this.icons=[])):new n}function i(e,t){t.forEach((function(t){t&&e.push(t)}))}var a=e("./Ad"),o=e("./VideoClicks"),s=e("./Linear"),l=e("./InLine"),u=e("./Wrapper"),c=e("../../utils/utilityFunctions");window.InLine__A=l,n.prototype.addAd=function(e){var t,r;e instanceof a&&(t=e.inLine,r=e.wrapper,this.ads.push(e),t&&this._addInLine(t),r&&this._addWrapper(r))},n.prototype._addErrorTrackUrls=function(e){c.isArray(e)&&i(this.errorURLMacros,e)},n.prototype._addImpressions=function(e){c.isArray(e)&&i(this.impressions,e)},n.prototype._addClickThrough=function(e){c.isNotEmptyString(e)&&(this.clickThrough=e)},n.prototype._addClickTrackings=function(e){c.isArray(e)&&i(this.clickTrackings,e)},n.prototype._addCustomClicks=function(e){c.isArray(e)&&i(this.customClicks,e)},n.prototype._addTrackingEvents=function(e){var t=this.trackingEvents;e&&(e=c.isArray(e)?e:[e]).forEach((function(e){t[e.name]||(t[e.name]=[]),t[e.name].push(e)}))},n.prototype._addTitle=function(e){c.isNotEmptyString(e)&&(this.adTitle=e)},n.prototype._addDuration=function(e){c.isNumber(e)&&(this.duration=e)},n.prototype._addVideoClicks=function(e){e instanceof o&&(this._addClickThrough(e.clickThrough),this._addClickTrackings(e.clickTrackings),this._addCustomClicks(e.customClicks))},n.prototype._addMediaFiles=function(e){c.isArray(e)&&i(this.mediaFiles,e)},n.prototype._addSkipoffset=function(e){window._molSettings&&window._molSettings.skippable?window._molSettings.skippable.enabled&&(!this.duration||!window._molSettings.skippable.videoThreshold||this.duration>=window._molSettings.skippable.videoThreshold)&&(this.skipoffset=window._molSettings.skippable.videoOffset):e&&(this.skipoffset=e)},n.prototype._addAdParameters=function(e){e&&(this.adParameters=e)},n.prototype._addIcons=function(e){c.isArray(e)&&i(this.icons,e)},n.prototype._addLinear=function(e){e instanceof s&&(this._addDuration(e.duration),this._addTrackingEvents(e.trackingEvents),this._addVideoClicks(e.videoClicks),this._addMediaFiles(e.mediaFiles),this._addSkipoffset(e.skipoffset),this._addAdParameters(e.adParameters),this._addIcons(e.icons),this._linearAdded=!0)},n.prototype._addInLine=function(e){var t=this;e instanceof l&&(this._addTitle(e.adTitle),this._addErrorTrackUrls(e.errors),this._addImpressions(e.impressions),e.creatives.forEach((function(e){e.linear&&t._addLinear(e.linear)})))},n.prototype._addWrapper=function(e){var t=this;e instanceof u&&(this._addErrorTrackUrls(e.errors),this._addImpressions(e.impressions),e.creatives.forEach((function(e){var r=e.linear;r&&(t._addVideoClicks(r.videoClicks),t.clickThrough=void 0,t._addTrackingEvents(r.trackingEvents),t._addIcons(r.icons))})))},n.prototype.hasLinear=function(){return this._linearAdded},t.exports=n},{"../../utils/utilityFunctions":45,"./Ad":7,"./InLine":12,"./Linear":14,"./VideoClicks":24,"./Wrapper":26}],22:[function(e,t,r){"use strict";function n(e,t){return this instanceof n?(this.sanityCheck(e,t),void this.initialize(e,t)):new n(e,t)}var i=e("./VASTError"),a=e("./VASTResponse"),o=e("./vastUtil"),s=e("../../utils/utilityFunctions");n.prototype.initialize=function(e,t){this.response=t,this.assetURI=e,this.progress=0,this.quartiles={firstQuartile:{tracked:!1,time:Math.round(25*t.duration)/100},midpoint:{tracked:!1,time:Math.round(50*t.duration)/100},thirdQuartile:{tracked:!1,time:Math.round(75*t.duration)/100}}},n.prototype.sanityCheck=function(e,t){if(!s.isString(e)||s.isEmptyString(e))throw new i("on VASTTracker constructor, missing required the URI of the ad asset being played");if(!(t instanceof a))throw new i("on VASTTracker constructor, missing required VAST response")},n.prototype.trackURLs=function(e,t){s.isArray(e)&&e.length>0&&(t=s.extend({ASSETURI:this.assetURI,CONTENTPLAYHEAD:o.formatProgress(this.progress)},t||{}),o.track(e,t))},n.prototype.trackEvent=function(e,t){this.response.trackingEvents[e]&&window._molSettings.viewabilityTracking&&window._molSettings.viewabilityTracking.invokeEvent(e),this.trackURLs(function(e){var t;return e&&(t=[],e.forEach((function(e){e.uri&&t.push(e.uri)}))),t}(this.response.trackingEvents[e])),t&&(this.response.trackingEvents[e]=void 0)},n.prototype.trackProgress=function(e){function t(e,t,r){a[e]&&r&&n.push({name:e,trackOnce:!!t})}var r=this,n=[],i=!0,a=this.response.trackingEvents;s.isNumber(e)&&(t("start",i,e>0),t("rewind",!1,function(t,r){return t>e&&Math.abs(r-t)>3e3}(this.progress,e)),function(e){function n(e,r){var n=a[e];(function(e,t){var r=e.time;return t>=r&&t<=r+5e3})(n,r)&&(n.tracked=!0,t(e,i,!0))}var a=r.quartiles,o=r.quartiles.firstQuartile,s=r.quartiles.midpoint,l=r.quartiles.thirdQuartile;o.tracked?s.tracked?l.tracked||n("thirdQuartile",e):n("midpoint",e):n("firstQuartile",e)}(e),function(e){if(s.isArray(a.progress)){var t=[];a.progress.forEach((function(n){n.offset<=e?r.trackURLs([n.uri]):t.push(n)})),a.progress=t}}(e),n.forEach((function(e){r.trackEvent(e.name,e.trackOnce)})),this.progress=e)},["rewind","fullscreen","exitFullscreen","pause","resume","mute","unmute","acceptInvitation","acceptInvitationLinear","collapse","expand"].forEach((function(e){n.prototype["track"+s.capitalize(e)]=function(){this.trackEvent(e)}})),["start","skip","close","closeLinear"].forEach((function(e){n.prototype["track"+s.capitalize(e)]=function(){this.trackEvent(e,!0)}})),["firstQuartile","midpoint","thirdQuartile"].forEach((function(e){n.prototype["track"+s.capitalize(e)]=function(){this.quartiles[e].tracked=!0,this.trackEvent(e,!0)}})),n.prototype.trackComplete=function(){this.quartiles.thirdQuartile.tracked&&this.trackEvent("complete",!0)},n.prototype.trackErrorWithCode=function(e){s.isNumber(e)&&this.trackURLs(this.response.errorURLMacros,{ERRORCODE:e})},n.prototype.trackImpressions=function(){this.trackURLs(this.response.impressions)},n.prototype.trackCreativeView=function(){this.trackEvent("creativeView")},n.prototype.trackClick=function(){window._molSettings.viewabilityTracking&&window._molSettings.viewabilityTracking.invokeEvent("ad-click"),this.trackURLs(this.response.clickTrackings)},t.exports=n},{"../../utils/utilityFunctions":45,"./VASTError":19,"./VASTResponse":21,"./vastUtil":28}],23:[function(e,t,r){"use strict";function n(e){function t(e){var t=[];return e&&(o.isArray(e)?e:[e]).forEach((function(e){t.push({apiFramework:e.attr("apiFramework"),uri:i.keyValue(e)})})),t}return this instanceof n?(this.vendor=e.attr("vendor"),e.javaScriptResource&&(this.javaScriptResources=t(e.javaScriptResource)),a.isFlashSupported()&&e.flashResource&&(this.javaScriptResources=t(e.javaScriptResource)),void(e.viewableImpression&&(this.viewableImpression={id:e.viewableImpression.attr("id"),uri:i.keyValue(e.viewableImpression)}))):new n(e)}var i=e("../../utils/xml"),a=e("./vastUtil"),o=e("../../utils/utilityFunctions");n.parseAdVerifications=function(e){var t=[];return o.isDefined(e)&&o.isDefined(e.verification)&&(o.isArray(e.verification)?e.verification:[e.verification]).forEach((function(e){t.push(new n(e))})),t},t.exports=n},{"../../utils/utilityFunctions":45,"../../utils/xml":46,"./vastUtil":28}],24:[function(e,t,r){"use strict";var n=e("../../utils/utilityFunctions"),i=e("../../utils/xml");t.exports=function e(t){function r(e){var t=[];return e&&(e=n.isArray(e)?e:[e]).forEach((function(e){t.push(i.keyValue(e))})),t}return this instanceof e?(this.clickThrough=i.keyValue(t.clickThrough),this.clickTrackings=r(t.clickTracking),void(this.customClicks=r(t.customClick))):new e(t)}},{"../../utils/utilityFunctions":45,"../../utils/xml":46}],25:[function(e,t,r){"use strict";var n=e("../../utils/xml"),i=e("../../utils/utilityFunctions");t.exports=function e(t){function r(e){var t=[];return e&&(i.isArray(e)?e:[e]).forEach((function(e){t.push(n.keyValue(e))})),t}return this instanceof e?(this.id=t.attr("id"),t.viewable&&(this.viewables=r(t.viewable)),t.notViewable&&(this.notViewables=r(t.notViewable)),void(t.viewUndetermined&&(this.viewUndetermineds=r(t.viewUndetermined)))):new e(t)}},{"../../utils/utilityFunctions":45,"../../utils/xml":46}],26:[function(e,t,r){"use strict";var n=e("./vastUtil"),i=e("./Creative"),a=e("./ViewableImpression"),o=e("./Verification"),s=e("../../utils/utilityFunctions"),l=e("../../utils/xml");t.exports=function e(t){return this instanceof e?(this.adSystem=l.keyValue(t.adSystem),this.impressions=n.parseImpressions(t.impression),this.VASTAdTagURI=l.keyValue(t.vASTAdTagURI),this.creatives=i.parseCreatives(t.creatives),this.errors=n.parseErrors(t.error),this.extensions=t.extensions,this.followAdditionalWrappers=!s.isDefined(l.attr(t,"followAdditionalWrappers"))||l.attr(t,"followAdditionalWrappers"),this.allowMultipleAds=l.attr(t,"allowMultipleAds"),this.fallbackOnNoAd=l.attr(t,"fallbackOnNoAd"),void(4===window.mol_vastVersion&&(t.viewableImpression&&(this.viewableImpression=new a(t.viewableImpression)),t.adVerifications&&(this.adVerifications=o.parseAdVerifications(t.adVerifications))))):new e(t)}},{"../../utils/utilityFunctions":45,"../../utils/xml":46,"./Creative":10,"./Verification":23,"./ViewableImpression":25,"./vastUtil":28}],27:[function(e,t,r){"use strict";var n=e("../../utils/utilityFunctions"),i=/(\d\d):(\d\d):(\d\d)(\.(\d\d\d))?/,a={duration:function(e){var t,r;return n.isString(e)&&((t=e.match(i))&&(r=function(e){return 60*parseInt(e,10)*60*1e3}(t[1])+function(e){return 60*parseInt(e,10)*1e3}(t[2])+function(e){return 1e3*parseInt(e,10)}(t[3])+parseInt(t[5]||0))),isNaN(r)?null:r},offset:function(e,t){return function(e){return/^\d+(\.\d+)?%$/g.test(e)}(e)?function(e,t){return t?function(e,t){return e*t/100}(t,parseFloat(e.replace("%",""))):null}(e,t):a.duration(e)}};t.exports=a},{"../../utils/utilityFunctions":45}],28:[function(e,t,r){"use strict";var n=e("../../utils/utilityFunctions"),i={track:function(e,t){var r=i.parseURLMacros(e,t),n=[];return r.forEach((function(e){var t=new Image;t.src=e,n.push(t)})),n},parseURLMacros:function(e,t){var r=[];return(t=t||{}).CACHEBUSTING||(t.CACHEBUSTING=Math.round(1e10*Math.random())),e.forEach((function(e){r.push(i._parseURLMacro(e,t))})),r},parseURLMacro:function(e,t){return(t=t||{}).CACHEBUSTING||(t.CACHEBUSTING=Math.round(1e10*Math.random())),i._parseURLMacro(e,t)},_parseURLMacro:function(e,t){return t=t||{},n.forEach(t,(function(t,r){e=e.replace(new RegExp("\\["+r+"\\]","gm"),t)})),e},parseDuration:function(e){var t,r;return n.isString(e)&&((t=e.match(/(\d\d):(\d\d):(\d\d)(\.(\d\d\d))?/))&&(r=function(e){return 60*parseInt(e,10)*60*1e3}(t[1])+function(e){return 60*parseInt(e,10)*1e3}(t[2])+function(e){return 1e3*parseInt(e,10)}(t[3])+parseInt(t[5]||0))),isNaN(r)?null:r},parseImpressions:function(e){return e?(e=n.isArray(e)?e:[e],n.transformArray(e,(function(e){if(n.isNotEmptyString(e.keyValue))return e.keyValue}))):[]},parseErrors:function(e){return e?(e=n.isArray(e)?e:[e],n.transformArray(e,(function(e){if(n.isNotEmptyString(e.keyValue))return e.keyValue}))):[]},formatProgress:function(e){var t,r,i,a;return t=e/36e5,t=Math.floor(t),r=e/6e4%60,r=Math.floor(r),i=e/1e3%60,i=Math.floor(i),a=e%1e3,n.toFixedDigits(t,2)+":"+n.toFixedDigits(r,2)+":"+n.toFixedDigits(i,2)+"."+n.toFixedDigits(a,3)},parseOffset:function(e,t){return function(e){return/^\d+(\.\d+)?%$/g.test(e)}(e)?function(e,t){return t?function(e,t){return e*t/100}(t,parseFloat(e.replace("%",""))):null}(e,t):i.parseDuration(e)},VPAID_techs:[e("../vpaid/VPAIDHTML5Tech")],isVPAID:function(e){return!!e&&"VPAID"===e.apiFramework},findSupportedVPAIDTech:function(e){var t,r,n;for(t=0,r=this.VPAID_techs.length;t<r;t+=1)if((n=this.VPAID_techs[t]).supports(e))return n;return null},isFlashSupported:function(){return!1}};t.exports=i},{"../../utils/utilityFunctions":45,"../vpaid/VPAIDHTML5Tech":30}],29:[function(e,t,r){"use strict";function n(e,t){return this instanceof n?(function(e,t){if(!e||!n.checkVPAIDInterface(e))throw new i("on VPAIDAdUnitWrapper, the passed VPAID adUnit does not fully implement the VPAID interface");if(!a.isObject(t))throw new i("on VPAIDAdUnitWrapper, expected options hash  but got '"+t+"'");if(!("responseTimeout"in t)||!a.isNumber(t.responseTimeout))throw new i("on VPAIDAdUnitWrapper, expected responseTimeout in options")}(e,t),this.options=a.extend({},t),this.adStarted=!1,void(this._adUnit=e)):new n(e,t)}var i=e("../vast/VASTError"),a=e("../../utils/utilityFunctions");n.checkVPAIDInterface=function(e){for(var t=["handshakeVersion","initAd","startAd","stopAd","resizeAd","pauseAd","expandAd","collapseAd"],r=0,n=t.length;r<n;r++)if(!e||!a.isFunction(e[t[r]]))return!1;return function(e){return a.isFunction(e.subscribe)||a.isFunction(e.addEventListener)||a.isFunction(e.on)}(e)&&function(e){return a.isFunction(e.unsubscribe)||a.isFunction(e.removeEventListener)||a.isFunction(e.off)}(e)},n.prototype.adUnitAsyncCall=function(){function e(e,t,r){if(!a.isString(e)||!a.isFunction(r[e]))throw new i("on VPAIDAdUnitWrapper.adUnitAsyncCall, invalid method name");if(!a.isFunction(t))throw new i("on VPAIDAdUnitWrapper.adUnitAsyncCall, missing callback")}function t(){return function(){r&&clearTimeout(r),s.apply(this,arguments)}}var r,n=a.arrayLikeObjToArray(arguments),o=n.shift(),s=n.pop();e(o,s,this._adUnit),n.push(t()),this._adUnit[o].apply(this._adUnit,n),r=setTimeout((function(){r=null,s(new i("on VPAIDAdUnitWrapper, timeout while waiting for a response on call '"+o+"'")),s=a.noop}),this.options.responseTimeout)},n.prototype.on=function(e,t){(this._adUnit.addEventListener||this._adUnit.subscribe||this._adUnit.on).call(this._adUnit,e,t)},n.prototype.off=function(e,t){(this._adUnit.removeEventListener||this._adUnit.unsubscribe||this._adUnit.off).call(this._adUnit,e,t)},n.prototype.waitForEvent=function(e,t,r){function n(){s.options&&s.options.player&&s.options.player.trigger({type:"trace.event",data:{event:e}}),s.off(e,n);var i=a.arrayLikeObjToArray(arguments);o&&(clearTimeout(o),o=null),i.unshift(null),t.apply(r,i)}var o,s=this;(function(e,t){if(!a.isString(e))throw new i("on VPAIDAdUnitWrapper.waitForEvent, missing evt name");if(!a.isFunction(t))throw new i("on VPAIDAdUnitWrapper.waitForEvent, missing callback")})(e,t),r=r||null,this.on(e,n),o=setTimeout((function(){s.off(e,n),window._timeoutIds.indexOf(o)>=0&&(s.options&&s.options.player&&s.options.player.trigger({type:"trace.message",data:{message:"Timeout while waiting for event "+e}}),t(new i("on VPAIDAdUnitWrapper.waitForEvent, timeout while waiting for event '"+e+"'"))),o=null,t=a.noop}),this.options.responseTimeout),window._timeoutIds.push(o)},n.prototype.handshakeVersion=function(e,t){this.adUnitAsyncCall("handshakeVersion",e,t)},n.prototype.initAd=function(e,t,r,n,i,a){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling initAd on creative"),this.waitForEvent("AdLoaded",a),this._adUnit.initAd(e,t,r,n,i)},n.prototype.resizeAd=function(e,t,r,n){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling resizeAd on creative"),this.adUnitAsyncCall("resizeAd",e,t,r,n),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdSizeChange",adVolume:this.options.player.volume()})},n.prototype.startAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling startAd on creative"),this.adStarted||this.waitForEvent("AdStarted",e),this._adUnit.startAd(),this.adStarted&&e(null)},n.prototype.stopAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling stopAd on creative"),this.waitForEvent("AdStopped",e),this._adUnit.stopAd()},n.prototype.pauseAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling pauseAd on creative"),this.waitForEvent("AdPaused",e),this._adUnit.pauseAd()},n.prototype.resumeAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling resumeAd on creative"),this.waitForEvent("AdPlaying",e),this._adUnit.resumeAd()},n.prototype.expandAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling expandAd on creative"),this.waitForEvent("AdExpandedChange",e),this._adUnit.expandAd()},n.prototype.collapseAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling collapseAd on creative"),this.waitForEvent("AdExpandedChange",e),this._adUnit.collapseAd()},n.prototype.skipAd=function(e){console.log("[BC-MOL] VPAIDAdUnitWrapper->Calling skipAd on creative"),this.waitForEvent("AdSkipped",e),this._adUnit.skipAd()},["adLinear","adWidth","adHeight","adExpanded","adSkippableState","adRemainingTime","adDuration","adVolume","adCompanions","adIcons"].forEach((function(e){var t="get"+a.capitalize(e);n.prototype[t]=function(e){this.adUnitAsyncCall(t,e)}})),n.prototype.setAdVolume=function(e,t){this.adUnitAsyncCall("setAdVolume",e,t)},t.exports=n},{"../../utils/utilityFunctions":45,"../vast/VASTError":19}],30:[function(e,t,r){"use strict";function n(e){return this instanceof n?(function(e){if(!e||!s.isString(e.src))throw new a(n.INVALID_MEDIA_FILE)}(e),this.name="vpaid-html5",this.containerEl=null,this.videoEl=null,this.vpaidHTMLClient=null,void(this.mediaFile=e)):new n(e)}var i=e("../../utils/mimetypes"),a=e("../vast/VASTError"),o=e("VPAIDHTML5Client/js/VPAIDHTML5Client"),s=e("../../utils/utilityFunctions"),l=e("../../utils/dom"),u=e("../../utils/consoleLogger");n.VPAIDHTML5Client=o,n.supports=function(e){return!s.isOldIE()&&i.html5.indexOf(e)>-1},n.prototype.loadAdUnit=function(e,t,r){(function(e,t,r){if(!l.isDomElement(e))throw new a(n.INVALID_DOM_CONTAINER_EL);if(!l.isDomElement(t)||"video"!==t.tagName.toLowerCase())throw new a(n.INVALID_DOM_CONTAINER_EL);if(!s.isFunction(r))throw new a(n.MISSING_CALLBACK)})(e,t,r),this.containerEl=e,this.videoEl=t,this.vpaidHTMLClient=new n.VPAIDHTML5Client(e,t,{}),this.vpaidHTMLClient.loadAdUnit(this.mediaFile.src,r)},n.prototype.unloadAdUnit=function(){if(this.vpaidHTMLClient){try{this.vpaidHTMLClient.destroy()}catch(e){u.error("VAST ERROR: trying to unload the VPAID adunit")}this.vpaidHTMLClient=null}this.containerEl&&(l.remove(this.containerEl),this.containerEl=null)};var c="on VPAIDHTML5Tech";n.INVALID_MEDIA_FILE=c+", invalid MediaFile",n.INVALID_DOM_CONTAINER_EL=c+", invalid container HtmlElement",n.INVALID_DOM_VIDEO_EL=c+", invalid HTMLVideoElement",n.MISSING_CALLBACK=c+", missing valid callback",t.exports=n},{"../../utils/consoleLogger":39,"../../utils/dom":40,"../../utils/mimetypes":42,"../../utils/utilityFunctions":45,"../vast/VASTError":19,"VPAIDHTML5Client/js/VPAIDHTML5Client":3}],31:[function(e,t,r){"use strict";function n(e,t){return this instanceof n?(this.VIEW_MODE={NORMAL:"normal",FULLSCREEN:"fullscreen",THUMBNAIL:"thumbnail"},this.player=e,this.containerEl=function(){var t=document.createElement("div");return t.id="BC-VPAID-container",h.addClass(t,"VPAID-container"),e.el().insertBefore(t,e.controlBar.el()),t}(),this.options={responseTimeout:5e3,VPAID_VERSION:"2.0"},this.settings=t,this.contentSource=e.tech_.el_.src,this.needsShowPlayer=!1,this.errorHasBeenTracked=!1,this.adFinished=!1,void(this.timeUpdateTimer=null)):new n(e)}function i(e,t){for(var r=e.controlBar.getChild("currentTimeDisplay").el_.children,n=0;n<r.length;n++)"bc_time_display"!=r[n].id&&(r[n].style.display=t?"":"none")}function a(e,t,r){var n=document.getElementById("adSkipButton"),i=e.el().querySelector(".vjs-tech"),a=h.getDimension(i),s=e.isFullscreen()?r.FULLSCREEN:r.NORMAL;s===r.NORMAL&&(e.vast&&(e.vast.needSyncPlay=!0),a.width=e.el_.offsetWidth,a.height=e.el_.offsetHeight,v.isAndroid()&&n&&(n.style.display="block")),s===r.FULLSCREEN&&(console.log("****** to fullscreen dimension = "+a.width+","+a.height),v.isAndroid()&&n&&(n.style.display="none")),t.resizeAd(a.width,a.height,s,o)}function o(e){e&&m.error("ERROR: "+e.message,e)}var s=e("../../utils/mimetypes"),l=e("../vast/VASTError"),u=e("../vast/VASTResponse"),c=e("../vast/VASTTracker"),d=e("../vast/vastUtil"),p=e("./VPAIDAdUnitWrapper"),f=e("../../utils/async"),h=e("../../utils/dom"),g=e("../../utils/playerUtils"),v=e("../../utils/utilityFunctions"),m=e("../../utils/consoleLogger");n.prototype.playAd=function(e,t){function r(e,r,n){e&&n&&i._trackError(n,e.code),a.trigger("vpaid.adEnd"),t(e,n)}function n(){a.trigger("vpaid.adEnd")}if(!(e instanceof u))return t(new l("on VASTIntegrator.playAd, missing required VASTResponse"));var i=this,a=this.player;m.debug("<VPAIDIntegrator.playAd> looking for supported tech...");var o=this._findSupportedTech(e,this.settings);(t=t||v.noop,this._adUnit=null,h.addClass(a.el(),"vjs-vpaid-ad"),a.on("vast.adsCancel",n),a.one("vpaid.adEnd",(function(){a.off("vast.adsCancel",n),o&&(console.log("[BC-MOL] VPAIDIntegrator->Calling unloadAdUnit (implicitly invokes stopAd and unsubscribes VPAID events)"),o.unloadAdUnit()),h.removeClass(a.el(),"vjs-vpaid-ad")})),o)?(m.info("<VPAIDIntegrator.playAd> found tech: ",o),f.waterfall([function(t){t(null,o,e)},this._loadAdUnit.bind(this),this._playAdUnit.bind(this),this._finishPlaying.bind(this)],r),this._adUnit={_paused:!0,type:"VPAID",pauseAd:function(){a.trigger("vpaid.pauseAd"),a.pause(!0)},resumeAd:function(){a.trigger("vpaid.resumeAd")},isPaused:function(){return this._paused},getSrc:function(){return o.mediaFile}}):(m.debug("<VPAIDIntegrator.playAd> could not find suitable tech"),r(new l("on VPAIDIntegrator.playAd, could not find a supported mediaFile",403),this._adUnit,e));return this._adUnit},n.prototype._findSupportedTech=function(e,t){if(!(e instanceof u))return null;var r,n,i,a,o=e.mediaFiles.filter(d.isVPAID),l=t&&t.preferredTech,c=[];for(r=0,n=o.length;r<n;r+=1)if(i=o[r],a=d.findSupportedVPAIDTech(i.type)){if(!!l&&(i.type===l||s[l]&&s[l].indexOf(i.type)>-1))return new a(i,t);c.push({mediaFile:i,tech:a})}if(c.length){var p=c[0];return new p.tech(p.mediaFile,t)}return null},n.prototype._createVPAIDAdUnitWrapper=function(e,t,r,n){return new p(e,{src:t,responseTimeout:r,player:n})},n.prototype._loadAdUnit=function(e,t,r){var n=this,i=this.player,a=i.el().querySelector(".vjs-tech"),o=this.settings.adCancelTimeout||this.options.responseTimeout;e.loadAdUnit(this.containerEl,a,(function(a,s){if(a)return r(a,s,t);try{var l=document.getElementsByTagName("IFRAME");l&&l.length>0&&l[0].addEventListener("mouseover",(function(){i.userActive(!0),h.hasClass(i.el(),"vjs-has-started")||h.addClass(i.el(),"vjs-has-started")})),i.trigger({type:"trace.message",data:{message:"Playing "+e.mediaFile.src+" (type = "+e.mediaFile.type+", apiFramework = "+e.mediaFile.apiFramework+")"}});var u=n._createVPAIDAdUnitWrapper(s,e.mediaFile.src,o,i),c="vjs-"+e.name+"-ad";h.addClass(i.el(),c),i.one("vpaid.adEnd",(function(){h.removeClass(i.el(),c)})),r(null,u,t)}catch(e){r(e,s,t)}}))},n.prototype._playAdUnit=function(e,t,r){f.waterfall([function(r){r(null,e,t)},this._handshake.bind(this),this._setupEvents.bind(this),this._initAd.bind(this),this._addSkipButton.bind(this),this._linkPlayerControls.bind(this),this._startAd.bind(this)],r)},n.prototype._handshake=function(e,t,r){function n(e){var t=function(e){var t=e.split(".");return parseInt(t[0],10)}(e);return t>=1&&t<=2}e.handshakeVersion(this.options.VPAID_VERSION,(function(i,a){return i?r(i,e,t):a&&n(a)?r(null,e,t):r(new l('on VPAIDIntegrator._handshake, unsupported version "'+a+'"'),e,t)}))},n.prototype._initAd=function(e,t,r){var n=this.player.el().querySelector(".vjs-tech"),i=h.getDimension(n);e.initAd(i.width,i.height,this.VIEW_MODE.NORMAL,-1,{AdParameters:t.adParameters||""},(function(n){r(n,e,t)}))},n.prototype._createVASTTracker=function(e,t){return new c(e,t)},n.prototype._setupEvents=function(e,t,r){function n(){A.impressionTriggered||(A.impressionTriggered=!0,window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdImpression",adVolume:y.volume()}),y.trigger({type:"trace.event",data:{event:"vpaid.AdImpression"}}),y.trigger("vpaid.AdImpression"),m.trackImpressions())}function o(){var t=document.getElementById("bc_time_display");t?(i(y,!1),t.style.display="block"):(t=document.createElement("div"),y.controlBar.getChild("currentTimeDisplay").el_.appendChild(t),t.id="bc_time_display",t.class="vjs-current-time-display",t["aria-live"]="off",t.innerHTML='<span class="vjs-control-text"></span>0:00',i(y,!1)),e.getAdRemainingTime((function(e,r){if(r>=0){var n=y.duration()-r;n>=0&&(t.childNodes[1].nodeValue=function(e){var t=parseInt(e+.5),r=parseInt(t/60);return t-=60*r,r.toString()+":"+(t>9?"":"0")+t.toString()}(n))}}))}function s(){A._adUnit&&A._adUnit.isPaused()&&(A._adUnit._paused=!1),y.trigger("play")}function l(){A._adUnit&&(A._adUnit._paused=!0),y.trigger("pause")}function u(){e.pauseAd(v.noop)}function c(){e.resumeAd(v.noop)}function p(){e.stopAd&&e.stopAd(v.noop)}var f=e.options.src,m=this._createVASTTracker(f,t),y=this.player,b=this.contentSource,A=this;this.tracker=m,this.impressionTriggered=!1,e.on("AdSkipped",(function(){y.trigger({type:"trace.event",data:{event:"vpaid.AdSkipped"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdSkipped",adVolume:y.volume()}),y.trigger("vpaid.AdSkipped"),m.trackSkip(),g.showBigPlayButton(y,!1),e.stopAd(v.noop),setTimeout((function(){y.trigger("vast.adsCancel")}),1)})),e.on("AdImpression",(function(){n()})),e.on("AdStarted",(function(){if(!e.adStarted&&(window._molSettings.viewabilityTracking&&window._molSettings.viewabilityTracking.init(window._molSettings.viewability.contextId,y.duration(),y.el_.offsetWidth,y.el_.offsetHeight),e.adStarted=!0,h.hasClass(y.el(),"vjs-has-started")||h.addClass(y.el(),"vjs-has-started"),y.trigger("vpaid.AdStarted"),m.trackCreativeView(),!window._molSettings.playsInBreak&&e.getAdDuration&&e.getAdDuration((function(e,t){t>0&&y.duration(t)})),n(),s(),y.one("adStop",(function(){e.stopAd&&e.stopAd(v.noop)})),v.isIDevice())){var t=document.getElementsByClassName("vjs-resize-manager");if(t&&t.length>0){var r=t[0].parentElement;r&&r.removeChild(t[0])}}})),e.on("AdVideoStart",(function(){if(y.trigger({type:"trace.event",data:{event:"AdVideoStart"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoStart",adVolume:y.volume()}),y.trigger("vpaid.AdVideoStart"),m.trackStart(),!window._molSettings.playsInBreak&&e.getAdDuration&&e.getAdDuration((function(e,t){t>0&&y.duration(t)})),s(),g.showBigPlayButton(y,!1),v.isMobile())for(var t=0;t<4;t++)setTimeout((function(){document.getElementsByTagName("IFRAME")[0].dispatchEvent(new Event("mouseover"))}),1e3*t);b===y.tech_.el_.src&&(y.trigger({type:"trace.message",data:{message:"VPAID creative uses its own video tag"}}),A.needsShowPlayer=!0,window._molSettings.playsInBreak?y.controlBar.hide():A.timeUpdateTimer=setInterval(o,500))})),e.on("AdPlaying",(function(){A.adFinished||(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPlaying",adVolume:y.volume()}),y.trigger("vpaid.AdPlaying"),m.trackResume(),s(),g.showBigPlayButton(y,!1))})),e.on("AdPaused",(function(){if(!A.adFinished)return window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPaused",adVolume:y.volume()}),y.trigger("vpaid.AdPaused"),m.trackPause(),l(),window.document.getElementById("iframeBackButton")?void g.showBigPlayButton(y,!1):void g.showBigPlayButton(y,!0)})),e.on("AdVideoFirstQuartile",(function(){A.adFinished||(y.trigger({type:"trace.event",data:{event:"vpaid.AdVideoFirstQuartile"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoFirstQuartile",adVolume:y.volume()}),y.trigger("vpaid.AdVideoFirstQuartile"),m.trackFirstQuartile())})),e.on("AdVideoMidpoint",(function(){A.adFinished||(y.trigger({type:"trace.event",data:{event:"vpaid.AdVideoMidpoint"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoMidpoint",adVolume:y.volume()}),y.trigger("vpaid.AdVideoMidpoint"),m.trackMidpoint())})),e.on("AdVideoThirdQuartile",(function(){A.adFinished||(y.trigger({type:"trace.event",data:{event:"vpaid.AdVideoThirdQuartile"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoThirdQuartile",adVolume:y.volume()}),y.trigger("vpaid.AdVideoThirdQuartile"),m.trackThirdQuartile())})),e.on("AdVideoComplete",(function(){A.adFinished||(y.trigger({type:"trace.event",data:{event:"vpaid.AdVideoComplete"}}),y.trigger("vpaid.AdVideoComplete"),m.trackComplete(),g.showBigPlayButton(y,!1),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVideoComplete",adVolume:y.volume()}),e.stopAd&&e.stopAd(v.noop))})),e.on("AdClickThru",(function(r){if(!A.adFinished){y.trigger({type:"trace.event",data:{event:"vpaid.AdClickThru"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdClickThru",adVolume:y.volume()}),y.trigger("vpaid.AdClickThru");var n=r.url,i=r.playerHandles,a=v.isNotEmptyString(n)?n:function(t){var r={ASSETURI:e.options.src,CONTENTPLAYHEAD:0};return t?d.parseURLMacro(t,r):null}(t.clickThrough);i&&window._molSettings.disableClickThru||(m.trackClick(),i&&a&&(y.isFullscreen(),window.open(a,"_blank")),e.pauseAd(v.noop))}})),e.on("AdUserAcceptInvitation",(function(){y.trigger({type:"trace.event",data:{event:"vpaid.AdUserAcceptInvitation"}}),y.trigger("vpaid.AdUserAcceptInvitation"),m.trackAcceptInvitation(),m.trackAcceptInvitationLinear()})),e.on("AdUserClose",(function(){y.trigger({type:"trace.event",data:{event:"vpaid.AdUserClose"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdUserClose",adVolume:y.volume()}),y.trigger("vpaid.AdUserClose"),m.trackClose(),m.trackCloseLinear()})),e.on("AdUserMinimize",(function(){y.trigger({type:"trace.event",data:{event:"vpaid.AdUserMinimize"}}),y.trigger("vpaid.AdUserMinimize"),m.trackCollapse()})),e.on("AdError",(function(){A.adFinished||(A.impressionTriggered||A.errorHasBeenTracked||(y.trigger({type:"trace.event",data:{event:"vpaid.AdError"}}),window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdError",adVolume:y.volume()}),y.trigger("vpaid.AdError"),m.trackErrorWithCode(901),A.errorHasBeenTracked=!0),g.showBigPlayButton(y,!1))})),e.on("AdVolumeChange",(function(){y.trigger({type:"trace.event",data:{event:"vpaid.AdVolumeChange"}}),y.trigger("vpaid.AdVolumeChange");var t=y.volume();e.getAdVolume((function(e,r){t!==r&&(0===r&&t>0&&m.trackMute(),r>0&&0===t&&m.trackUnmute(),y.volume(r))}))})),e.on("AdSizeChange",(function(){y.vast&&y.vast.needSyncPlay&&(y.paused()!==y.tech_.el_.paused&&b!=y.tech_.el_.src&&(y.tech_.el_.paused?(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPaused",adVolume:y.volume()}),l(),g.showBigPlayButton(y,!0)):(window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdPlaying",adVolume:y.volume()}),s(),g.showBigPlayButton(y,!1))),y.vast.needSyncPlay=!1)}));var w=a.bind(this,y,e,this.VIEW_MODE),k=v.throttle(w,100),T=this.settings.autoResize;T&&(h.addEventListener(window,"resize",k),h.addEventListener(window,"orientationchange",k)),y.on("vast.resize",w),y.on("vpaid.pauseAd",u),y.on("vpaid.resumeAd",c),y.on("stopAd",p),y.one("vpaid.adEnd",(function(){y.off("vast.resize",w),y.off("vpaid.pauseAd",u),y.off("vpaid.resumeAd",c),y.off("stopAd",p),T&&(h.removeEventListener(window,"resize",k),h.removeEventListener(window,"orientationchange",k))})),r(null,e,t)},n.prototype._addSkipButton=function(e,t,r){function n(){h.remove(s),s=null}function i(){var t=window.document.createElement("div");return h.addClass(t,"vast-skip-button"),h.addClass(t,"enabled"),t.innerHTML=window._molSettings.skipButtonText,t.id="adSkipButton",t.onclick=function(t){return e.getAdSkippableState((function(t,r){r?e.skipAd(v.noop):(f.trackSkip(),e.stopAd(v.noop))})),void 0!==window.Event.prototype.stopPropagation&&void t.stopPropagation()},t}function a(t){var r=window.document.createElement("div");return h.addClass(r,"vast-skip-button"),r.style.display="none",r.id="adSkipButton",r.onclick=function(n){return h.hasClass(r,"enabled")&&e.getAdSkippableState((function(r,n){e.skipAd(v.noop),n||(f.trackSkip(),e.stopAd(v.noop),setTimeout((function(){t.trigger("vast.adsCancel")}),1))})),g.showBigPlayButton(t,!1),void 0!==window.Event.prototype.stopPropagation&&void n.stopPropagation()},r}function o(t,r){if(e.getAdDuration((function(e,t){t>0&&(u=t)})),e.getAdRemainingTime((function(e,t){c=t})),u&&c){var n=Math.ceil(r-(u-c));if(n>0?t.innerHTML='<p class="vast-skip-button-text">'+window._molSettings.skipText.replace("%%TIME%%",v.toFixedDigits(n,2))+"</p>":h.hasClass(t,"enabled")||(h.addClass(t,"enabled"),t.innerHTML=window._molSettings.skipButtonText),!window.document.getElementById("iframeBackButton")){if(p.isFullscreen()&&v.isAndroid())return void(t.style.display="none");t.style.display="block"}}}var s,l,u,c,d,p=this.player,f=this.tracker,m=this;if(!window._molSettings.disableSkippability)if(t.skipoffset&&v.isNumber(t.skipoffset))l=t.skipoffset/1e3,function(e,t){var r=a(e),n=o.bind(m,r,t);e.el().appendChild(r),d=setInterval(n,500),g.once(e,["vast.adEnd","vast.adsCancel"],(function(){d&&(clearInterval(d),d=null),h.remove(r),r=null}))}(p,l);else{var y=!1;window._molSettings&&window._molSettings.skippable&&(!1===window._molSettings.skippable.enabled&&(y=!0),t.duration&&window._molSettings.skippable.videoThreshold&&t.duration<window._molSettings.skippable.videoThreshold&&(y=!0)),y||(e.on("AdSkippableStateChange",(function(){p.trigger("vpaid.AdSkippableStateChange"),e.getAdSkippableState((function(e,t){t?s||function(e){s=i(),e.el().appendChild(s)}(p):n()}))})),g.once(p,["vast.adEnd","vast.adsCancel"],n))}r(null,e,t)},n.prototype._linkPlayerControls=function(e,t,r){var n=this;(function(e,t){function r(){var r=e.muted()?0:e.volume();t.setAdVolume(r,o)}e.on("volumechange",r),t.on("AdVolumeChange",(function(){window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdVolumeChange",adVolume:e.volume()}),e.trigger("vpaid.AdVolumeChange");var r=e.volume();t.getAdVolume((function(t,n){t?o(t):r!==n&&e.volume(n)}))})),e.one("vpaid.adEnd",(function(){e.off("volumechange",r)}))})(this.player,e),function(e,t,r){var i=a.bind(n,e,t,r);e.on("fullscreenchange",i),e.one("vpaid.adEnd",(function(){e.off("fullscreenchange",i)}))}(this.player,e,this.VIEW_MODE),r(null,e,t)},n.prototype._startAd=function(e,t,r){var n=this.player,i=e.adStarted;i&&(n.trigger("vast.adStart"),n.trigger({type:"trace.event",data:{event:"vpaid.AdStarted"}})),e.startAd((function(a){a||i||n.trigger("vast.adStart"),r(a,e,t)}))},n.prototype._finishPlaying=function(e,t,r){function n(n){if(o.adFinished=!0,g.showBigPlayButton(a,!1),s){if(o.timeUpdateTimer){clearInterval(o.timeUpdateTimer),o.timeUpdateTimer=null;var l=document.getElementById("bc_time_display");l&&a.controlBar.getChild("currentTimeDisplay").el_.removeChild(l),i(a,!0)}a.controlBar.show(),a.tech_.el_.style.display="block"}r(n,e,t)}var a=this.player,o=this;e.on("AdStopped",(function(){window.MoatApiReference&&window.MoatApiReference.dispatchEvent({type:"AdStopped",adVolume:a.volume()}),a.trigger("vpaid.AdStopped"),n(null)})),e.on("AdError",(function(e){if(o.impressionTriggered)n(null);else{var t=e?e.message:"on VPAIDIntegrator, error while waiting for the adUnit to finish playing";n(new l(t))}}));var s=this.needsShowPlayer},n.prototype._trackError=function(e,t){this.errorHasBeenTracked||(this.errorHasBeenTracked=!0,d.track(e.errorURLMacros,{ERRORCODE:t||901}))},t.exports=n},{"../../utils/async":38,"../../utils/consoleLogger":39,"../../utils/dom":40,"../../utils/mimetypes":42,"../../utils/playerUtils":43,"../../utils/utilityFunctions":45,"../vast/VASTError":19,"../vast/VASTResponse":21,"../vast/VASTTracker":22,"../vast/vastUtil":28,"./VPAIDAdUnitWrapper":29}],32:[function(e,t,r){"use strict";var n=e("../../utils/dom"),i=document.createElement("div");i.className="vjs-ads-label vjs-control vjs-label-hidden",i.innerHTML="Advertisement";t.exports=function(e){return{init:function(t,r){r.el=i,e.call(this,t,r),setTimeout((function(){var e=t.controlBar&&(t.controlBar.getChild("timerControls")||t.controlBar.getChild("currentTimeDisplay"));e&&t.controlBar.el().insertBefore(i,e.el()),n.removeClass(i,"vjs-label-hidden")}),0)},el:function(){return i}}}},{"../../utils/dom":40}],33:[function(e,t,r){"use strict";var n=videojs.getComponent("Component"),i=e("./ads-label")(n);videojs.registerComponent("AdsLabel",videojs.extend(n,i))},{"./ads-label":32}],34:[function(e,t,r){"use strict";var n=document.createElement("div");t.exports=function(e){return{init:function(t,r){r.el=n,n.className="vjs-black-poster",e.call(this,t,r);var i=t.getChild("posterImage");setTimeout((function(){i&&t&&t.el()&&t.el().insertBefore(n,i.el())}),0)},el:function(){return n}}}},{}],35:[function(e,t,r){"use strict";var n=videojs.getComponent("Component"),i=e("./black-poster")(n);videojs.registerComponent("BlackPoster",videojs.extend(n,i))},{"./black-poster":34}],36:[function(e,t,r){"use strict";var n=e("../ads/vast/VASTClient"),i=e("../ads/vast/VASTError"),a=e("../ads/vast/vastUtil"),o=e("../ads/vast/VASTIntegrator"),s=e("../ads/vpaid/VPAIDIntegrator"),l=e("../ads/icon/IconIntegrator"),u=e("../utils/async"),c=e("../utils/dom"),d=e("../utils/playerUtils"),p=e("../utils/utilityFunctions"),f=e("../utils/anVideoViewability"),h=e("../utils/consoleLogger");t.exports=function(e){function t(){w.trigger("vast.adsCancel"),T=!0}function r(e){u.waterfall([g,v],e)}function g(e){k.getVASTResponse(S.adTagUrl?S.adTagUrl():S.adTagXML,e)}function v(e,t){function r(){if(window._molSettings.playsInBreak&&w.on("timeupdate",i),!f&&!w.controlBar.getChild("AdsLabel")){w.controlBar.addChild("AdsLabel"),e.icons&&e.icons.length>0&&new l(w).renderIcons(e.icons,t);var r=document.getElementsByClassName("vjs-next-button");r&&r.length>0&&((A=r[0]).style.display="none")}}function n(e){for(var t=w.controlBar.getChild("currentTimeDisplay").el_.children,r=0;r<t.length;r++)"bc_time_display"!=t[r].id&&(t[r].style.display=e?"":"none")}function i(){if(window._molSettings.breakDuration&&w.duration()!=window._molSettings.breakDuration&&(w.duration()&&(window._molSettings.realVideoDuration=w.duration()),w.duration(window._molSettings.breakDuration)),window._molSettings.timeOffset){var e=document.getElementById("bc_time_display");e?(n(!1),e.style.display="block"):(e=document.createElement("div"),w.controlBar.getChild("currentTimeDisplay").el_.appendChild(e),e.id="bc_time_display",e.class="vjs-current-time-display",e["aria-live"]="off",e.innerHTML='<span class="vjs-control-text"></span>0:00',n(!1));var t=w.currentTime()+window._molSettings.timeOffset;e.childNodes[1].nodeValue=function(e){var t=parseInt(e+.5),r=parseInt(t/60);return t-=60*r,r.toString()+":"+(t>9?"":"0")+t.toString()}(t)}}if(!T){if(window.MoatApiReference=null,e.ads&&e.ads.length>0&&e.ads[0].inLine&&e.ads[0].inLine.moat){var a={level1:e.ads[0].inLine.moat.advid,level2:e.ads[0].inLine.moat.cpgid,level3:e.ads[0].inLine.moat.cpid,level4:e.ads[0].inLine.moat.crid};e.ads[0].inLine.moat.site_id&&(a.slicer1=e.ads[0].inLine.moat.site_id),window.MoatApiReference=function(e,t,r,n,i){var a,o,s=document.createElement("script"),l=[];t={adData:{ids:t,duration:r,url:i},dispatchEvent:function(e){this.sendEvent?(l&&(l.push(e),e=l,l=!1),this.sendEvent(e)):l.push(e)}},r="_moatApi"+Math.floor(1e8*Math.random());try{o=(a=e.ownerDocument).defaultView||a.parentWindow}catch(e){a=document,o=window}return o[r]=t,s.type="text/javascript",e&&e.insertBefore(s,e.childNodes[0]||null),s.src="https://z.moatads.com/"+n+"/moatvideo.js#"+r,t}(w.el_,a,w.duration(),"ninemediavpaid78961164",w.currentSource().src)}window._molSettings.viewabilityTracking&&window._molSettings.viewabilityTracking.init(window._molSettings.viewability.contextId,w.duration(),w.el_.offsetWidth,w.el_.offsetHeight);var u=y(e),c=u?new s(w,S):new o(w),f=!1;u&&w.trigger("clearAdCancelTimeout"),d.once(w,["vast.adStart","vast.adsCancel"],(function(e){"vast.adStart"===e.type&&r()})),d.once(w,["vast.adEnd","vast.adsCancel"],(function(){if(window._molSettings.playsInBreak&&(w.off("timeupdate",i),window._molSettings.timeOffset)){n(!0);var e=document.getElementById("bc_time_display");e&&(e.style.display="none")}w.controlBar.removeChild("AdsLabel"),A&&(A.style.display="",A=null),f=!0})),p.isIDevice()&&function(){function e(){w.duration()-n>r&&(w.pause(!0),w.play(!0),w.currentTime(n))}function t(){var e=w.currentTime();Math.abs(e-n)>r?((i+=1)>=2&&w.pause(!0),w.currentTime(n)):n=e}var r=3,n=0,i=0;w.on("timeupdate",t),w.on("ended",e),d.once(w,["vast.adEnd","vast.adsCancel","vast.adError"],(function(){w.off("timeupdate",t),w.off("ended",e)}))}(),w.vast.vastResponse=e,h.debug("calling adIntegrator.playAd() with vastResponse:",e),w.vast.adUnit=c.playAd(e,t),w.vast.VPAID=u}}function m(e,r){w.trigger({type:"vast.adError",error:e}),t(),h.error("AD ERROR:",e.message,e,r)}function y(e){var t,r,n=e.mediaFiles;for(t=0,r=n.length;t<r;t++)if(a.isVPAID(n[t]))return!0;return!1}var b,A,w=this,k=new n({wrapperLimit:e.wrapperLimit}),T=!1,S=p.extend({},{timeout:500,iosPrerollCancelTimeout:2e3,adCancelTimeout:3e3,playAdAlways:!1,adsEnabled:!0,autoResize:!0,verbosity:0,playsInBreak:!1,skipText:"Skip in %%TIME%% seconds",skipButtonText:"Skip ad",initialPlayback:"auto",initialAudio:"on",disableClickThru:!1,firstPlay:!0},e||{});return p.isUndefined(S.adTagUrl)&&p.isDefined(S.url)&&(S.adTagUrl=S.url),p.isString(S.adTagUrl)&&(S.adTagUrl=p.echoFn(S.adTagUrl)),S.viewability&&S.viewability.config&&(S.viewabilityTracking=new f(w)),window._molSettings=S,window._timeoutIds=[],window.MoatApiReference=null,p.isDefined(S.adTagXML)&&!p.isFunction(S.adTagXML)?m(new i("on VideoJS VAST plugin, the passed adTagXML option does not contain a function")):p.isDefined(S.adTagUrl)||p.isFunction(S.adTagXML)?(h.setVerbosity(S.verbosity),S.playsInBreak||((b=d.getPlayerSnapshot(w)).playing=!0),"click"===S.initialPlayback&&d.showBigPlayButton(w,!0),d.prepareForAds(w),S.playAdAlways&&w.on("vast.contentEnd",(function(){setTimeout((function(){w.trigger("vast.reset")}),0)})),w.on("vast.firstPlay",(function e(){function t(){d.once(w,["playing","vast.reset","vast.firstPlay"],(function(e){"playing"===e.type&&(w.trigger("vast.contentStart"),d.once(w,["ended","vast.reset","vast.firstPlay"],(function(e){"ended"===e.type&&w.trigger("vast.contentEnd")})))})),b&&(d.restorePlayerSnapshot(w,b),b=null)}function n(){setTimeout((function(){c.removeClass(w.el(),"vjs-vast-ad-loading"),w.loadingSpinner.el_.style.display="none"}),100)}w.off("vast.firstPlay",e),d.showBigPlayButton(w,!1),"off"===S.initialAudio&&(S.contentVolume={muted:w.muted(),volume:w.volume()},w.muted(!0)),d.removeNativePoster(w),d.once(w,["vast.adsCancel","vast.adEnd"],(function(){d.showBigPlayButton(w,!1),w.vast&&w.vast.adUnit&&(w.vast.adUnit=null,w.vast.VPAID=null),window._molSettings.firstPlay=!1,t(),setTimeout((function(){w.trigger("adFinished")}),0)})),u.waterfall([function(e){return S.adsEnabled?e(null):void e(new i("Ads are not enabled"))},function(e){!p.isIPhone()||w.currentTime()<=S.iosPrerollCancelTimeout?(w.pause(),c.addClass(w.el(),"vjs-vast-ad-loading"),d.once(w,["vast.adStart","vast.adsCancel"],n),w.paused()?e(null):d.once(w,["playing"],(function(){w.pause(),e(null)}))):e(new i("video content has been playing before preroll ad"))},function(e){function t(){r&&(clearTimeout(r),r=null)}var r;T=!1,r=setTimeout((function(){r=null,m(new i("timeout while waiting for the video to start playing",402)),d.showBigPlayButton(w,!1),w.vast.VPAID&&w.trigger("vpaid.adEnd")}),S.adCancelTimeout),d.once(w,["vast.adStart","vast.adsCancel","clearAdCancelTimeout"],t),d.once(w,["vast.adError","vpaid.adEnd","vpaid.adError"],(function(){t()})),e(null)},r],(function(e,t){e?m(e,t):w.trigger("vast.adEnd")}))})),w.on("vast.reset",(function(){b=null,t()})),w.vast={isEnabled:function(){return S.adsEnabled},enable:function(){S.adsEnabled=!0},disable:function(){S.adsEnabled=!1}},w.vast):m(new i("on VideoJS VAST plugin, missing adTagUrl on options object"))}},{"../ads/icon/IconIntegrator":6,"../ads/vast/VASTClient":18,"../ads/vast/VASTError":19,"../ads/vast/VASTIntegrator":20,"../ads/vast/vastUtil":28,"../ads/vpaid/VPAIDIntegrator":31,"../utils/anVideoViewability":37,"../utils/async":38,"../utils/consoleLogger":39,"../utils/dom":40,"../utils/playerUtils":43,"../utils/utilityFunctions":45}],37:[function(e,t,r){var n=null;e("./consoleLogger");t.exports=function(e){this.init=function(e,t,r,i){n},this.invokeEvent=function(e){n},this.isReady=!1}},{"./consoleLogger":39}],38:[function(e,t,r){var n=e("./utilityFunctions"),i={setImmediate:function(e){setTimeout(e,0)},iterator:function(e){var t=function(r){var n=function(){return e.length&&e[r].apply(null,arguments),n.next()};return n.next=function(){return r<e.length-1?t(r+1):null},n};return t(0)},waterfall:function(e,t){if(t=t||function(){},!n.isArray(e)){var r=new Error("First argument to waterfall must be an array of functions");return t(r)}if(!e.length)return t();var a=function(e){return function(r){if(r)t.apply(null,arguments),t=function(){};else{var n=Array.prototype.slice.call(arguments,1),o=e.next();o?n.push(a(o)):n.push(t),i.setImmediate((function(){e.apply(null,n)}))}}};a(i.iterator(e))()},when:function(e,t){if(!n.isFunction(t))throw new Error("async.when error: missing callback argument");var r=n.isFunction(e)?e:function(){return!!e};return function(){var e=n.arrayLikeObjToArray(arguments),i=e.pop();return r.apply(null,e)?t.apply(this,arguments):(e.unshift(null),i.apply(null,e))}}};t.exports=i},{"./utilityFunctions":45}],39:[function(e,t,r){"use strict";function n(e,t){t.length>0&&"string"==typeof t[0]&&(t[0]=a+t[0]),e.apply?e.apply(console,Array.prototype.slice.call(t)):e(Array.prototype.slice.call(t))}var i=0,a="[videojs-vast-vpaid] ",o={setVerbosity:function(e){i=e},debug:function(){i<4||(void 0===console.debug?n(console.log,arguments):n(console.debug,arguments))},log:function(){i<3||n(console.log,arguments)},info:function(){i<2||n(console.info,arguments)},warn:function(){i<1||n(console.warn,arguments)},error:function(){n(console.error,arguments)}};"undefined"!=typeof console&&console.log||(o.debug=function(){},o.log=function(){},o.info=function(){},o.warn=function(){},o.error=function(){}),t.exports=o},{}],40:[function(e,t,r){"use strict";var n=e("./utilityFunctions"),i={isVisible:function(e){return"hidden"!==window.getComputedStyle(e).visibility},isHidden:function(e){return"none"===window.getComputedStyle(e).display},isShown:function(e){return!i.isHidden(e)},hide:function(e){e.__prev_style_display_=e.style.display,e.style.display="none"},show:function(e){i.isHidden(e)&&(e.style.display=e.__prev_style_display_),e.__prev_style_display_=void 0},hasClass:function(e,t){var r,i,a;if(n.isNotEmptyString(t)){if(e.classList)return e.classList.contains(t);for(t=t||"",i=0,a=(r=n.isString(e.getAttribute("class"))?e.getAttribute("class").split(/\s+/):[]).length;i<a;i+=1)if(r[i]===t)return!0}return!1},addClass:function(e,t){var r;if(n.isNotEmptyString(t)){if(e.classList)return e.classList.add(t);r=n.isString(e.getAttribute("class"))?e.getAttribute("class").split(/\s+/):[],n.isString(t)&&n.isNotEmptyString(t.replace(/\s+/,""))&&(r.push(t),e.setAttribute("class",r.join(" ")))}},removeClass:function(e,t){var r;if(n.isNotEmptyString(t)){if(e.classList)return e.classList.remove(t);r=n.isString(e.getAttribute("class"))?e.getAttribute("class").split(/\s+/):[];var i,a,o=[];if(n.isString(t)&&n.isNotEmptyString(t.replace(/\s+/,""))){for(i=0,a=r.length;i<a;i+=1)t!==r[i]&&o.push(r[i]);e.setAttribute("class",o.join(" "))}}},addEventListener:function(e,t,r){return n.isArray(e)?void n.forEach(e,(function(e){i.addEventListener(e,t,r)})):n.isArray(t)?void n.forEach(t,(function(t){i.addEventListener(e,t,r)})):void(e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r))},removeEventListener:function(e,t,r){return n.isArray(e)?void n.forEach(e,(function(e){i.removeEventListener(e,t,r)})):n.isArray(t)?void n.forEach(t,(function(t){i.removeEventListener(e,t,r)})):void(e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent?e.detachEvent("on"+t,r):e["on"+t]=null)},dispatchEvent:function(e,t){e.dispatchEvent?e.dispatchEvent(t):e.fireEvent("on"+t.eventType,t)},isDescendant:function(e,t){for(var r=t.parentNode;null!==r;){if(r===e)return!0;r=r.parentNode}return!1},getTextContent:function(e){return e.textContent||e.text},prependChild:function(e,t){return t.parentNode&&t.parentNode.removeChild(t),e.insertBefore(t,e.firstChild)},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},isDomElement:function(e){return e instanceof Element},click:function(e,t){i.addEventListener(e,"click",t)},once:function(e,t,r){i.addEventListener(e,t,(function n(){r.apply(null,arguments),i.removeEventListener(e,t,n)}))},getDimension:function(e){var t;return!n.isOldIE()&&e.getBoundingClientRect?{width:(t=e.getBoundingClientRect()).width,height:t.height}:{width:e.offsetWidth,height:e.offsetHeight}}};t.exports=i},{"./utilityFunctions":45}],41:[function(e,t,r){"use strict";function n(e){this.message="HttpRequest Error: "+(e||"")}function i(e){if(!s.isFunction(e))throw new n("Missing XMLHttpRequest factory method");this.createXhr=e}function a(){var e=new XMLHttpRequest;return"withCredentials"in e||(e=new XDomainRequest),e}var o=e("./urlUtils"),s=e("./utilityFunctions");n.prototype=new Error,n.prototype.name="HttpRequest Error",i.prototype.run=function(e,t,r,i){function a(){r(-1,null,null,"")}!function(e,t,r){if(!s.isString(e)||s.isEmptyString(e))throw new n("Invalid url '"+e+"'");if(!s.isFunction(t))throw new n("Invalid handler '"+t+"' for the http request");if(s.isDefined(r)&&!s.isObject(r))throw new n("Invalid options map '"+r+"'")}(t,r,i);var l,u,c=this.createXhr();i=i||{},l=s.isNumber(i.timeout)?i.timeout:0,c.open(e,o.urlParts(t).href,!0),i.headers&&function(e,t){s.forEach(t,(function(t,r){s.isDefined(t)&&e.setRequestHeader(r,t)}))}(c,i.headers),i.withCredentials&&(c.withCredentials=!0),c.onload=function(){var e,t,n;c.getAllResponseHeaders||(c.getAllResponseHeaders=function(){return null}),c.status||(c.status=200),s.isDefined(u)&&(clearTimeout(u),u=void 0),e=c.statusText||"",t="response"in c?c.response:c.responseText,n=1223===c.status?204:c.status,r(n,t,c.getAllResponseHeaders(),e)},c.onerror=a,c.onabort=a,c.send(),l>0&&(u=setTimeout((function(){c&&c.abort()}),l))},i.prototype.get=function(e,t,r){this.run("GET",e,(function(e,r,i,a){!function(e){return 200<=e&&e<300}(e)?t(new n(a),r,e,i,a):t(null,r,e,i,a)}),r)};var l=new i(a);t.exports={http:l,HttpRequest:i,HttpRequestError:n,createXhr:a}},{"./urlUtils":44,"./utilityFunctions":45}],42:[function(e,t,r){"use strict";t.exports={html5:["text/javascript","text/javascript1.0","text/javascript1.2","text/javascript1.4","text/jscript","application/javascript","application/x-javascript","text/ecmascript","text/ecmascript1.0","text/ecmascript1.2","text/ecmascript1.4","text/livescript","application/ecmascript","application/x-ecmascript"],flash:["application/x-shockwave-flash"]}},{}],43:[function(e,t,r){"use strict";var n=e("./dom"),i=e("./utilityFunctions"),a={getPlayerSnapshot:function(e){var t=e.el().querySelector(".vjs-tech"),r={ended:e.ended(),src:e.currentSrc(),currentTime:e.currentTime(),type:e.currentType(),playing:!e.paused(),suppressedTracks:function(e){var t=e.remoteTextTracks?e.remoteTextTracks():[];t&&i.isArray(t.tracks_)&&(t=t.tracks_),i.isArray(t)||(t=[]);var r=[];return t.forEach((function(e){r.push({track:e,mode:e.mode}),e.mode="disabled"})),r}(e)};t&&(r.nativePoster=t.poster,r.style=t.getAttribute("style"));var n=document.getElementsByClassName("vjs-dock-text");return n&&n.length>0&&(r.dockText=n[0],r.dockText.style.display="none"),r},restorePlayerSnapshot:function(e,t){var r=e.el().querySelector(".vjs-tech"),n=20;t.nativePoster&&(r.poster=t.nativePoster),"style"in t&&r.setAttribute("style",t.style||""),t.dockText&&(t.dockText.style.display="block"),e.one("contentloadedmetadata",(function(){t.suppressedTracks.forEach((function(e){e.track.mode=e.mode}))})),e.one("canplay",(function r(){if(e.play(),!a.isReadyToResume(e)&&n--)setTimeout(r,50);else try{e.currentTime()!==t.currentTime?(t.playing&&e.one("seeked",(function(){e.play()})),e.currentTime(t.currentTime)):t.playing&&e.play()}catch(e){videojs.log.warn("Failed to resume the content after an advertisement",e)}})),function(){var t=setTimeout((function(){e.trigger("canplay")}),1e3);e.one("canplay",(function(){clearTimeout(t)}))}(),e.src({src:t.src,type:t.type})},isReadyToResume:function(e){return e.readyState()>1||!i.isIE11()&&(void 0===e.seekable()||e.seekable().length>0)}};a.prepareForAds=function(e){function t(){return e.vast&&e.vast.VPAID}function r(){return e.vast&&e.vast.adUnit}function a(){s()&&(window._molSettings.firstPlay=!1,e.trigger("vast.firstPlay"))}function o(){window._molSettings.firstPlay=!0,h.show(),u()}function s(){return window._molSettings.firstPlay}function l(){return{muted:e.muted(),volume:e.volume()}}function u(){f&&(function(t){i.isObject(t)&&(e.volume(t.volume),e.muted(t.muted))}(f),f=null)}function c(){n.hasClass(h.el(),"vjs-hidden")||h.hide()}function d(){n.addClass(e.el(),"vjs-ad-playing")}function p(){e.off("play",a),e.off("vast.reset",o),e.off("vast.firstPlay",u),e.off("error",c),e.off("vast.adStart",c),e.off("vast.adsCancel",c),e.off("vast.adError",c),e.off("vast.adStart",d),e.off("vast.adEnd",p),e.off("vast.adsCancel",p),n.removeClass(e.el(),"vjs-ad-playing"),n.removeClass(e.controlBar.playToggle.el(),"vjs-ended"),g&&setTimeout((function(){g.style.removeProperty("display")}),500)}var f,h=e.addChild("blackPoster");(function(){var n=e.play;e.play=function(a){var o=this;return s()?function(){i.isIPhone()||(f||(f=l()),e.muted(!0)),n.apply(o,arguments)}():function(i){r()&&!i?e.vast.adUnit.resumeAd():t()||n.apply(o,arguments)}(a),this};var a=e.pause;e.pause=function(n){return r()&&!n?e.vast.adUnit.pauseAd():t()||a.apply(this,arguments),this};var o=e.paused;e.paused=function(t){return r()&&!t?e.vast.adUnit.isPaused():o.apply(this,arguments)}})(),e.on("play",a),e.on("vast.reset",o),e.on("vast.firstPlay",u),e.on("error",c),e.on("vast.adStart",c),e.on("vast.adsCancel",c),e.on("vast.adError",c),e.on("vast.adStart",d),e.on("vast.adEnd",p),e.on("vast.adsCancel",p);var g,v=document.getElementsByClassName("vjs-error-display");v&&v.length>0&&(g=v[0]).style.setProperty("display","none","important")},a.removeNativePoster=function(e){var t=e.el().querySelector(".vjs-tech");t&&t.removeAttribute("poster")},a.once=function(e,t,r){function n(){r.apply(null,arguments),t.forEach((function(t){e.off(t,n)}))}t.forEach((function(t){e.on(t,n)}))},a.showBigPlayButton=function(e,t){var r=e.bigPlayButton.el_;r&&(t?(r.style.display="block",r.style.zIndex=99999):(r.style.display="none",r.style.zIndex=""))},t.exports=a},{"./dom":40,"./utilityFunctions":45}],44:[function(e,t,r){"use strict";var n=e("./utilityFunctions"),i=document.createElement("a"),a=document.documentMode;t.exports={urlParts:function(e){var t=e;return a&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:n.isNotEmptyString(i.port)?i.port:80,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}},queryStringToObj:function(e,t){var r,i;return t=n.isFunction(t)?t:function(){return!0},r=(e=e.trim().replace(/^\?/,"")).split("&"),i={},n.forEach(r,(function(e){var r,n,a;""!==e&&(n=(r=e.split("="))[0],a=r[1],t(n,a)&&(i[n]=a))})),i},objToQueryString:function(e){var t=[];return n.forEach(e,(function(e,r){t.push(r+"="+e)})),t.join("&")}}},{"./utilityFunctions":45}],45:[function(e,t,r){"use strict";function n(e){return null===e}function i(e){return"object"==typeof e}function a(e){return"function"==typeof e}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}var s=1,l=/[A-Z]/g,u=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)+$/i,c=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,d={_UA:navigator.userAgent,noop:function(){},isNull:n,isDefined:function(e){return void 0!==e},isUndefined:function(e){return void 0===e},isObject:i,isFunction:a,isNumber:function(e){return"number"==typeof e},isWindow:function(e){return d.isObject(e)&&e.window===e},isArray:o,isArrayLike:function(e){if(null===e||d.isWindow(e)||d.isFunction(e)||d.isUndefined(e))return!1;var t=e.length;return!(e.nodeType!==s||!t)||d.isString(e)||d.isArray(e)||0===t||"number"==typeof t&&t>0&&t-1 in e},isString:function(e){return"string"==typeof e},isEmptyString:function(e){return d.isString(e)&&0===e.length},isNotEmptyString:function(e){return d.isString(e)&&0!==e.length},arrayLikeObjToArray:function(e){return Array.prototype.slice.call(e)},forEach:function e(t,r,n){var i,s;if(t)if(a(t))for(i in t)"prototype"===i||"length"===i||"name"===i||t.hasOwnProperty&&!t.hasOwnProperty(i)||r.call(n,t[i],i,t);else if(o(t)){var l="object"!=typeof t;for(i=0,s=t.length;i<s;i++)(l||i in t)&&r.call(n,t[i],i,t)}else if(t.forEach&&t.forEach!==e)t.forEach(r,n,t);else for(i in t)t.hasOwnProperty(i)&&r.call(n,t[i],i,t);return t},snake_case:function(e,t){return t=t||"_",e.replace(l,(function(e,r){return(r?t:"")+e.toLowerCase()}))},isValidEmail:function(e){return!!d.isString(e)&&u.test(e.trim())},extend:function e(t){var r,a,o;for(a=1;a<arguments.length;a++)for(o in r=arguments[a])r.hasOwnProperty(o)&&(i(t[o])&&!n(t[o])&&i(r[o])?t[o]=e({},t[o],r[o]):t[o]=r[o]);return t},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},decapitalize:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},transformArray:function(e,t){var r=[];return e.forEach((function(e,n){var i=t(e,n);d.isDefined(i)&&r.push(i)})),r},toFixedDigits:function(e,t){var r=e+"";if(t=d.isNumber(t)?t:0,e=d.isNumber(e)?e:parseInt(e,10),d.isNumber(e)&&!isNaN(e)){for(r=e+"";r.length<t;)r="0"+r;return r}return"NaN"},throttle:function(e,t){var r=(new Date).getTime()-(t+1);return function(){var n=(new Date).getTime();n-r>=t&&(r=n,e.apply(this,arguments))}},debounce:function(e,t){var r;return function(){r&&clearTimeout(r),r=setTimeout((function(){e.apply(this,arguments),r=void 0}),t)}},treeSearch:function e(t,r,n){for(var i=r(t),a=0;a<i.length;a++){if(n(i[a]))return i[a];var o=e(i[a],r,n);if(o)return o}},echoFn:function(e){return function(){return e}},isISO8601:function(e){return d.isNumber(e)&&(e+=""),!!d.isString(e)&&c.test(e.trim())},isOldIE:function(){var e=d.getInternetExplorerVersion(navigator);return-1!==e&&e<10},getInternetExplorerVersion:function(e){var t=-1;if("Microsoft Internet Explorer"==e.appName){var r=e.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(r);null!==n&&(t=parseFloat(n[1]))}return t},isIE11:function(){return navigator.userAgent.search(/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i)>=0},isIDevice:function(){return/iP(hone|ad)/.test(d._UA)},isMobile:function(){return/iP(hone|ad|od)|Android|Windows Phone/.test(d._UA)},isIPhone:function(){return/iP(hone|od)/.test(d._UA)},isAndroid:function(){return/Android/.test(d._UA)}};t.exports=d},{}],46:[function(e,t,r){"use strict";var n=e("./utilityFunctions"),i={};i.strToXMLDoc=function(e){if(void 0===window.DOMParser){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async=!1,t.loadXML(e),t}return function(e){var t,r=new DOMParser;try{if(function(e){try{var t=(new DOMParser).parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;return"http://www.w3.org/1999/xhtml"===t?e.getElementsByTagName("parsererror").length>0:e.getElementsByTagNameNS(t,"parsererror").length>0}catch(e){}}(t=r.parseFromString(e,"application/xml"))||n.isEmptyString(e))throw new Error}catch(t){throw new Error("xml.strToXMLDOC: Error parsing the string: '"+e+"'")}return t}(e)},i.parseText=function(e){return/^\s*$/.test(e)?null:/^(?:true|false)$/i.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):n.isISO8601(e)?new Date(e):e.trim()},i.JXONTree=function(e){var t=i.parseText;if(e.documentElement)return new i.JXONTree(e.documentElement);if(e.hasChildNodes()){for(var r,a,o,s="",l=0;l<e.childNodes.length;l++)3==((r=e.childNodes.item(l)).nodeType-1|1)?s+=3===r.nodeType?r.nodeValue.trim():r.nodeValue:1!==r.nodeType||r.prefix||(a=n.decapitalize(r.nodeName),o=new i.JXONTree(r),this.hasOwnProperty(a)?(this[a].constructor!==Array&&(this[a]=[this[a]]),this[a].push(o)):this[a]=o);s&&(this.keyValue=t(s))}if(void 0===e.hasAttributes?e.attributes.length>0:e.hasAttributes())for(var u,c=0;c<e.attributes.length;c++)u=e.attributes.item(c),this["@"+n.decapitalize(u.name)]=t(u.value.trim())},i.JXONTree.prototype.attr=function(e){return this["@"+n.decapitalize(e)]},i.toJXONTree=function(e){var t=i.strToXMLDoc(e);return new i.JXONTree(t)},i.keyValue=function(e){if(e)return e.keyValue},i.attr=function(e,t){if(e)return e["@"+n.decapitalize(t)]},i.encode=function(e){if(n.isString(e))return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},i.decode=function(e){if(n.isString(e))return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},t.exports=i},{"./utilityFunctions":45}],47:[function(e,t,r){"use strict";var n=window.videojs||{getComponent:function(){},extend:function(){},registerComponent:function(){},registerPlugin:function(){}};window._molSettings=null,e("./plugin/components/ads-label_5"),e("./plugin/components/black-poster_5"),console.log("Custom MailOnline plugin version 1.2.6");var i=e("./plugin/videojs.vast.vpaid");n.registerPlugin?n.registerPlugin("vastClient",i):n.plugin("vastClient",i)},{"./plugin/components/ads-label_5":33,"./plugin/components/black-poster_5":35,"./plugin/videojs.vast.vpaid":36}]},{},[47])},function(e,t,r){var n=r(3),i=function(e){n.log("apnVmapVast->userSync",e)},a=function(){i("initiated"),this.isComplete=!1,this.run=function(e){i("start UserSync");try{if(this.isComplete)i("stop UserSync because it's already done");else{var t=e.userSyncTargetElement;e&&e.usersync_url&&"string"==typeof e.usersync_url&&""!==e.usersync_url?(this.executeUserSync(e,t),this.isComplete=!0,i("done")):i("stop UserSync because it needs proper options.usersync_url")}}catch(e){i("error: "+e)}},this.executeUserSync=function(e,t){if(t.ownerDocument&&t.ownerDocument.getElementById("apn_user_sync"))i("stop UserSync because it's already done");else{i("decode UserSync url");var r=decodeURIComponent(e.usersync_url);this.prepareIframeAndScript(r,t)}},this.prepareIframeAndScript=function(e,t){i("prepareIframeAndScript: "+e);var r=document.createElement("iframe");r.id="apn_user_sync",r.src=e,r.width="1",r.height="1",r.frameborder="0",r.scrolling="no",r.marginheight="0",r.marginwidth="0",r.topmargin="0",r.leftmargin="0",r.style.position="absolute",r.style.overflow="hidden",r.style.clip="rect(0 0 0 0)",r.style.height="1px",r.style.width="1px",r.style.margin="-1px",r.style.padding="0",r.style.border="0",t.appendChild(r),i("UserSync iframe injected into target element: "+t.id)}},o=function(){var e;return{sharedInstance:function(){return e||(e=new a),e}}}();e.exports=o},function(e,t,r){var n=r(3),i=r(17);try{r(33)}catch(e){}var a=r(2),o=r(9),s=(r(34),r(16)),l="apnVmapVast->vastArrayManager";e.exports=function(){function e(e){n.log(l,(e?"Show":"Hide")+" ad cover with spinner"),e?(P.style.display="block",A.el().classList.add("vjs-waiting")):(P.style.display="none",A.el().classList.remove("vjs-waiting"))}function t(){setTimeout((function(){E=!1,k&&A.markers.reset(JSON.parse(k))}),1e3),S.style.display="none",e(!1),f(),s.showNextOverlay(!0),D=!1,F&&A.one("ended",(function(){setTimeout((function(){D||(n.log(l,"Go to next video in playlist"),A.playlist.next())}),1e3)}))}function r(){D=!0,Date.now()-j<500||(e(!0),j=Date.now(),T&&A.markers&&A.markers.destroy&&A.markers.destroy(),function(e){return!(w.frequencyRules&&w.frequencyRules.playlistClips&&w.frequencyRules.playlistClips>1)||0==e%w.frequencyRules.playlistClips}(A.playlist.currentIndex())?(w.apnTagParams=[],M.forEach((function(e){w.apnTagParams.push({params:e.apnParams,timeOffset:e.timeOffset})})),M=[],E=!1,k=null,N=!1,L={},C=void 0,R=!1,n.log(l,"Start waiting metadata for next video in playlist"),A.one("loadedmetadata",b)):(e(!1),A.playlist.autoadvance(0)))}function u(){if(w){var e="auto";0===A.currentTime()&&(e=A.autoplay()?"auto":"click");var t=A.muted()?"off":"on";w.initialPlayback=e,w.initialAudio=t}}function c(e){n.log(l,"trace event message: "+e.data.message),w.pageNotificationCallback&&w.pageNotificationCallback("message",e.data.message)}function d(e){n.log(l,"trace event: "+e.data.event),w.pageNotificationCallback&&w.pageNotificationCallback("event",e.data.event)}function p(){A.one("vast.adStart",(function(){S.style.display="block",E=!0,e(!1)})),A.on("vast.adError",t),A.on("vast.adsCancel",t),A.on("vast.adSkip",t),A.on("vast.reset",t),A.on("vast.contentEnd",t),A.on("adFinished",t),A.on("trace.message",c),A.on("trace.event",d)}function f(){A.off("vast.adError",t),A.off("vast.adsCancel",t),A.off("vast.adSkip",t),A.off("vast.reset",t),A.off("vast.contentEnd",t),A.off("adFinished",t),A.off("trace.message",c),A.off("trace.event",d)}function h(e){if(!E){f(),u(),(!H||!A.paused())&&A.pause(),E=!0,T&&(k=JSON.stringify(A.markers.getMarkers()),A.markers.removeAll());var t={verbosity:5,adTagXML:function(t){setTimeout((function(){t(null,e)}),0)},playAdAlways:!1,adCancelTimeout:w&&w.timeouts&&w.timeouts.adStartTimeout?w.timeouts.adStartTimeout:x,adsEnabled:!0,initialPlayback:w.initialPlayback,initialAudio:w.initialAudio};w&&w.skippable&&w.skippable.skipText&&(t.skipText=w.skippable.skipText),w&&w.skippable&&w.skippable.skipButtonText&&(t.skipButtonText=w.skippable.skipButtonText),w&&w.viewability&&(w.viewability.contextId="anoutstream",t.viewability=w.viewability),w&&!1===w.clickThruEnabled&&(t.disableClickThru=!0),w&&w.skippable&&w.skippable.hasOwnProperty("enabled")&&(t.skippable={},t.skippable.enabled=w.skippable.enabled,t.skippable.videoThreshold=1e3*w.skippable.videoThreshold,t.skippable.videoOffset=1e3*w.skippable.videoOffset),w&&w.wrapperLimit&&w.wrapperLimit>0&&(t.wrapperLimit=w.wrapperLimit),p(),A.vastClient(t),("click"!==w.initialPlayback||_)&&(O||setTimeout((function(){A.play()}),0)),s.showNextOverlay(!1)}}function g(e){for(var t=0;t<M.length;t++)if(F||t!==M.length-1||(F=!0),M[t].time===e)return M[t].played?null:(M[t].played=!0,M[t].xml);return null}function v(t){n.log(l,"Try to play ad at time = "+t);var r=g(t);r?(n.log(l,"VAST xml selected for time: "+t),e(!0),(_=H&&0===t)&&A.playlist&&"function"==typeof A.playlist&&A.playlist.currentIndex()>0&&(_=!1),_?(e(!1),A.bigPlayButton.el_.style.opacity=1,W?(z||(A.pause(),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.el_.style.opacity=1),A.one("play",(function(){h(r)}))):A.one("play",(function(){h(r)}))):(O=!1,0===t&&A.paused()&&(O=!0,A.bigPlayButton.el_.style.display="block",A.bigPlayButton.el_.style.opacity=1),h(r))):(n.log(l,"VAST xml selected for time: "+t+" is invalid: "+r),e(!1),0===t&&A.paused()&&(A.bigPlayButton.el_.style.display="block",A.bigPlayButton.el_.style.opacity=1,A.one("play",(function(){A.bigPlayButton.el_.style.display="none"}))))}function m(){w.apnTagParams=M[X].apnParams,B.getXML(w,A,(function(e,t,r){t?(n.error(l,"Error to get VAST xml for next playlist item. Erorr code: "+t+". Error message: "+r),q.push({xml:null,timeOffset:M[X].timeOffset})):q.push({xml:e,timeOffset:M[X].timeOffset}),++X<M.length&&m()}))}function y(){var t=!1;if(q.length>0){for(var i=0;i<M.length;i++){for(var a=null,o=0;o<q.length;o++)if(q[o].timeOffset===M[i].timeOffset){a=q[o];break}a&&(M[i].xml=a.xml,!t&&M[i].xml&&(t=!0))}q=[],R=!0,w.playerSettings.autostart&&A.play(),t&&T&&!N&&(N=!0,T.markers(L)),setTimeout((function(){A.on("playlistitem",r),U.length>1&&A.playlist.autoadvance(t?null:0),U.length>1&&A.playlist.currentIndex()<U.length-1&&(X=0,m())}),1e3)}else w.apnTagParams=M[C].apnParams,B.getXML(w,A,(function(i,a,o){C>=M.length||(a?(n.error(l,"Error to get VAST xml. Erorr code: "+a+". Error message: "+o),M[C].xml=null):(t=!0,M[C].xml=i,H||(R=!0,T&&!N&&(N=!0,T.markers(L)))),++C<M.length?y():(R=!0,E||e(!1),w.playerSettings.autostart&&(H&&(T&&!N&&(N=!0,T.markers(L)),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.el_.style.opacity=1,A.one("play",(function(){A.bigPlayButton.el_.style.display="none"}))),A.play()),setTimeout((function(){A.on("playlistitem",r),U.length>1&&A.playlist.autoadvance(t?null:0),U.length>1&&A.playlist.currentIndex()<U.length-1&&(X=0,m())}),1e3)))}))}function b(){n.log(l,"Start preparing ad array (may called on loadmetadata event)"),F=!1,R=!1,U=A.playlist&&"function"==typeof A.playlist?A.playlist():[],e(!0),L={markerStyle:{width:"5px","border-radius":"10%","background-color":"white"},markerTip:{display:!1},onMarkerReached:function(e){v(e.time)},markers:[],metadataLoaded:!0},A.off("loadedmetadata",b);var t,r=[],i=A.textTracks()[0];if(i.cues_&&i.cues_.length>0)for(t=0;t<i.cues_.length;t++){var o=i.cues_[t].startTime;r.push(o)}var u=!1;for(I=A.duration(),t=0;t<w.apnTagParams.length;t++){var c=s.convertStringToSeconds(w.apnTagParams[t].timeOffset,I);if(null!==c&&c<=I){var d={time:c,played:!1,apnParams:w.apnTagParams[t].params,timeOffset:w.apnTagParams[t].timeOffset};if(c<0){var p=-c-1;p<r.length&&(c=r[p])}c>=0&&c<=I&&(c===I&&(c=parseInt(I+.5)),L.markers.push({time:c}),d.time=c,M.push(d),c<1&&(u=!0))}}M.sort((function(e,t){return e.time-t.time})),L.markers.length>0?(T||(T=new a(videojs)),T.init(A),u||e(!1),C=0,w.apnTagParams=M[C].apnParams,y()):e(!1)}var A,w,k,T,S,C,V=o(),E=!1,x=3e3,N=!1,I=0,_=!1,P=document.getElementById("apn-break-cover"),M=[],L={},R=!1,O=!1,B=new i,U=[],D=!1,F=!1,j=0,X=-1,q=[],H=V.device.type||V.device.model,W="ios"===V.os.name.toLowerCase(),z=H&&"iphone"===V.device.model.toLowerCase(),J="IE"===V.browser.name;this.play=function(t,r){A=t,(w=r).playerSettings={},w.playerSettings.autostart=0===A.currentTime()?A.autoplay():!A.paused(),w.playerSettings.muted=A.muted(),(P=document.createElement("div")).id="apn-break-cover",P.style.width="100%",P.style.height="100%",P.style.backgroundColor="black",P.style.position="absolute",P.style.zIndex=101,A.el().appendChild(P),P.style.display="none",(S=document.createElement("p")).className="vjs-overlay",S.innerHTML=w.adText?w.adText:"Ad",S.style.display="none",S.style.left="10px",A.el().appendChild(S),I=A.duration()>0?parseInt(A.duration())-.5:0,A.bigPlayButton.el_.style.opacity=1,V.device.type||V.device.model||!w.playerSettings.autostart||(A.bigPlayButton.el_.style.display="none"),I?(A.pause(),b()):(e(!0),V.device.type||V.device.model?(w.playerSettings.autostart=!0,w.playerSettings.muted=A.muted(),!0===A.autoplay()&&A.autoplay("any"),R||A.pause(),A.one("loadedmetadata",b)):(setTimeout((function(){J||!A.paused()||"block"===A.bigPlayButton.el_.style.display||E||(e(!1),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.one("click",(function(){A.bigPlayButton.el_.style.display="none"})))}),1e3),A.one("playing",(function(){A.paused()?(e(!1),A.bigPlayButton.el_.style.display="block",A.bigPlayButton.one("click",(function(){A.bigPlayButton.el_.style.display="none",b()}))):(A.bigPlayButton.el_.style.display="none",b()),R||A.pause()}))))},this.stop=function(){E&&A.trigger("vast.adsCancel"),T&&A.markers.destroy()},this.test=function(){return{setDuration:function(e){I=e},setOptions:function(e){w=e},options:function(){return w},setPlayer:function(e){A=e},showCover:e,resetContent:t,nextListItemHandler:r,setPlaybackMethodData:u,playAd:h,getXmlByTime:g,startAd:v,prepareNextAvailableXml:y,prepareAdArray:b}}}}]);
